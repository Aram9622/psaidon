function mopen(n,t){n=="homemenu"&&homemenuloaded==0&&(basicahah(imasroot+"/gethomemenu.php?cid="+t,"homemenu"),homemenuloaded=1),mcancelclosetime(),ddmenuitem?(ddmenuitem.style.visibility="hidden",ddmenuitem=null):(ddmenuitem=document.getElementById(n),ddmenuitem.style.visibility="visible")}function mclose(){ddmenuitem&&(ddmenuitem.style.visibility="hidden",ddmenuitem=null)}function mclosetime(){closetimer=window.setTimeout(mclose,250)}function mcancelclosetime(){closetimer&&(window.clearTimeout(closetimer),closetimer=null)}function basicahah(n,t,i){i==null&&(i=" Fetching data... "),document.getElementById(t).innerHTML=i;var r=!1;window.XMLHttpRequest?(req=new XMLHttpRequest,r=!0):window.ActiveXObject&&(req=new ActiveXObject("Microsoft.XMLHTTP"),r=!0),r&&(req.onreadystatechange=function(){basicahahDone(n,t)},req.open("GET",n,!0),req.send(""))}function basicahahDone(n,t){req.readyState==4&&(document.getElementById(t).innerHTML=req.status==200?req.responseText:" AHAH Error:\n"+req.status+"\n"+req.statusText)}function arraysearch(n,t){for(var i=0;i<t.length;i++)if(t[i]==n)return i;return-1}function tipshow(n,t){var i,r;typeof tipobj!="object"&&(tipobj=document.createElement("div"),tipobj.className="tips",document.getElementsByTagName("body")[0].appendChild(tipobj)),tipobj.innerHTML=t,tipobj.style.left="5px",tipobj.style.display="block",typeof usingASCIIMath!="undefined"&&typeof noMathRender!="undefined"&&usingASCIIMath&&!noMathRender&&rendermathnode(tipobj),i=findPos(n),self.innerHeight?x=self.innerWidth:document.documentElement&&document.documentElement.clientHeight?x=document.documentElement.clientWidth:document.body&&(x=document.body.clientWidth),r=0,typeof window.pageYOffset=="number"?r=window.pageXOffset:document.body&&(document.body.scrollLeft||document.body.scrollTop)?r=document.body.scrollLeft:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(r=document.documentElement.scrollLeft),x+=r,i[0]+tipobj.offsetWidth>x&&(i[0]=x-tipobj.offsetWidth-30),tipobj.style.left=i[0]+20+"px",tipobj.style.top=i[1]<30?i[1]+20+"px":i[1]-tipobj.offsetHeight+"px"}function popupwindow(n,t,i,r,u){var e,f;r=="fit"&&(r=window.height-80),e="width="+i+",height="+r+",status=0,resizable=1,directories=0,menubar=0",u!=null&&u==!0&&(e+=",scrollbars=1"),typeof popupwins[n]=="undefined"||popupwins[n].closed||popupwins[n].focus(),t.match(/^http/)?popupwins[n]=window.open(t,n,e):(f=window.open("",n,e),f.document.write("<html><head><title>Popup</title></head><body>"),f.document.write(t),f.document.write("</body></html>"),f.document.close(),popupwins[n]=f)}function tipout(){tipobj.style.display="none"}function findPos(n){var t=curtop=0;if(n.offsetParent)do t+=n.offsetLeft,curtop+=n.offsetTop,n.offsetParent&&(n.parentNode&&n.offsetParent!=n.parentNode?(t-=n.parentNode.scrollLeft,curtop-=n.parentNode.scrollTop):(t-=n.offsetParent.scrollLeft,curtop-=n.offsetParent.scrollTop));while(n=n.offsetParent);return[t,curtop]}function togglepic(n){n.getAttribute("src").match("userimg_sm")?n.setAttribute("src",n.getAttribute("src").replace("_sm","_")):n.setAttribute("src",n.getAttribute("src").replace("_","_sm"))}function addLoadEvent(n){var t=window.onload;window.onload=typeof window.onload!="function"?n:function(){t&&t(),n()}}function submitlimiter(n){var t=n.target;t.className=="submitted"?(alert("You have already submitted this page.  Please be patient while your submission is processed."),t.className="submitted2",n.preventDefault?n.preventDefault():n.returnValue=!1):t.className=="submitted2"?n.preventDefault?n.preventDefault():n.returnValue=!1:t.className="submitted"}function setupFormLimiters(){for(var t=document.getElementsByTagName("form"),n=0;n<t.length;n++)if(typeof t[n].onsubmit!="function"&&t[n].className!="nolimit")$(t[n]).on("submit",submitlimiter)}function GB_show(n,t,i,r){var e,o,s,f,u,h;GB_loaded==!1&&(e=document.createElement("div"),e.id="GB_overlay",e.onclick=GB_hide,document.getElementsByTagName("body")[0].appendChild(e),o=document.createElement("div"),o.id="GB_window",o.innerHTML='<div id="GB_caption"></div><div id="GB_loading">Loading...</div><div id="GB_frameholder" ></div>',document.getElementsByTagName("body")[0].appendChild(o),GB_loaded=!0),document.getElementById("GB_frameholder").innerHTML='<iframe onload="GB_doneload()" id="GB_frame" src="'+t+'"></iframe>',jQuery("#GB_frameholder").isolatedScroll(),t.match(/libtree/)?(s='<span class="floatright"><input type="button" value="Use Libraries" onClick="document.getElementById(\'GB_frame\').contentWindow.setlib()" /> ',s+='<span class="pointer" onclick="GB_hide()">[X]</span>&nbsp;</span>Select Libraries<div class="clear"></div>',document.getElementById("GB_caption").innerHTML=s,f=self.innerHeight||u&&u.clientHeight||document.body.clientHeight):(document.getElementById("GB_caption").innerHTML='<span class="floatright"><span class="pointer" onclick="GB_hide()">[X]</span></span>'+n,document.getElementById("GB_caption").onclick=GB_hide,f=r=="auto"?self.innerHeight||u&&u.clientHeight||document.body.clientHeight:r),document.getElementById("GB_window").style.display="block",document.getElementById("GB_overlay").style.display="block",document.getElementById("GB_loading").style.display="block",u=document.documentElement,h=self.innerWidth||u&&u.clientWidth||document.body.clientWidth,document.getElementById("GB_window").style.width=i+"px",document.getElementById("GB_window").style.height=f-30+"px",document.getElementById("GB_window").style.left=(h-i)/2+"px",document.getElementById("GB_frame").style.height=f-64+"px"}function GB_doneload(){document.getElementById("GB_loading").style.display="none"}function GB_hide(){document.getElementById("GB_window").style.display="none",document.getElementById("GB_overlay").style.display="none"}function chkAllNone(n,t,r,u){var f=document.getElementById(n);for(i=0;i<=f.elements.length;i++)try{(t=="all"&&f.elements[i].type=="checkbox"||f.elements[i].name==t)&&(f.elements[i].checked=u&&f.elements[i].className==u?!r:r)}catch(e){}return!1}function initeditor(n,t,i,r,u){var s=i||0,h=r||0,e="",f,o;n=="exact"?e="#"+t.split(/,/).join(",#"):n=="textareas"?e="textarea."+t:n=="divs"?e="div."+t:n=="selector"&&(e=t),f={selector:e,inline:h,plugins:["advlist attach image charmap anchor","searchreplace code link textcolor","media table paste asciimath asciisvg rollups"],menubar:!1,toolbar1:"myEdit myInsert styleselect | bold italic underline subscript superscript | forecolor backcolor | code | saveclose",toolbar2:" alignleft aligncenter alignright | bullist numlist outdent indent  | attach link unlink image | table | asciimath asciimathcharmap asciisvg",extended_valid_elements:"iframe[src|width|height|name|align|allowfullscreen|frameborder],param[name|value],@[sscr]",content_css:imasroot+(s==1?"/assessment/mathtest.css,":"/imascore.css,")+imasroot+"/themes/"+coursetheme,AScgiloc:imasroot+"/filter/graph/svgimg.php",convert_urls:!1,file_picker_callback:filePickerCallBackFunc,file_browser_types:"file image",images_upload_url:imasroot+"/tinymce4/upload_handler.php",paste_data_images:!0,default_link_target:"_blank",browser_spellcheck:!0,resize:"both",width:"100%",content_style:"body {background-color: #ffffff !important;}",table_class_list:[{title:"None",value:""},{title:"Gridded",value:"gridded"},{title:"Gridded Centered",value:"gridded centered"}],style_formats_merge:!0,style_formats:[{title:"Font Family",items:[{title:"Arial",inline:"span",styles:{"font-family":"arial"}},{title:"Book Antiqua",inline:"span",styles:{"font-family":"book antiqua"}},{title:"Comic Sans MS",inline:"span",styles:{"font-family":"comic sans ms,sans-serif"}},{title:"Courier New",inline:"span",styles:{"font-family":"courier new,courier"}},{title:"Georgia",inline:"span",styles:{"font-family":"georgia,palatino"}},{title:"Helvetica",inline:"span",styles:{"font-family":"helvetica"}},{title:"Impact",inline:"span",styles:{"font-family":"impact,chicago"}},{title:"Open Sans",inline:"span",styles:{"font-family":"Open Sans"}},{title:"Symbol",inline:"span",styles:{"font-family":"symbol"}},{title:"Tahoma",inline:"span",styles:{"font-family":"tahoma"}},{title:"Terminal",inline:"span",styles:{"font-family":"terminal,monaco"}},{title:"Times New Roman",inline:"span",styles:{"font-family":"times new roman,times"}},{title:"Verdana",inline:"span",styles:{"font-family":"Verdana"}}]},{title:"Font Size",items:[{title:"8pt",inline:"span",styles:{fontSize:"12px","font-size":"8px"}},{title:"10pt",inline:"span",styles:{fontSize:"12px","font-size":"10px"}},{title:"12pt",inline:"span",styles:{fontSize:"12px","font-size":"12px"}},{title:"14pt",inline:"span",styles:{fontSize:"12px","font-size":"14px"}},{title:"16pt",inline:"span",styles:{fontSize:"12px","font-size":"16px"}},{title:"20pt",inline:"span",styles:{fontSize:"12px","font-size":"20px"}}]}]},document.documentElement.clientWidth<385?(f.toolbar1="myEdit myInsert styleselect | bold italic underline",f.toolbar2="bullist numlist outdent indent  | link image | asciimath asciisvg"):document.documentElement.clientWidth<465?(f.toolbar1="myEdit myInsert styleselect | bold italic underline forecolor",f.toolbar2="bullist numlist outdent indent  | link unlink image | asciimath asciisvg"):document.documentElement.clientWidth<575&&(f.toolbar1="myEdit myInsert styleselect | bold italic underline subscript superscript | forecolor",f.toolbar2=" alignleft aligncenter | bullist numlist outdent indent  | link unlink image | asciimath asciimathcharmap asciisvg"),u&&(f.setup=u);for(o in tinymce.editors)tinymce.editors[o].remove();tinymce.init(f)}function filePickerCallBack(n,t,i){var r=imasroot+"/tinymce4/file_manager.php";switch(i.filetype){case"image":r+="?type=img";break;case"file":r+="?type=files"}tinyMCE.activeEditor.windowManager.open({file:r,title:"File Manager",width:350,height:450,resizable:"yes",inline:"yes",close_previous:"no"},{oninsert:function(t){n(t)}})}function imascleanup(n,t){return n=="get_from_editor"&&(t=t.replace(/<!--([\s\S]*?)-->|&lt;!--([\s\S]*?)--&gt;|<style>[\s\S]*?<\/style>/g,""),t=t.replace(/class="?Mso\w+"?/g,""),t=t.replace(/<p\s*>\s*<\/p>/gi,""),t=t.replace(/<script.*?\/script>/gi,""),t=t.replace(/<input[^>]*button[^>]*>/gi,"")),t}function readCookie(n){for(var r=n+"=",u=document.cookie.split(";"),t,i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(r)==0)return unescape(t.substring(r.length,t.length))}return null}function selectByDivID(n){for(var u=n.value,f=n.value.split(":")[0],i=document.getElementsByTagName("div"),r,t=0;t<i.length;t++)i[t].className.match(f)&&(i[t].style.display=i[t].id==u?"block":"none");r=new Date,r.setDate(r.getDate()+365),document.cookie=f+"store="+escape(u)+";expires="+r.toGMTString()}function setselectbycookie(){for(var t=document.getElementsByTagName("select"),i,n=0;n<t.length;n++)t[n].className.match("alts")&&(i=t[n].className.replace(/alts/,"").replace(/\s/g,""),(co=readCookie(i+"store"))!=null&&(co=co.replace("store",""),t[n].value=co,selectByDivID(t[n])))}function recclick(n,t,i,r){if(cid>0){var u="",f;(f=window.location.href.match(/showlinkedtext.*?&id=(\d+)/))!==null&&recordedunload==!1&&(u="&unloadinglinked="+f[1],recordedunload=!0),jQuery.ajax({type:"POST",url:imasroot+"/course/rectrack.php?cid="+cid,data:"type="+encodeURIComponent(n)+"&typeid="+encodeURIComponent(t)+"&info="+encodeURIComponent(i+"::"+r)+u})}}function setuptracklinks(n,t){jQuery(t).attr("data-base")&&jQuery(t).click(function(n){var i=jQuery(this).attr("data-base").split("-");return recclick(i[0],i[1],jQuery(this).attr("href"),jQuery(this).text()),typeof jQuery(t).attr("target")=="undefined"?(n.preventDefault(),setTimeout('window.location.href = "'+jQuery(this).attr("href")+'"',100),!1):void 0}).mousedown(function(n){if(n.which==3){var t=jQuery(this).attr("data-base").split("-");recclick(t[0],t[1],jQuery(this).attr("href"),jQuery(this).text())}})}function togglevideoembed(){var s=this.id.substr(13),i=jQuery("#videoiframe"+s),n,e,u,f,t,r,o;i.length>0?i.css("display")=="none"?(i.show(),i.parent(".fluid-width-video-wrapper").show(),jQuery(this).text(" [-]"),jQuery(this).attr("title",_("Hide video"))):(i.hide(),i.get(0).contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"),i.parent(".fluid-width-video-wrapper").hide(),jQuery(this).text(" [+]"),jQuery(this).attr("title",_("Watch video here"))):(n=jQuery(this).prev().attr("href"),e="?",n.match(/youtube\.com/)?n.indexOf("playlist?list=")>-1?(u=n.split("list=")[1].split(/[#&]/)[0],f="www.youtube.com/embed/videoseries?list=",e="&"):(u=n.split("v=")[1].split(/[#&]/)[0],f="www.youtube.com/embed/"):n.match(/youtu\.be/)?(u=n.split(".be/")[1].split(/[#&]/)[0],f="www.youtube.com/embed/"):n.match(/vimeo/)&&(u=n.split(".com/")[1].split(/[#&]/)[0],f="player.vimeo.com/video/"),t=n.match(/.*\Wt=((\d+)m)?((\d+)s)?.*/),t==null?(r=e+"rel=0",t=n.match(/.*start=(\d+)/),t!=null&&(r+="&start="+t[1])):r=e+"rel=0&start="+((t[2]?t[2]*60:0)+(t[4]?t[4]*1:0)),t=n.match(/.*end=(\d+)/),t!=null&&(r+="&end="+t[1]),r+="&enablejsapi=1",jQuery("<iframe/>",{id:"videoiframe"+s,width:640,height:400,src:location.protocol+"//"+f+u+r,frameborder:0,allowfullscreen:1}).insertAfter(jQuery(this)),jQuery(this).parent().fitVids(),jQuery("<br/>").insertAfter(jQuery(this)),jQuery(this).text(" [-]"),jQuery(this).attr("title",_("Hide video")),jQuery(this).prev().attr("data-base")&&(o=jQuery(this).prev().attr("data-base").split("-"),recclick(o[0],o[1],n,jQuery(this).prev().text())))}function setupvideoembeds(n,t){jQuery("<span/>",{text:" [+]",title:_("Watch video here"),id:"videoembedbtn"+videoembedcounter,click:togglevideoembed,"class":"videoembedbtn"}).insertAfter(t),videoembedcounter++}function addNoopener(n,t){!t.rel&&t.target&&t.host!==window.location.host&&t.setAttribute("rel","noopener noreferrer")}function addmultiselect(n,t){var r=jQuery(n).parent(),i=jQuery("#"+t).val(),u=jQuery("#"+t+" option[value="+i+"]").prop("disabled",!0).html();i!="null"&&r.append('<div class="multiselitem"><span class="right"><a href="#" onclick="removemultiselect(this);return false;">Remove</a></span><input type="hidden" name="'+t+'[]" value="'+i+'"/>'+u+"</div>"),jQuery("#"+t).val("null")}function removemultiselect(n){var t=jQuery(n).parent().parent(),i=t.find("input").val();t.parent().find("option[value="+i+"]").prop("disabled",!1),t.remove()}function hidefromcourselist(n,t){confirm("Are you SURE you want to hide this course from your course list?")&&jQuery.ajax({type:"GET",url:imasroot+"/admin/hidefromcourselist.php?cid="+t}).done(function(t){t=="OK"&&(jQuery(n).parent().slideUp(),jQuery("#unhidelink").show())})}function rotateimg(n){var t,i;t=$(n).data("rotation")?($(n).data("rotation")+90)%360:90,$(n).data("rotation",t).css({transform:"rotate("+t+"deg)"}),t%180==90?(i=($(n).width()-$(n).height())/2,i>0&&$(n).parent().css({"padding-top":i,"padding-bottom":i})):$(n).parent().css({"padding-top":0,"padding-bottom":0})}function _(n){var t,i;if(t=typeof i18njs!="undefined"&&i18njs[n]?i18njs[n]:n,arguments.length>1)for(i=1;i<arguments.length;i++)t=t.replace("$"+i,arguments[i]);return t}function setAltSelectors(n,t){console.log("looking for "+n),$(".alts."+n).parents(".altWrap").find(".altContentOn").removeClass("altContentOn").addClass("altContentOff"),$(".alts."+n).parents(".altWrap").find("."+t).addClass("altContentOn").removeClass("altContentOff"),$("select.alts."+n).val(n+":"+t);var i=new Date;i.setDate(i.getDate()+365),document.cookie="alt_store_"+n+"="+escape(t)+";expires="+i.toGMTString()+";path=/"}function factorial(n,t){t==null&&(t=1);for(var i=n-t;i>0;i-=t)n*=i;return n<0?NaN:n==0?1:n}function C(n,t){for(var r=1,i=0;i<t;i++)r*=(n-i)/(t-i);return r}function matchtolower(n){return n.toLowerCase()}function nthroot(n,t){return safepow(t,1/n)}function nthlogten(n,t){return Math.log(t)/Math.log(n)}function functoindex(n){for(var t=0;t<funcstoindexarr.length;t++)if(funcstoindexarr[t]==n)return"@"+t+"@"}function indextofunc(n,t){return funcstoindexarr[t]}function safepow(n,t){if(n<0&&Math.floor(t)!=t){for(var i=3;i<50;i+=2)if(Math.abs(Math.round(i*t)-i*t)<1e-6)return Math.round(i*t)%2==0?Math.pow(Math.abs(n),t):-1*Math.pow(Math.abs(n),t);return Math.sqrt(-1)}return Math.pow(n,t)}function mathjs(n,t){var s,f,o,r,u,i,e;for(n=n.replace("[","("),n=n.replace("]",")"),n=n.replace(/root\s*(\d+)/,"root($1)"),n=n.replace(/arc(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)/gi,"$1^-1"),n=n.replace(/(Sin|Cos|Tan|Sec|Csc|Cot|Arc|Abs|Log|Ln|Sqrt)/gi,matchtolower),t!=null&&(s=t.split("|"),n=n.replace(/(sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex),f=new RegExp("(sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root)[(]","g"),n=n.replace(f,"$1#("),f=new RegExp("("+t+")("+t+")$","g"),n=n.replace(f,"($1)($2)"),f=new RegExp("("+t+")(a#|sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root)","g"),n=n.replace(f,"($1)$2"),f=new RegExp("("+t+")("+t+")([^a-df-zA-Z#])","g"),n=n.replace(f,"($1)($2)$3"),f=new RegExp("([^a-df-zA-Z#])("+t+")([^a-df-zA-Z#])","g"),n=n.replace(f,"$1($2)$3"),f=new RegExp("([^a-df-zA-Z#(])("+t+")([^a-df-zA-Z#)])","g"),n=n.replace(f,"$1($2)$3"),f=new RegExp("^("+t+")([^a-df-zA-Z])","g"),n=n.replace(f,"($1)$2"),f=new RegExp("([^a-df-zA-Z])("+t+")$","g"),n=n.replace(f,"$1($2)"),n=n.replace(new RegExp("(("+t+"))","g"),function(n){for(var t=0;t<s.length;t++)if(s[t]==n)return"(@v"+t+"@)"}),n=n.replace(/@(\d+)@/g,indextofunc)),n=n.replace(/([0-9])\s+([0-9])/g,"$1*$2"),n=n.replace(/#/g,""),n=n.replace(/\s/g,""),n=n.replace(/log_([a-zA-Z\d\.]+)\(/g,"nthlog($1,"),n=n.replace(/log_\(([a-zA-Z\/\d\.]+)\)\(/g,"nthlog($1,"),n=n.replace(/log/g,"logten"),n.indexOf("^-1")!=-1&&(n=n.replace(/sin\^-1/g,"arcsin"),n=n.replace(/cos\^-1/g,"arccos"),n=n.replace(/tan\^-1/g,"arctan"),n=n.replace(/sec\^-1/g,"arcsec"),n=n.replace(/csc\^-1/g,"arccsc"),n=n.replace(/cot\^-1/g,"arccot"),n=n.replace(/sinh\^-1/g,"arcsinh"),n=n.replace(/cosh\^-1/g,"arccosh"),n=n.replace(/tanh\^-1/g,"arctanh"),n=n.replace(/sech\^-1/g,"arcsech"),n=n.replace(/csch\^-1/g,"arccsch"),n=n.replace(/coth\^-1/g,"arccoth")),n=n.replace(/(sin|cos|tan|sec|csc|cot)\^(\d+)\(/g,"$1n($2,"),n=n.replace(/root\((\d+)\)\(/g,"nthroot($1,"),n=n.replace(/([0-9])E([\-0-9])/g,"$1(EE)$2"),n=n.replace(/^e$/g,"(E)"),n=n.replace(/pi/g,"(pi)"),n=n.replace(/@v(\d+)@/g,function(n,t){return s[t]}),n=n.replace(/^e([^a-zA-Z])/g,"(E)$1"),n=n.replace(/([^a-zA-Z])e$/g,"$1(E)"),n=n.replace(/([^a-zA-Z])e(?=[^a-zA-Z])/g,"$1(E)"),n=n.replace(/([0-9])([\(a-zA-Z])/g,"$1*$2"),n=n.replace(/(!)([0-9\(])/g,"$1*$2"),n=n.replace(/([0-9])\*\(EE\)([\-0-9])/,"$1e$2"),n=n.replace(/\)([\(0-9a-zA-Z]|\.\d+)/g,")*$1");(o=n.indexOf("^"))!=-1;){if(o==0)return"Error: missing argument";if(r=o-1,i=n.charAt(r),i>="0"&&i<="9"){for(r--;r>=0&&(i=n.charAt(r))>="0"&&i<="9";)r--;if(i==".")for(r--;r>=0&&(i=n.charAt(r))>="0"&&i<="9";)r--}else if(i==")"){for(e=1,r--;r>=0&&e>0;)i=n.charAt(r),i=="("?e--:i==")"&&e++,r--;while(r>=0&&((i=n.charAt(r))>="a"&&i<="z"||i>="A"&&i<="Z"))r--}else if(i>="a"&&i<="z"||i>="A"&&i<="Z")for(r--;r>=0&&((i=n.charAt(r))>="a"&&i<="z"||i>="A"&&i<="Z");)r--;else return"Error: incorrect syntax in "+n+" at position "+r;if(o==n.length-1)return"Error: missing argument";if(u=o+1,i=n.charAt(u),nch=n.charAt(u+1),i>="0"&&i<="9"||i=="-"&&nch!="("||i=="."){for(u++;u<n.length&&(i=n.charAt(u))>="0"&&i<="9";)u++;if(i==".")for(u++;u<n.length&&(i=n.charAt(u))>="0"&&i<="9";)u++}else if(i=="("||i=="-"&&nch=="(")for(i=="-"&&u++,e=1,u++;u<n.length&&e>0;)i=n.charAt(u),i=="("?e++:i==")"&&e--,u++;else if(i>="a"&&i<="z"||i>="A"&&i<="Z"){for(u++;u<n.length&&((i=n.charAt(u))>="a"&&i<="z"||i>="A"&&i<="Z");)u++;if(i=="("&&n.slice(o+1,u).match(/^(sin|cos|tan|sec|csc|cot|logten|log|ln|exp|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|sqrt|abs|nthroot)$/))for(e=1,u++;u<n.length&&e>0;)i=n.charAt(u),i=="("?e++:i==")"&&e--,u++}else return"Error: incorrect syntax in "+n+" at position "+u;n=n.slice(0,r+1)+"safepow("+n.slice(r+1,o)+","+n.slice(o+1,u)+")"+n.slice(u)}while((o=n.indexOf("!"))!=-1){if(o==0)return"Error: missing argument";if(r=o-1,i=n.charAt(r),i>="0"&&i<="9"){for(r--;r>=0&&(i=n.charAt(r))>="0"&&i<="9";)r--;if(i==".")for(r--;r>=0&&(i=n.charAt(r))>="0"&&i<="9";)r--}else if(i==")"){for(e=1,r--;r>=0&&e>0;)i=n.charAt(r),i=="("?e--:i==")"&&e++,r--;while(r>=0&&((i=n.charAt(r))>="a"&&i<="z"||i>="A"&&i<="Z"))r--}else if(i>="a"&&i<="z"||i>="A"&&i<="Z")for(r--;r>=0&&((i=n.charAt(r))>="a"&&i<="z"||i>="A"&&i<="Z");)r--;else return"Error: incorrect syntax in "+n+" at position "+r;n=n.slice(0,r+1)+"factorial("+n.slice(r+1,o)+")"+n.slice(o+1)}return n}function setupLivePreview(n){LivePreviews.hasOwnProperty(n)||(mathRenderer=="MathJax"||mathRenderer=="Katex"?(LivePreviews[n]={delay:mathRenderer=="MathJax"?100:20,finaldelay:1e3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,Init:function(){$("#p"+n).css("positive","relative").append('<span id="lpbuf1'+n+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+n+'" style="visibility:hidden;position:absolute;"></span>'),this.preview=document.getElementById("lpbuf1"+n),this.buffer=document.getElementById("lpbuf2"+n)},SwapBuffers:function(){var n=this.preview,t=this.buffer;this.buffer=n,this.preview=t,n.style.visibility="hidden",n.style.position="absolute",t.style.position="",t.style.visibility=""},Update:function(){this.timeout&&clearTimeout(this.timeout),this.finaltimeout&&clearTimeout(this.finaltimeout),this.timeout=setTimeout(this.callback,this.delay),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(n){this.buffer.innerHTML=this.oldtext=n,this.mjRunning=!0,this.RenderBuffer()},RenderBuffer:function(){mathRenderer=="MathJax"?MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):mathRenderer=="Katex"&&(renderMathInElement(this.buffer),$(this.buffer).children(".mj").length>0?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){$("#pbtn"+n).trigger("click")},preformat:function(t){if(intcalctoproc.hasOwnProperty(n))calcformat[n].match(/inequality/)?(t=t.replace("<=","le").replace(">=","ge").replace("<","lt").replace(">","gt"),t.match(/all\s*real/i)&&(t="text("+t+")")):t=t.replace(/U/g,"uu");else if(vlist.hasOwnProperty(n))t=AMnumfuncPrepVar(n,t)[1];else if(calcformat.hasOwnProperty(n)){var i=calcformat[n];i.indexOf("list")==-1&&i.indexOf("set")==-1&&(t=t.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"))}return t},CreatePreview:function(){var t;(this.timeout=null,this.mjPending)||(t=document.getElementById("tc"+n)==null?document.getElementById("qn"+n).value:document.getElementById("tc"+n).value,t!==this.oldtext)&&(this.mjRunning?(this.mjPending=!0,MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=t,this.buffer.innerHTML="`"+this.preformat(t)+"`",this.mjRunning=!0,this.RenderBuffer()))},PreviewDone:function(){this.mjRunning=this.mjPending=!1,this.SwapBuffers(),updateeeddpos(),updateehpos()}},LivePreviews[n].callback=MathJax.Callback(["CreatePreview",LivePreviews[n]]),LivePreviews[n].callback.autoReset=!0,LivePreviews[n].Init()):LivePreviews[n]={finaldelay:1e3,finaltimeout:null,Update:function(){this.finaltimeout&&clearTimeout(this.finaltimeout),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(t){var i=document.getElementById("p"+n);i.innerHTML=t,rendermathnode(i)},DoFinalPreview:function(){$("#pbtn"+n).trigger("click")}})}function updateLivePreview(n){var t=n.id.substr(2);setupLivePreview(t),LivePreviews[t].Update()}function normalizemathunicode(n){return n=n.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,""),n=n.replace(/\u2013|\u2014|\u2015|\u2212/g,"-"),n=n.replace(/\u2044|\u2215/g,"/"),n=n.replace(/∞/g,"oo").replace(/≤/g,"<=").replace(/≥/g,">=").replace(/∪/g,"U"),n=n.replace(/±/g,"+-").replace(/÷/g,"/").replace(/·|✕|×|⋅/g,"*"),n=n.replace(/√/g,"sqrt").replace(/∛/g,"root(3)"),n=n.replace(/²/g,"^2").replace(/³/g,"^3"),n=n.replace(/\bOO\b/i,"oo"),n=n.replace(/θ/,"theta").replace(/φ/,"phi").replace(/π/,"pi").replace(/σ/,"sigma").replace(/μ/,"mu"),n=n.replace(/α/,"alpha").replace(/β/,"beta").replace(/γ/,"gamma").replace(/δ/,"delta").replace(/ε/,"epsilon").replace(/κ/,"kappa"),n=n.replace(/λ/,"lambda").replace(/ρ/,"rho").replace(/τ/,"tau").replace(/χ/,"chi").replace(/ω/,"omega"),n=n.replace(/Ω/,"Omega").replace(/Γ/,"Gamma").replace(/Φ/,"Phi").replace(/Δ/,"Delta").replace(/Σ/,"Sigma")}function wrapAMnotice(n){return'<span class="AMHnotice">'+n+"</span>"}function calculate(n,t,i){var r=document.getElementById(n).value,f,e,u,evalstr,res,o;for(r=normalizemathunicode(r),r=r.replace(/=/,""),i.indexOf("list")!=-1?f=r.split(/,/):i.indexOf("set")!=-1?f=r.replace(/[\{\}]/g,"").split(/,/):(f=[],f[0]=r),e=0;e<f.length;e++){if(str=f[e],str=str.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"),u="",str.match(/DNE/i))str=str.toUpperCase();else if(str.match(/oo$/)||str.match(/oo\W/))str="`"+str+"`";else{u+=singlevalsyntaxcheck(str,i),str.match(/,/)&&(u+=_("Invalid use of a comma.")),i.indexOf("allowxtimes")!=-1&&(str=str.replace(/(x|X|\u00D7)/,"*")),i.indexOf("mixed")!=-1?str=str.replace(/_/," "):i.indexOf("scinot")!=-1?str=str.replace(/(x|X|\u00D7)/,"xx"):(str=str.replace(/([0-9])\s+([0-9])/g,"$1*$2"),str=str.replace(/\s/g,"")),u+=syntaxcheckexpr(str,i);try{evalstr=str,evalstr=evalstr.replace(",","*NaN*"),evalstr.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(evalstr=evalstr.replace(/%/,"")+"/100"),i.indexOf("mixed")!=-1&&(evalstr=evalstr.replace(/(\d+)\s+(\d+\s*\/\s*\d+)/,"($1+$2)")),i.indexOf("scinot")!=-1&&(evalstr=evalstr.replace("xx","*"));with(Math)res=eval(mathjs(evalstr))}catch(s){u=_("syntax incomplete")+". "+u,res=NaN}isNaN(res)||res=="Infinity"?str!=""&&(str="`"+str+"` = "+_("undefined")+". "+wrapAMnotice(u)):str=i.indexOf("fraction")!=-1||i.indexOf("reducedfraction")!=-1||i.indexOf("mixednumber")!=-1||i.indexOf("scinot")!=-1||i.indexOf("noval")!=-1?"`"+str+"` "+wrapAMnotice(u):"`"+str+" =` "+(Math.abs(res)<1e-15?0:res)+". "+wrapAMnotice(u)}f[e]=str+" "}r=f.join(", "),i.indexOf("set")!=-1&&(document.getElementById(n).value.match(/^\s*{.*?}\s*$/)?r="{"+r+"}":r+=wrapAMnotice(_("syntax error: this answer must be in set notation, a list wrapped in braces like {1,2,3}"))),o=t.substr(1),setupLivePreview(o),LivePreviews[o].RenderNow(r)}function ineqtointerval(n){var r,t;for(n=n.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"),r=n.split(/or/),i=0;i<r.length;i++)str=r[i],t="",(pat=str.match(/^([^<]+)\s*(<=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*(<=?)([^<]+)$/))?(t+=pat[2]=="<="?"[":"(",t+=pat[1]+","+pat[5],t+=pat[4]=="<="?"]":")"):(pat=str.match(/^([^>]+)\s*(>=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*(>=?)([^>]+)$/))?(t+=pat[4]==">="?"[":"(",t+=pat[5]+","+pat[1],t+=pat[2]==">="?"]":")"):(pat=str.match(/^([^><]+)\s*([><]=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*$/))?pat[2]==">"?t="(-oo,"+pat[1]+")":pat[2]==">="?t="(-oo,"+pat[1]+"]":pat[2]=="<"?t="("+pat[1]+",oo)":pat[2]=="<="&&(t="["+pat[1]+",oo)"):(pat=str.match(/^\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*([><]=?)\s*([^><]+)$/))?pat[2]=="<"?t="(-oo,"+pat[3]+")":pat[2]=="<="?t="(-oo,"+pat[3]+"]":pat[2]==">"?t="("+pat[3]+",oo)":pat[2]==">="&&(t="["+pat[3]+",oo)"):t=str.match(/all\s*real/i)?"(-oo,oo)":"",r[i]=t;return t=r.join("U")}function intcalculate(n,t,r){var u=document.getElementById(n).value,e,o,f,a,h,s,p,l,c,res,v;if(u=normalizemathunicode(u),u.match(/DNE/i))u=u.toUpperCase();else if(u.replace(/\s+/g,"")=="")u=_("no answer given");else{if(e=[],o=[],r.indexOf("inequality")!=-1){u=u.replace(/or/g," or "),f=u,u=ineqtointerval(u);var b=str.match(/\b([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+\b)/),w=str.match(/([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)/),y=b!=null?b[1]:w!=null?w[1]:""}else f=u,u=u.replace(/\s+/g,"");if(r.indexOf("list")!=-1){for(a=0,s=[],h=1;h<u.length-1;h++)u.charAt(h)==","&&(u.charAt(h-1)==")"||u.charAt(h-1)=="]")&&(u.charAt(h+1)=="("||u.charAt(h+1)=="[")&&(s.push(u.substring(a,h)),a=h+1);s.push(u.substring(a))}else s=u.split(/U/i);for(p=!0,l="",i=0;i<s.length;i++){if(str=s[i],sm=str.charAt(0),em=str.charAt(str.length-1),vals=str.substring(1,str.length-1),vals=vals.split(/,/),vals.length!=2||sm!="("&&sm!="["||em!=")"&&em!="]"){r.indexOf("inequality")!=-1?(f=f.replace("<=","le").replace(">=","ge").replace("<","lt").replace(">","gt"),u="`"+f+"`: "+wrapAMnotice(_("invalid inequality notation"))):u="`"+f.replace(/U/g,"uu")+"`: "+wrapAMnotice(_("invalid interval notation")),p=!1;break}for(j=0;j<2;j++)if(vals[j].match(/oo$/)||vals[j].match(/oo\W/))e[j]=vals[j];else{if(c="",res=NaN,c+=singlevalsyntaxcheck(vals[j],r),vals[j]=r.indexOf("mixed")!=-1?vals[j].replace(/_/," "):vals[j].replace(/\s/g,""),c+=syntaxcheckexpr(vals[j],r),c=="")try{with(Math)res=eval(mathjs(vals[j]))}catch(k){c=_("syntax incomplete")+". "}isNaN(res)||res=="Infinity"?e[j]=_("undefined"):(vals[j]=vals[j],e[j]=(Math.abs(res)<1e-15?0:res).toString()),c!=""&&(l+=c)}s[i]=sm+vals[0]+","+vals[1]+em,r.indexOf("inequality")!=-1?(o[i]=e[0].match(/oo/)?e[1].match(/oo/)?"RR":y+(em=="]"?"le":"lt")+e[1]:e[1].match(/oo/)?y+(sm=="["?"ge":"gt")+e[0]:e[0]+(sm=="["?"le":"lt")+y+(em=="]"?"le":"lt")+e[1],o[i]=o[i].replace("undefined",'"undefined"')):o[i]=sm+e[0]+","+e[1]+em}p&&(r.indexOf("inequality")!=-1?f.match(/all\s*real/)?u=f:(f=f.replace(/or/g,' \\ "or" \\ '),f=f.replace(/<=/g,"le"),f=f.replace(/>=/g,"ge"),f=f.replace(/</g,"lt"),f=f.replace(/>/g,"gt"),u=r.indexOf("fraction")!=-1||r.indexOf("reducedfraction")!=-1||r.indexOf("mixednumber")!=-1||r.indexOf("scinot")!=-1||r.indexOf("noval")!=-1?"`"+f+"`. "+wrapAMnotice(l):"`"+f+"= "+o.join(' \\ "or" \\ ')+"`. "+wrapAMnotice(l)):u=r.indexOf("fraction")!=-1||r.indexOf("reducedfraction")!=-1||r.indexOf("mixednumber")!=-1||r.indexOf("scinot")!=-1||r.indexOf("noval")!=-1?"`"+s.join("uu")+"`. "+wrapAMnotice(l):r.indexOf("list")!=-1?"`"+s.join(",")+"` = "+o.join(" , ")+". "+wrapAMnotice(l):"`"+s.join("uu")+"` = "+o.join(" U ")+". "+wrapAMnotice(l))}v=t.substr(1),setupLivePreview(v),LivePreviews[v].RenderNow(u)}function ntuplecalc(n,t,i){var r=document.getElementById(n).value,u,res,c;if(r=normalizemathunicode(r),r=r.replace(/\s+/g,""),r.match(/DNE/i))r=r.toUpperCase(),f="DNE",outstr="DNE";else{var f="",e=0,h=0,o="",s=!0;for(r.charAt(0).match(/[\(\[\<\{]/)||(s=!1),u=0;u<r.length;u++)if(dec=!1,e==0&&(f+=r.charAt(u),h=u+1,r.charAt(u)==","&&(r.charAt(u+1).match(/[\(\[\<\{]/)&&r.charAt(u-1).match(/[\)\]\>\}]/)||(s=!1))),r.charAt(u).match(/[\(\[\<\{]/)?e++:r.charAt(u).match(/[\)\]\>\}]/)&&(e--,dec=!0),e==0&&dec||e==1&&r.charAt(u)==","){sub=r.substring(h,u),res=NaN;try{with(Math)res=eval(mathjs(sub))}catch(l){o+=_("syntax incomplete")+". "}o+=singlevalsyntaxcheck(sub,i),sub=i.indexOf("mixed")!=-1?sub.replace(/_/," "):sub.replace(/\s/g,""),o+=syntaxcheckexpr(sub,i),f+=isNaN(res)||res=="Infinity"?_("undefined"):res,f+=r.charAt(u),h=u+1}e!=0&&(s=!1),s==!1&&(o+=_("Invalid notation")+". "),outstr=i.indexOf("fraction")!=-1||i.indexOf("reducedfraction")!=-1||i.indexOf("mixednumber")!=-1||i.indexOf("scinot")!=-1||i.indexOf("noval")!=-1||s==!1?"`"+r+"`. "+wrapAMnotice(o):"`"+r+"` = "+f+". "+wrapAMnotice(o)}return t!=null&&(c=t.substr(1),setupLivePreview(c),LivePreviews[c].RenderNow(outstr)),f}function complexcalc(n,t,i){var r=document.getElementById(n).value,f,s,u,o,e,prep,h,real,imag,c;if(r=normalizemathunicode(r),r=r.replace(/\s+/g,""),r.match(/DNE/i))r=r.toUpperCase(),f="DNE",s="DNE";else{for(f="",u="",o=r.split(","),e=0;e<o.length;e++){prep=mathjs(o[e],"i"),i.indexOf("sloppycomplex")==-1&&(h=parsecomplex(o[e]),u+=singlevalsyntaxcheck(h[0],i),u+=singlevalsyntaxcheck(h[1],i)),u+=syntaxcheckexpr(o[e],i);try{with(Math)real=scopedeval("var i=0;"+prep);with(Math)imag=scopedeval("var i=1;"+prep)}catch(l){u+=_("syntax incomplete")}if((real=="synerr"||imag=="synerr")&&(u+=_("syntax incomplete"),real=NaN),isNaN(real)||real=="Infinity"||isNaN(imag)||imag=="Infinity"){f+=_("undefined");break}else imag-=real,e!=0&&(f+=","),f+=real+(imag>=0?"+":"")+imag+"i"}s=i.indexOf("fraction")!=-1||i.indexOf("reducedfraction")!=-1||i.indexOf("mixednumber")!=-1||i.indexOf("scinot")!=-1||i.indexOf("noval")!=-1?"`"+r+"`. "+wrapAMnotice(u):"`"+r+"` = "+f+". "+wrapAMnotice(u)}return t!=null&&(c=t.substr(1),setupLivePreview(c),LivePreviews[c].RenderNow(s)),f}function parsecomplex(n){var r,t,f,o,i,e,u,s;if(n=n.replace(/\s/,""),n=n.replace(/sin/,"s$n"),n=n.replace(/pi/,"p$"),s=n.length,n.split("i").length>2)return _("error - more than 1 i in expression");if(i=n.indexOf("i"),i==-1)r=n,t="0";else{for(o=0,u=i-1;u>0;u--)if(f=n.charAt(u),f==")")o++;else if(f=="(")o--;else if((f=="+"||f=="-")&&o==0)break;for(o=0,e=i+1;e<s;e++)if(f=n.charAt(e),f=="(")o++;else if(f==")")o--;else if((f=="+"||f=="-")&&o==0)break;if(i-u>1&&e-i>1)return _("error - invalid form");if(i-u>1)t=n.substr(u,i-u),r=n.substr(0,u)+n.substr(i+1);else if(e-i>1)if(i>0){if(n.charAt(i-1)!="+"&&n.charAt(i-1)!="-")return _("error - invalid form");t=n.charAt(i-1)+n.substr(i+1+(n.charAt(i+1)=="*"?1:0),e-i-1),r=n.substr(0,i-1)+n.substr(e)}else t=n.substr(i+1,e-i-1),r=n.substr(0,i)+n.substr(e);else t=n.charAt(u)=="+"?"1":n.charAt(u)=="-"?"-1":i==0?"1":n.charAt(u),r=(i>0?n.substr(0,u):"")+n.substr(i+1);r==""&&(r="0"),t.charAt(0)=="/"?t="1"+t:(t.charAt(0)=="+"||t.charAt(0)=="-")&&t.charAt(1)=="/"&&(t=t.charAt(0)+"1"+t.substr(1)),t.charAt(t.length-1)=="*"&&(t=t.substr(0,t.length-1)),t.charAt(0)=="+"&&(t=t.substr(1)),r.charAt(0)=="+"&&(r=r.substr(1))}return r=r.replace("s$n","sin"),r=r.replace("p$","pi"),t=t.replace("s$n","sin"),t=t.replace("p$","pi"),[r,t]}function matrixcalc(n,t,i,r){function p(estr){var n="",res;try{with(Math)res=eval(mathjs(estr))}catch(t){n=_("syntax incomplete")}return isNaN(res)||res=="Infinity"?estr!=""&&(estr=_("undefined")):estr=(Math.abs(res)<1e-15?0:res)+n,estr}var l,a,o,c,h,s,w,f;if(i!=null&&r!=null){var y=0,e="[",u="[";for(l=0;l<i;l++){for(l>0&&(e+=",",u+=","),e+="(",u+="(",a=0;a<r;a++)a>0&&(e+=",",u+=","),val=normalizemathunicode(document.getElementById(n+"-"+y).value),e+=val,u+=p(val),y++;e+=")",u+=")"}e+="]",u+="]"}else{var e=normalizemathunicode(document.getElementById(n).value),u=e,v=0;for(u=u.replace("[","("),u=u.replace("]",")"),u=u.replace(/\s+/g,""),o=[],u=u.substring(1,u.length-1),c=0,f=0;f<u.length;f++)u.charAt(f)=="("?v++:u.charAt(f)==")"?v--:u.charAt(f)==","&&v==0&&(o[o.length]=u.substring(c+1,f-1),c=f+1);for(o[o.length]=u.substring(c+1,u.length-1),f=0;f<o.length;f++){for(calclist2=o[f].split(","),h=0;h<calclist2.length;h++)calclist2[h]=p(calclist2[h]);o[f]=calclist2.join(",")}u="[("+o.join("),(")+")]"}if(e="`"+e+"` = `"+u+"`",t!=null){for(s=document.getElementById(t),w=s.childNodes.length,f=0;f<w;f++)s.removeChild(s.firstChild);s.appendChild(document.createTextNode(e)),noMathRender||rendermathnode(s)}return u}function mathjsformat(n,t){var i=document.getElementById(n).value,r=document.getElementById(t);r.value=mathjs(i)}function stringqpreview(n,t){var r=document.getElementById(n).value,i=t.substr(1);setupLivePreview(i),LivePreviews[i].RenderNow("`"+r+"`")}function AMnumfuncPrepVar(n,t){var v=vlist[n],y=flist[n],r=v.split("|"),o,u,e,h,s,i,c,f,l,a;for(t=t.replace(/,/g,""),t=normalizemathunicode(t),o=[],u=t,u=u.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex),i=0;i<r.length;i++)if(r[i]=="varE")t=t.replace("E","varE"),u=u.replace("E","varE");else{for(o[i]=!1,e=0;e<r.length;e++)if(i!=e&&r[e].toLowerCase()==r[i].toLowerCase()&&r[e]!=r[i]){o[i]=!0;break}o[i]||(t=t.replace(new RegExp(r[i],"gi"),r[i]),u=u.replace(new RegExp(r[i],"gi"),r[i]))}for(h=[],i=0;i<r.length;i++)r[i].length>1&&(c=!1,arraysearch(r[i].toLowerCase(),greekletters)!=-1&&(c=!0),r[i].match(/^\w+_\w+$/)?(s=o[i]?"g":"gi",f=new RegExp(/^(\w+)_(\w+)$/,s).exec(r[i]),l=new RegExp(f[1]+"_\\("+f[2]+"\\)",s),u=u.replace(l,r[i]),t=t.replace(l,r[i]),f[1].length>1&&arraysearch(f[1].toLowerCase(),greekletters)==-1&&(f[1]='"'+f[1]+'"'),f[2].length>1&&arraysearch(f[2].toLowerCase(),greekletters)==-1&&(f[2]='"'+f[2]+'"'),u=u.replace(new RegExp(f[0],s),f[1]+"_"+f[2]),t=t.replace(new RegExp(f[0],"g"),"repvars"+i),r[i]="repvars"+i):c||r[i]=="varE"||h.push(r[i]));return h.length>0&&(vltq=h.join("|"),a=new RegExp("("+vltq+")","g"),u=u.replace(a,'"$1"')),u=u.replace("varE","E"),u=u.replace(/@(\d+)@/g,indextofunc),[t,u,r.join("|")]}function AMpreview(n,t){var r=n.slice(2),s=AMnumfuncPrepVar(r,document.getElementById(n).value),u=s[0],v=s[1],h=s[2],l=flist[r],a,totest,e,res,o;ptlist=pts[r].split(",");var i="",c=0,res=NaN,f=!1;for(iseqn[r]==1?(u.match(/=/)?u.match(/=/g).length>1&&(f=!0):f=!0,u=u.replace(/(.*)=(.*)/,"$1-($2)")):u.match(/=/)||(f=!0),l!=""&&(reg=new RegExp("("+l+")\\(","g"),u=u.replace(reg,"$1*sin($1+")),vars=h.split("|"),a=mathjs(u,h);c<ptlist.length&&(isNaN(res)||res=="Infinity");){for(totest="",testvals=ptlist[c].split("~"),e=0;e<vars.length;e++)totest+="var "+vars[e]+"="+testvals[e]+";";totest+=a,i=_("syntax ok");try{with(Math)res=scopedeval(totest)}catch(y){i=_("syntax error")}res=="synerr"&&(i=_("syntax error")),c++}o=syntaxcheckexpr(u,"",h),(isNaN(res)||res=="Infinity")&&(i=_("syntax error")),o!=""&&(i+=i==_("syntax ok")?". "+_("warning")+": "+o:". "+o),iseqn[r]==1&&f?i=_("syntax error: this is not an equation"):typeof iseqn[r]!="undefined"||f||(i=_("syntax error: you gave an equation, not an expression")),r=t.substr(1),setupLivePreview(r),LivePreviews[r].RenderNow("`"+v+"` "+wrapAMnotice(i))}function AMmathpreview(n,t){for(var u=document.getElementById(n).value,i=document.getElementById(t),f=i.childNodes.length,r=0;r<f;r++)i.removeChild(i.firstChild);i.appendChild(document.createTextNode("`"+u+"`")),noMathRender||rendermathnode(i)}function singlevalsyntaxcheck(n,t){if(n.match(/DNE/i)||n.match(/oo$/)||n.match(/oo\W/))return"";if(t.indexOf("fraction")!=-1||t.indexOf("reducedfraction")!=-1){if(n=n.replace(/\s/g,""),!n.match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)&&!n.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)&&!n.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+". "}else if(t.indexOf("fracordec")!=-1){if(n=n.replace(/\s/g,""),!n.match(/^\-?\(?\d+\s*\/\s*\-?\d+\)?$/)&&!n.match(/^\-?\d+$/)&&!n.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _(" invalid entry format")+". "}else if(t.indexOf("mixednumber")!=-1){if(!n.match(/^\s*\-?\s*\d+\s*(_|\s)\s*\d+\s*\/\s*\d+\s*$/)&&!n.match(/^\s*?\-?\d+\s*$/)&&!n.match(/^\s*\-?\d+\s*\/\s*\-?\d+\s*$/))return _("not a valid mixed number")+". ";n=n.replace(/_/," ")}else if(t.indexOf("scinot")!=-1&&(n=n.replace(/\s/g,""),n=n.replace(/(x|X|\u00D7)/,"xx"),!n.match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\-?\d+\)?)$/)))return _("not valid scientific notation")+". ";return""}function syntaxcheckexpr(n,t,i){var r="",f,e,u;for(t.indexOf("notrig")!=-1&&n.match(/(sin|cos|tan|cot|sec|csc)/i)?r+=_("no trig functions allowed")+". ":t.indexOf("nodecimal")!=-1&&n.indexOf(".")!=-1&&(r+=_("no decimals allowed")+". "),f=0,e=0,u=0;u<n.length;u++)n.charAt(u)=="("?f++:n.charAt(u)==")"?f--:n.charAt(u)=="["?e++:n.charAt(u)=="]"&&e--;return(f!=0||e!=0)&&(r+=" ("+_("unmatched parens")+"). "),reg=i?new RegExp("(sqrt|ln|log|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+i+"|\\d+)","i"):new RegExp("(sqrt|ln|log|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\\d+)","i"),errstuff=n.match(reg),errstuff!=null&&(r+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. "),i&&(reg=new RegExp("(repvars\\d+|"+i+"|arc|sqrt|root|ln|log|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|e|sign|DNE|oo)","ig"),n.replace(reg,"").match(/[a-zA-Z]/)&&(r+=_(" Check your variables - you might be using an incorrect one")+". ")),n.match(/\|/)&&(r+=_(" Use abs(x) instead of |x| for absolute values")+". "),n.match(/%/)&&!n.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(r+=_(" Do not use the percent symbol, %")+". "),r}function doonsubmit(n,t,i){var a,h,e,v,u,o,res,r,f,j,c,l,fj,s;for(r in callbackstack)callbackstack[r](r);if(n!=null){if(n.className=="submitted")return alert(_("You have already submitted this page.  Please be patient while your submission is processed.")),n.className="submitted2",!1;if(n.className=="submitted2")return!1;if(n.className="submitted",!i&&(a=t?confirmSubmit2(n):confirmSubmit(n),!a))return n.className="",!1}imathasDraw.encodea11ydraw();for(r in intcalctoproc)if(r=parseInt(r),document.getElementById("tc"+r)!=null){if(fullstr=document.getElementById("tc"+r).value,fullstr=fullstr.replace(/\s+/g,""),fullstr=normalizemathunicode(fullstr),fullstr.match(/DNE/i))fullstr=fullstr.toUpperCase();else{if(calcformat[r].indexOf("inequality")!=-1&&(fullstr=ineqtointerval(fullstr)),calcformat[r].indexOf("list")!=-1){for(h=0,u=[],e=1;e<fullstr.length-1;e++)fullstr.charAt(e)==","&&(fullstr.charAt(e-1)==")"||fullstr.charAt(e-1)=="]")&&(fullstr.charAt(e+1)=="("||fullstr.charAt(e+1)=="[")&&(u.push(fullstr.substring(h,e)),h=e+1);u.push(fullstr.substring(h))}else u=fullstr.split(/U/i);for(k=0;k<u.length;k++)if(str=u[k],str.length>0&&str.match(/,/)){for(sm=str.charAt(0),em=str.charAt(str.length-1),vals=str.substring(1,str.length-1),vals=vals.split(/,/),j=0;j<2;j++)if(!vals[j].match(/oo$/)&&!vals[j].match(/oo\W/)){v="";try{with(Math)res=eval(mathjs(vals[j]))}catch(y){v="syntax incomplete"}isNaN(res)||res=="Infinity"||(vals[j]=(Math.abs(res)<1e-15?0:res)+v)}u[k]=sm+vals[0]+","+vals[1]+em}fullstr=calcformat[r].indexOf("list")!=-1?u.join(","):u.join("U")}document.getElementById("qn"+r).value=fullstr}for(r in calctoproc)if(r=parseInt(r),document.getElementById("tc"+r)!=null){if(str=document.getElementById("tc"+r).value,str=normalizemathunicode(str),str=str.replace(/=/,""),calcformat[r].indexOf("list")!=-1)u=str.split(/,/);else if(calcformat[r].indexOf("set")!=-1)if(str.match(/^\s*{.*?}\s*$/))u=str.replace(/^\s*{(.*?)}\s*$/,"$1").split(/,/);else continue;else u=[],u[0]=str;for(o=0;o<u.length;o++){if(str=u[o],str=str.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"),str=str.replace(",","*NaN*"),(calcformat[r].indexOf("scinot")!=-1||calcformat[r].indexOf("allowxtimes")!=-1)&&(str=str.replace(/(x|X|\u00D7)/,"*")),str.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(str=str.replace(/%/,"")+"/100"),str=str.replace(/(\d+)\s*_\s*(\d+\s*\/\s*\d+)/,"($1+$2)"),calcformat[r].indexOf("mixed")!=-1&&(str=str.replace(/(\d+)\s+(\d+\s*\/\s*\d+)/,"($1+$2)")),str.match(/^\s*$/))res="";else if(str.match(/oo$/)||str.match(/oo\W/))res=str;else if(str.match(/DNE/i))res=str.toUpperCase();else try{with(Math)res=eval(mathjs(str))}catch(y){res=""}u[o]=res}document.getElementById("qn"+r).value=u.join(",")}for(r in matcalctoproc){if(r=parseInt(r),matsize[r]!=null){if(document.getElementById("qn"+r+"-0")==null)continue;msize=matsize[r].split(","),str=matrixcalc("qn"+r,null,msize[0],msize[1])}else{if(document.getElementById("tc"+r)==null)continue;str=matrixcalc("tc"+r,null)}document.getElementById("qn"+r).value=str}for(r in ntupletoproc)(r=parseInt(r),document.getElementById("tc"+r)!=null)&&(str=ntuplecalc("tc"+r,null,""),document.getElementById("qn"+r).value=str);for(r in complextoproc)(r=parseInt(r),document.getElementById("tc"+r)!=null)&&(str=complexcalc("tc"+r,null,""),document.getElementById("qn"+r).value=str);for(r in functoproc)if(r=parseInt(r),document.getElementById("tc"+r)!=null){if(str=document.getElementById("tc"+r).value,str=str.replace(/,/g,""),str=normalizemathunicode(str),iseqn[r]==1)str=str.replace(/(.*)=(.*)/,"$1-($2)");else if(str.match("="))continue;for(fl=flist[r],varlist=vlist[r],vars=varlist.split("|"),f=0;f<vars.length;f++){for(foundaltcap=!1,j=0;j<vars.length;j++)if(f!=j&&vars[j].toLowerCase()==vars[f].toLowerCase()&&vars[j]!=vars[f]){foundaltcap=!0;break}foundaltcap?regmod="g":(str=str.replace(new RegExp(vars[f],"gi"),vars[f]),regmod="gi"),vars[f].length>2&&vars[f].match(/^\w+_\w+$/)?(c=vars[f].match(/^(\w+)_(\w+)$/),str=str.replace(new RegExp(c[1]+"_\\("+c[2]+"\\)",regmod),vars[f]),str=str.replace(new RegExp(c[0],"g"),"repvars"+f),vars[f]="repvars"+f):vars[f]=="varE"&&(str=str.replace("E","varE"))}for(varlist=vars.join("|"),fl!=""&&(reg=new RegExp("("+fl+")\\(","g"),str=str.replace(reg,"$1*sin($1+")),vars=varlist.split("|"),l=document.getElementById("qn"+r),l.value=mathjs(str,varlist),ptlist=pts[r].split(","),vals=[],fj=0;fj<ptlist.length;fj++){for(inputs=ptlist[fj].split("~"),totest="",s=0;s<inputs.length;s++)totest+="var "+vars[s]+"="+inputs[s]+";";totest+=l.value==""?Math.random()+";":l.value+";";try{with(Math)vals[fj]=scopedeval(totest)}catch(y){vals[fj]=NaN}vals[fj]=="synerr"&&(vals[fj]=NaN)}document.getElementById("qn"+r+"-vals").value=vals.join(",")}return!0}function scopedeval(c){var res;try{with(Math)res=eval(c);return res}catch(n){return"synerr"}}function arraysearch(n,t){for(var i=0;i<t.length;i++)if(t[i]==n)return i;return-1}function toggleinlinebtn(n,t){var r=document.getElementById(n),u,i;r.style.display=r.style.display=="none"?"":"none",t!=null&&(u=document.getElementById(t),i=u.innerHTML,u.innerHTML=i.match(/\+/)?i.replace(/\+/,"-"):i.replace(/\-/,"+"))}function assessbackgsubmit(n,t){var u,f,r,i;if(t!=null&&document.getElementById(t).innerHTML==_("Submitting..."))return!1;if(window.XMLHttpRequest?req=new XMLHttpRequest:window.ActiveXObject&&(req=new ActiveXObject("Microsoft.XMLHTTP")),typeof req!="undefined"){if(typeof tinyMCE!="undefined"&&tinyMCE.triggerSave(),doonsubmit(),params="embedpostback=true",n!=null){for(r=[],u=document.getElementsByTagName("input"),i=0;i<u.length;i++)r.push(u[i]);for(u=document.getElementsByTagName("select"),i=0;i<u.length;i++)r.push(u[i]);for(u=document.getElementsByTagName("textarea"),i=0;i<u.length;i++)r.push(u[i]);for(f=new RegExp("^(qn|tc|qs)("+n+"\\b|"+(n+1)+"\\d{3})"),i=0;i<r.length;i++)r[i].name.match(f)&&(r[i].type!="radio"&&r[i].type!="checkbox"||r[i].checked)&&(params+="&"+r[i].name+"="+encodeURIComponent(r[i].value));params+="&toscore="+n,params+="&verattempts="+document.getElementById("verattempts"+n).value}else{for(r=document.getElementsByTagName("input"),i=0;i<r.length;i++)r[i].name.match(/^(qn|tc)/)&&(r[i].type!="radio"||r[i].type!="checkbox"||r[i].checked)&&(params+="&"+r[i].name+"="+encodeURIComponent(r[i].value));params+="&verattempts="+document.getElementById("verattempts").value}params+="&asidverify="+document.getElementById("asidverify").value,params+="&disptime="+document.getElementById("disptime").value,params+="&isreview="+document.getElementById("isreview").value,t!=null&&(document.getElementById(t).innerHTML=_("Submitting...")),req.open("POST",assesspostbackurl,!0),req.setRequestHeader("Content-type","application/x-www-form-urlencoded"),req.onreadystatechange=function(){assessbackgsubmitCallback(n,t)},req.send(params)}else t!=null&&(document.getElementById(t).innerHTML=_("Error Submitting."))}function assessbackgsubmitCallback(qn,noticetgt){var scripts,resptxt,i,foo,qnlen,pagescroll,B,D,elpos;if(req.readyState==4)if(req.status==200){if(noticetgt!=null&&(document.getElementById(noticetgt).innerHTML=""),qn!=null){for(scripts=[],resptxt=req.responseText;resptxt.indexOf("<script")>-1||resptxt.indexOf("</script")>-1;){var s=resptxt.indexOf("<script"),s_e=resptxt.indexOf(">",s),e=resptxt.indexOf("</script",s),e_e=resptxt.indexOf(">",e);scripts.push(resptxt.substring(s_e+1,e)),resptxt=resptxt.substring(0,s)+resptxt.substring(e_e+1)}for(document.getElementById("embedqwrapper"+qn).innerHTML=resptxt,usingASCIIMath&&rendermathnode(document.getElementById("embedqwrapper"+qn)),usingASCIISvg&&setTimeout("drawPics()",100),usingTinymceEditor&&initeditor("textareas","mceEditor"),initstack.length=0,i=0;i<scripts.length;i++)try{(k=scripts[i].match(/canvases\[(\d+)\]/))&&(typeof G_vmlCanvasManager!="undefined"&&(scripts[i]=scripts[i]+'G_vmlCanvasManager.initElement(document.getElementById("canvas'+k[1]+'"));'),scripts[i]=scripts[i]+"imathasDraw.initCanvases("+k[1]+");"),eval(scripts[i])}catch(ex){}for(i=0;i<initstack.length;i++)foo=initstack[i]();qnlen=(qn+1).toString().length;for(i in LivePreviews)(i==qn||i>999&&i.toString().substr(0,qnlen)==qn+1)&&LivePreviews[i].Init();$(window).trigger("ImathasEmbedReload"),initcreditboxes(),pagescroll=0,typeof window.pageYOffset!="undefined"?pagescroll=window.pageYOffset:(B=document.body,D=document.documentElement,D=D.clientHeight?D:B,pagescroll=D.scrollTop),elpos=findPos(document.getElementById("embedqwrapper"+qn))[1],pagescroll>elpos&&setTimeout(function(){window.scroll(0,elpos)},150)}}else noticetgt!=null&&(document.getElementById(noticetgt).innerHTML=_("Submission Error")+":\n"+req.status+"\n"+req.statusText)}function AutoSuggest(n,t){var r=this,s;this.elem=n,this.suggestions=t,this.eligible=[],this.inputText=null,this.highlighted=-1,this.div=document.getElementById("autosuggest"),this.div==null&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul")));var u=9,f=27,e=38,o=40,h=13;n.setAttribute("autocomplete","off"),n.id||(s="autosuggest"+AutoSuggestIdCounter,AutoSuggestIdCounter++,n.id=s),n.onkeydown=function(n){var t=r.getKeyCode(n);switch(t){case u:r.useSuggestion("tab");break;case h:return r.useSuggestion("enter"),!1;case f:r.hideDiv();break;case e:r.highlighted>0&&r.highlighted--,r.changeHighlight(t);break;case o:r.highlighted<r.eligible.length-1&&r.highlighted++,r.changeHighlight(t)}},n.onkeyup=function(n){var t=r.getKeyCode(n);switch(t){case u:case f:case e:case o:return;default:this.value.length>1?(r.inputText=this.value,r.getEligible(),r.highlighted=r.eligible.length>0?0:-1,r.createDiv(),r.positionDiv(),r.showDiv()):(r.hideDiv(),this.value.length==0&&(r.inputText=""))}},n.onblur=function(){setTimeout(r.hideDiv,100)},this.useSuggestion=function(){this.highlighted>-1?(this.elem.value=this.eligible[this.highlighted],this.hideDiv()):this.hideDiv()},this.showDiv=function(){this.div.style.display="block"},this.hideDiv=function(){r.div.style.display="none",r.highlighted=-1},this.changeHighlight=function(){var t=this.div.getElementsByTagName("LI"),n;for(i in t)n=t[i],n.className=this.highlighted==i?"selected":""},this.positionDiv=function(){var t=this.elem,n=findPos(t);n[1]+=t.offsetHeight,this.div.style.left=n[0]+"px",this.div.style.top=n[1]+"px"},this.createDiv=function(){var n=document.createElement("ul");for(i in this.eligible){var f=this.eligible[i],u=document.createElement("li"),t=document.createElement("a");t.href="#",t.onclick=function(){return!1},t.innerHTML=f,u.appendChild(t),r.highlighted==i&&(u.className="selected"),n.appendChild(u)}this.div.replaceChild(n,this.div.childNodes[0]),n.onmouseover=function(n){for(var t=r.getEventSource(n),u,f;t.parentNode&&t.tagName.toUpperCase()!="LI";)t=t.parentNode;u=r.div.getElementsByTagName("LI");for(i in u)if(f=u[i],f==t){r.highlighted=i;break}r.changeHighlight()},n.onclick=function(n){return r.useSuggestion("click"),r.hideDiv(),r.cancelEvent(n),!1},this.div.className="suggestion_list",this.div.style.position="absolute"},this.getEligible=function(){var r,t,n;if(this.eligible=[],r=",",this.inputText.indexOf(" ")==-1){t=new RegExp("\\b"+this.inputText.toLowerCase());for(i in this.suggestions)n=this.suggestions[i],n.toLowerCase().match(t)&&(this.eligible[this.eligible.length]=n,r+=i+",")}},this.getKeyCode=function(n){return n?n.keyCode:window.event?window.event.keyCode:void 0},this.getEventSource=function(n){return n?n.target:window.event?window.event.srcElement:void 0},this.cancelEvent=function(n){n&&(n.preventDefault(),n.stopPropagation()),window.event&&(window.event.returnValue=!1)}}function isBlank(n){return!n||0===n.length||/^\s*$/.test(n)}function editdebit(n){var t=$("#qn"+(n.id.substr(2)*1-1));!isBlank(n.value)&&t.hasClass("iscredit")&&(t.is("select")?t.css("margin-right",20):t.width(t.width()+20),t.css("padding-left",0),t.removeClass("iscredit"))}function editcredit(n){var t=$("#qn"+(n.id.substr(2)*1-2));isBlank(n.value)||t.hasClass("iscredit")||(t.is("select")?t.css("margin-right",0):t.width(t.width()-20),t.css("padding-left",20),t.addClass("iscredit"))}function initcreditboxes(){$(".creditbox").each(function(n,t){if(!isBlank(t.value)&&$(t).css("padding-left")!=20){var i=$("#qn"+(t.id.substr(2)*1-2));i.is("select")?i.css("margin-right",0):i.width(i.width()-20),i.css("padding-left",20),i.addClass("iscredit")}})}function initqsclickchange(){$("input[id^=qs][value=spec]").each(function(n,t){$(t).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",function(n){n.keyCode!=8&&n.keyCode!=46&&$(t).prop("checked",!0)})})}function assessmentTimer(n,t){function h(){if(i=n-Math.floor((Date.now()-s)/1e3),i<=0){if(i=0,clearInterval(e),t){if(document.getElementById("timelimitholder").className="",document.getElementById("timelimitholder").style.color="#f00",document.getElementById("timelimitholder").innerHTML=_("Time limit expired - submitting now"),document.getElementById("timelimitholder").style.fontSize="300%",document.getElementById("qform")==null){setTimeout("window.location.pathname='"+imasroot+"/assessment/showtest.php?action=skip&superdone=true'",2e3);return}var h=document.getElementById("qform"),c=h.getAttribute("action");return h.setAttribute("action",c+"&superdone=true"),doonsubmit(h,!0,!0)&&setTimeout('document.getElementById("qform").submit()',2e3),0}alert(_("Time Limit has elapsed"))}f=Math.floor(i%60),u=Math.floor(i/60%60),r=Math.floor(i/3600),r==0&&u<=5&&(document.getElementById("timeremaining").style.color="#f00"),r==0&&u==0&&f<=5&&(document.getElementById("timeremaining").style.fontSize="150%"),o=(r>0?r+":":"")+(r>0&&u<10?"0":"")+u+":"+(f<10?"0":"")+f,document.getElementById("timeremaining").innerHTML=o}var s=Date.now(),i,r,u,f,e,o;e=setInterval(h,1e3),$(document).ready(function(){var n=$("#timerwrap"),t=n.position();$(window).scroll(function(){var i=$(window).scrollTop();i>=t.top?n.addClass("sticky"):n.removeClass("sticky")})})}function toggletimer(){$("#timerhide").text()=="[x]"?($("#timercontent").hide(),$("#timerhide").text("["+_("Show Timer")+"]"),$("#timerhide").attr("title","["+_("Show Timer")+"]")):($("#timercontent").show(),$("#timerhide").text("[x]"),$("#timerhide").attr("title",_("Hide Timer")))}function toggleintroshow(n){var t=document.getElementById("introtoggle"+n),i=document.getElementById("intropiece"+n);t.innerHTML.match("Hide")?(t.innerHTML=t.innerHTML.replace("Hide","Show"),i.style.display="none"):(t.innerHTML=t.innerHTML.replace("Show","Hide"),i.style.display="block")}function togglemainintroshow(n){$("#intro").hasClass("hidden")?($(n).html(_("Hide Intro/Instructions")),$("#intro").removeClass("hidden").addClass("intro")):($("#intro").addClass("hidden"),$(n).html(_("Show Intro/Instructions")))}function checkComplete(n){var i,t,r,u,f;if(typeof tinyMCE!="undefined")try{tinyMCE.triggerSave()}catch(e){}if(!n.elements)return!0;for(i=0;i<n.elements.length;i++)if((t=n.elements[i],typeof t.type!="undefined"&&typeof t.name!="undefined"&&t.name!="")&&!$(t).is(":not(:visible)"))if(t.type=="text"||t.type=="textarea"||t.type=="password"||t.type=="file"){if(t.value=="")return!1}else if(t.type.indexOf("select")!=-1){if(t.selectedIndex==-1)return!1}else if(t.type=="radio"){if(r=n[t.name],u=!1,r.length){for(f=0;f<r.length;f++)if(u=r[f].checked)break}else u=t.checked;if(!u)return!1}return!0}function confirmSubmit(n){var i=checkComplete(n),t;return i?!0:(t="Not all question parts have been answered.  Are you sure you want to submit this question?",confirm(t))}function confirmSubmit2(n){var i=checkComplete(n),t;return i?!0:(t="Not all questions have been answered completely.  If you are saving your answers for later, this is fine.  If you are submitting for grading, are you sure you want to submit now?",confirm(t))}function showeh(n){if(eecurel==null){unhideeh(0),el=document.getElementById(n);var t=document.getElementById("eh");n!=ehcurel?(ehcurel=n,p=findPos(el),t.style.display="block",t.style.left=p[0]+"px",t.style.top=p[1]+el.offsetHeight+"px"):(t.style.display="none",ehcurel=null),el.focus()}}function reshrinkeh(n){eecurel==null&&n==ehcurel&&(document.getElementById("ehdd").style.display="block",document.getElementById("eh").style.display="none",ehcurel=null,curehdd=n,unhideeh(0))}function unhideeh(){ehcancelclosetimer()}function hideeh(){ehcurel==null?ehddclosetimer=window.setTimeout(function(){curehdd=null,document.getElementById("ehdd").style.display="none"},250):ehclosetimer=window.setTimeout(reallyhideeh,250)}function reallyhideeh(){var n=document.getElementById("eh");n.style.display="none",ehcurel=null}function ehcancelclosetimer(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null)}function showehdd(n,t,i){if((eecurel==null||eecurel!=n)&&document.getElementById("tips"+i)!=null){if(ehddclosetimer&&n!=curehdd&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),n!=ehcurel){var r=document.getElementById("ehdd"),u=document.getElementById(n);p=findPos(u),document.getElementById("ehddtext").innerHTML=t,document.getElementById("eh").innerHTML=document.getElementById("tips"+i).innerHTML,r.style.display="block",r.style.left=p[0]+"px",r.style.top=p[1]+u.offsetHeight+"px"}curehdd=n}}function updateehpos(){if(curehdd||ehcurel){var i=document.getElementById("eh"),t=document.getElementById("ehdd"),n=document.getElementById(curehdd||ehcurel);p=findPos(n),i.style.left=p[0]+"px",i.style.top=p[1]+n.offsetHeight+"px",t.style.left=p[0]+"px",t.style.top=p[1]+n.offsetHeight+"px"}}var closetimer=0,ddmenuitem=0,homemenuloaded=0,tipobj=0,popupwins=[],GB_loaded,recordedunload,videoembedcounter,funcstoindexarr,AutoSuggestIdCounter;addLoadEvent(setupFormLimiters),GB_loaded=!1,addLoadEvent(setselectbycookie),recordedunload=!1,videoembedcounter=0,jQuery(document).ready(function(n){n(window).on("message",function(t){var u,r,i;if(t.originalEvent.data.match(/lti\.frameResize/))for(u=JSON.parse(t.originalEvent.data),r=document.getElementsByTagName("iframe"),i=0;i<r.length;i++)if(r[i].contentWindow===t.originalEvent.source){n(r[i]).height(u.height);break}})}),jQuery(document).ready(function(n){n("a").each(setuptracklinks).each(addNoopener),n('a[href*="youtu"]').each(setupvideoembeds),n('a[href*="vimeo"]').each(setupvideoembeds),n("body").fitVids(),n('a[target="_blank"]').each(function(){this.href.match(/youtu/)||this.href.match(/vimeo/)||n(this).append(' <img src="'+imasroot+'/img/extlink.png"/>')})}),jQuery.fn.isolatedScroll=function(){return this.bind("mousewheel DOMMouseScroll",function(n){var t=n.wheelDelta||n.originalEvent&&n.originalEvent.wheelDelta||-n.detail,i=this.scrollTop+jQuery(this).outerHeight()-this.scrollHeight>=0,r=this.scrollTop<=0;(t<0&&i||t>0&&r)&&n.preventDefault()}),this},jQuery(document).ready(function(n){for(var t=n(".fixedonscroll"),r=[],i=0;i<t.length;i++)r[i]=n(t[i]).offset().top,n(t[i]).height()>n(window).height()&&(r[i]=-1);t.length>0&&n(t[0]).css("float")=="left"&&n(window).scroll(function(){for(var u=n(window).scrollTop(),i=0;i<t.length;i++)u>r[i]&&r[i]>0?n(t[i]).css("position","fixed").css("top","5px"):n(t[i]).css("position","static")})}),function(n){"use strict";n.fn.fitVids=function(){return this.each(function(){var t=["iframe[src*='player.vimeo.com']","iframe[src*='youtube.com']","iframe[src*='youtube-nocookie.com']"],i=n(this).find(t.join(","));i.each(function(){var t=n(this),r;if(t.closest(".textsegment").length>0)return!0;t.parentsUntil(".intro","table").each(function(){n(this).css("width","100%")});var u=t.attr("height")&&!isNaN(parseInt(t.attr("height"),10))?parseInt(t.attr("height"),10):t.height(),i=isNaN(parseInt(t.attr("width"),10))?t.width():parseInt(t.attr("width"),10),f=u/i;t.attr("id")||(r="fitvid"+Math.floor(Math.random()*999999),t.attr("id",r)),t.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",f*100+"%").wrap('<div class="video-wrapper-wrapper"></div>').parent(".video-wrapper-wrapper").css("max-width",i+"px"),t.removeAttr("height").removeAttr("width").css("height","").css("width","")})})}}(window.jQuery||window.Zepto),jQuery(document).ready(function(n){n(".alts").on("change",function(){var n=this.value.split(":");n.length>1&&setAltSelectors(n[0],n[1])}).each(function(t,i){var r=i.value.split(":");(co=readCookie("alt_store_"+r[0]))!=null?setAltSelectors(r[0],co):n(i).hasClass("setDefault")&&setAltSelectors(r[0],r[1])});n(document).on("keydown",function(t){t.which!==8||n(t.target).is("input[type='text']:not([readonly]),input:not([type]):not([readonly]),input[type='password']:not([readonly]), textarea, [contenteditable='true']")||t.preventDefault()})}),+function(n){"use strict";function r(t){var i=t.attr("data-target"),r;return i||(i=t.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,"")),r=i&&n(i),r&&r.length?r:t.parent()}function u(t){t&&t.which===3||(n(e).remove(),n(i).each(function(){var u=n(this),i=r(u),f={relatedTarget:this};i.hasClass("open")&&(t&&t.type=="click"&&/input|textarea/i.test(t.target.tagName)&&n.contains(i[0],t.target)||(i.trigger(t=n.Event("hide.bs.dropdown",f)),t.isDefaultPrevented())||(u.attr("aria-expanded","false"),i.removeClass("open").trigger("hidden.bs.dropdown",f)))}))}function o(i){return this.each(function(){var r=n(this),u=r.data("bs.dropdown");u||r.data("bs.dropdown",u=new t(this)),typeof i=="string"&&u[i].call(r)})}var e=".dropdown-backdrop",i='[data-toggle="dropdown"]',t=function(t){n(t).on("click.bs.dropdown",this.toggle)},f;t.VERSION="3.3.5",t.prototype.toggle=function(t){var f=n(this),i,o,e;if(!f.is(".disabled, :disabled")){if(i=r(f),o=i.hasClass("open"),u(),!o){if("ontouchstart"in document.documentElement&&!i.closest(".navbar-nav").length)n(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(n(this)).on("click",u);if(e={relatedTarget:this},i.trigger(t=n.Event("show.bs.dropdown",e)),t.isDefaultPrevented())return;f.trigger("focus").attr("aria-expanded","true"),i.toggleClass("open").trigger("shown.bs.dropdown",e)}return!1}},t.prototype.keydown=function(t){var e,o,s,h,f,u;if(/(38|40|27|32)/.test(t.which)&&!/input|textarea/i.test(t.target.tagName)&&(e=n(this),t.preventDefault(),t.stopPropagation(),!e.is(".disabled, :disabled"))){if(o=r(e),s=o.hasClass("open"),!s&&t.which!=27||s&&t.which==27)return t.which==27&&o.find(i).trigger("focus"),e.trigger("click");(h=" li:not(.disabled):visible a",f=o.find(".dropdown-menu"+h),f.length)&&(u=f.index(t.target),t.which==38&&u>0&&u--,t.which==40&&u<f.length-1&&u++,~u||(u=0),f.eq(u).trigger("focus"))}},f=n.fn.dropdown,n.fn.dropdown=o,n.fn.dropdown.Constructor=t,n.fn.dropdown.noConflict=function(){return n.fn.dropdown=f,this};n(document).on("click.bs.dropdown.data-api",u).on("click.bs.dropdown.data-api",".dropdown form",function(n){n.stopPropagation()}).on("click.bs.dropdown.data-api",i,t.prototype.toggle).on("keydown.bs.dropdown.data-api",i,t.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",t.prototype.keydown)}(jQuery);var pi=Math.PI,ln=Math.log,e=Math.E,arcsin=Math.asin,arccos=Math.acos,arctan=Math.atan,sec=function(n){return 1/Math.cos(n)},csc=function(n){return 1/Math.sin(n)},cot=function(n){return 1/Math.tan(n)},arcsec=function(n){return arccos(1/n)},arccsc=function(n){return arcsin(1/n)},arccot=function(n){return arctan(1/n)},sinh=function(n){return(Math.exp(n)-Math.exp(-n))/2},cosh=function(n){return(Math.exp(n)+Math.exp(-n))/2},tanh=function(n){return(Math.exp(n)-Math.exp(-n))/(Math.exp(n)+Math.exp(-n))},sech=function(n){return 1/cosh(n)},csch=function(n){return 1/sinh(n)},coth=function(n){return 1/tanh(n)},arcsinh=function(n){return ln(n+Math.sqrt(n*n+1))},arccosh=function(n){return ln(n+Math.sqrt(n*n-1))},arctanh=function(n){return ln((1+n)/(1-n))/2},sech=function(n){return 1/cosh(n)},csch=function(n){return 1/sinh(n)},coth=function(n){return 1/tanh(n)},arcsech=function(n){return arccosh(1/n)},arccsch=function(n){return arcsinh(1/n)},arccoth=function(n){return arctanh(1/n)},sign=function(n){return n==0?0:n<0?-1:1},logten=function(n){return Math.LOG10E*Math.log(n)},sinn=function(n,t){return Math.pow(Math.sin(t),n)},cosn=function(n,t){return Math.pow(Math.cos(t),n)},tann=function(n,t){return Math.pow(Math.tan(t),n)},cscn=function(n,t){return 1/Math.pow(Math.sin(t),n)},secn=function(n,t){return 1/Math.pow(Math.cos(t),n)},cotn=function(n,t){return 1/Math.pow(Math.tan(t),n)};funcstoindexarr="sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root|arcsin|arccos|arctan|arcsec|arccsc|arccot|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth".split("|");var updateeeddpos=function(){},updateehpos=function(){},LivePreviews=[];var greekletters=["alpha","beta","chi","delta","epsilon","gamma","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"],calctoproc={},intcalctoproc={},calcformat={},functoproc={},matcalctoproc={},ntupletoproc={},complextoproc={},callbackstack={},matsize={},vlist={},flist={},pts={},iseqn={};AutoSuggestIdCounter=0,initstack.push(initcreditboxes);$(window).on("ImathasEmbedReload",initqsclickchange);initstack.push(initqsclickchange);var canvases=[],drawla=[],imathasDraw=function(n){function li(n){e[n].length=0,p[n].length=0,a[n].length=0,u[n].length=0,l[n].length=0,f[n].length=0,w[n].length=0,t=n,v(),t=null,s=null,o=null}function vi(n,t){var o=n[0],h,v,i;wt.push(o);var s=n[1].substr(9).split(","),rt=n[2],it=n[3],y=n[4],b=n[5];y==b&&(y=-1,b=1);var k=n[6],g=n[7],st=n[8],ht=document.getElementById("a11ydraw"+o);at[o]=document.getElementById("qn"+o),r[o]={el:ht,xmin:rt,xmax:it,ymin:y,ymax:b,imgborder:k,imgwidth:g,imgheight:st},r[o].pixperx=(g-2*k)/(it-rt),r[o].pixpery=y==b?1:(st-2*k)/(b-y),s[0]=="inequality"?(h=s.shift(),s.length==0?s=["line"]:s[0]=="both"&&(s=["line","parab"])):s[0]=="twopoint"?(h=s.shift(),s.length==0&&(s=["line","parab","abs","circle","dot"])):s[0]=="numberline"?(h="basic",s.shift()):h="basic",r[o].afgroup=h;var c={inequality:{line:[{mode:10,descr:_("Linear inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.2,descr:_("Linear inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}],parab:[{mode:10.3,descr:_("Parabolic inequality with solid line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")},{mode:10.4,descr:_("Parabolic inequality with dashed line"),inN:3,input:_("Enter 2 points on the line, then a third point in the shaded region")}]},twopoint:{line:[{mode:5,descr:_("Line"),inN:2,input:_("Enter two points on the line")}],lineseg:[{mode:5.3,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],ray:[{mode:5.2,descr:_("Ray"),inN:2,input:_("Enter the starting point of the ray and another point on the ray")}],parab:[{mode:6,descr:_("Parabola"),inN:2,input:_("Enter the vertex, then another point on the parabola")}],sqrt:[{mode:6.5,descr:_("Square root"),inN:2,input:_("Enter the starting point of the square root, then another point on the graph")}],abs:[{mode:8,descr:_("Absolute value"),inN:2,input:_("Enter the corner point of the absolute value, then another point on the graph")}],rational:[{mode:8.2,descr:_("Rational"),inN:2,input:_("Enter the point where the vertical and horizontal asymptote cross, then a point on the graph")}],exp:[{mode:8.3,descr:_("Exponential"),inN:2,input:_("Enter two points on the graph")}],circle:[{mode:7,descr:_("Circle"),inN:2,input:_("Enter the center point of the circle, then a point on the graph")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],trig:[{mode:9,descr:_("Cosine"),inN:2,input:_("Enter a point at the start of a phase, then a point half a phase further")},{mode:9.2,descr:_("Sine"),inN:2,input:_("Enter a point at the start of a phase, then a point a quarter phase further")}],vector:[{mode:5.4,descr:_("Vector"),inN:2,input:_("Enter the starting and ending point of the vector")}]},basic:{line:[{mode:0,descr:_("Lines"),inN:"list",input:_("Enter list of points to connect with lines")}],lineseg:[{mode:.5,descr:_("Line segment"),inN:2,input:_("Enter the starting and ending point of the line segment")}],freehand:[{mode:.7,descr:_("Freehand"),inN:"list",input:_("Enter list of points to connect with lines")}],dot:[{mode:1,descr:_("Solid dot"),inN:1,input:_("Enter the coordinates of the dot")}],opendot:[{mode:2,descr:_("Open dot"),inN:1,input:_("Enter the coordinates of the dot")}],polygon:[{mode:1,descr:_("Polygon"),inN:"list",input:_("Enter list of points to place dots connected with lines"),dotline:1}],closedpolygon:[{mode:1,descr:_("Polygon"),inN:"list",input:_("Enter list of points to place dots connected with lines"),dotline:2}]}},ut,ft=[],et=[],ct,ot=[],d;for(i=0;i<s.length;i++)if(c[h].hasOwnProperty(s[i]))for(i==0&&(ut=c[h][s[i]][0].mode),v=0;v<c[h][s[i]].length;v++)ot[c[h][s[i]][v].mode]=c[h][s[i]][v],ft.push(c[h][s[i]][v].mode),d='<option value="'+c[h][s[i]][v].mode+'"',d+=' data-af="'+s[i]+'">'+c[h][s[i]][v].descr+"</option>",et.push(d);if(r[o].defmode=ut,r[o].inputmodes=ft,r[o].selects=et,r[o].moderef=ot,t==null&&e.hasOwnProperty(o)){for(i=0;i<e[o].length;i++)tt(o,0,nt(e[o][i],o));for(i=0;i<p[o].length;i++)tt(o,1,nt(p[o][i],o));for(i=0;i<a[o].length;i++)tt(o,2,nt(a[o][i],o));for(i=0;i<u[o].length;i++)tt(o,l[o][i],nt(u[o][i][0],o)+","+nt(u[o][i][1],o));for(i=0;i<f[o].length;i++)tt(o,w[o][i],nt(f[o][i][0],o)+","+nt(f[o][i][1],o)+","+nt(f[o][i][2],o))}else if(t!=null)for(i=0;i<t.length;i++)tt(o,t[i][0],t[i][1].replace(/\[/g,"(").replace(/\]/g,")"))}function tt(t,i,u){var f=r[t],o=i||f.defmode,s=u||"",h=f.afgroup,e;html='<select aria-label="'+_("Drawing element type")+'" onchange="imathasDraw.changea11ydraw(this,\''+t+"')\">";for(j in f.selects)html+=f.selects[j];html+="</select><br/>",html+='<span class="a11ydrawinstr"></span><br/>',html+='<input type="text" aria-label="'+_("Point list")+'" value="'+s+'"/>',html+='<button type="button" class="imgbutton" onclick="imathasDraw.removea11ydraw(this)">',html+=_("Remove")+"</button>",e=n("<li>",{"class":"a11ydrawrow"}).html(html),n(f.el).append(e),e.find("select").val(o),e.find(".a11ydrawinstr").text(f.moderef[o].input),u||e.find("select").focus()}function tr(t){n(t).parent().remove()}function wi(t,i){var u=n(t).val(),f=r[i].moderef[u];n(t).parent().find(".a11ydrawinstr").text(f.input)}function nt(n,t){var i=r[t],u,f;return u=(n[0]-i.imgborder)/i.pixperx+i.xmin,f=(i.imgheight-n[1]-i.imgborder)/i.pixpery+i.ymin,u=Math.round(u*100)/100,f=Math.round(f*100)/100,"("+u+","+f+")"}function bi(){for(var i=0;i<wt.length;i++){var u=wt[i],t=r[u],f=[],e=[],o=[],s=[],h=[],c=[],l=r[u].afgroup;n("#a11ydraw"+u).find(".a11ydrawrow").each(function(i,r){var u=n(r).find("select").val(),input=n(r).find("input").val(),l,i;for(c.push("["+u+',"'+input+'"]'),input=input.replace(/[\(\)]/g,"").split(/\s*,\s*/),l=[],i=1;i<input.length;i+=2){try{with(Math)input[i-1]=eval(mathjs(input[i-1]))}catch(a){input[i-1]=NaN}try{with(Math)input[i]=eval(mathjs(input[i]))}catch(a){input[i]=NaN}input[i-1]=(input[i-1]-t.xmin)*t.pixperx+t.imgborder,input[i]=t.imgheight-(input[i]-t.ymin)*t.pixpery-t.imgborder,l.push(Math.round(input[i-1])+","+Math.round(input[i]))}u==1?e.push("("+l.join("),(")+")"):u==2?o.push("("+l.join("),(")+")"):u<1?f.push("("+l.join("),(")+")"):u>=5&&u<10&&l.length==2?s.push("("+u+","+l.join(",")+")"):u>10&&l.length==3&&h.push("("+u+","+l.join(",")+")")}),at[u].value=f.join(";")+";;"+e.join(",")+";;"+o.join(",")+";;"+s.join(",")+";;"+h.join(",")+";;"+c.join(",")}}function ki(n,i,o,s,h,c,y,b,g,nt,tt,it,rt,ut,ft){var et=document.getElementById(i),ot;et.style.userSelect="none",et.style.webkitUserSelect="none",et.style.MozUserSelect="none",ot=d(et),r[n]={el:et,left:ot.x,top:ot.y,width:et.offsetWidth,height:et.offsetHeight,xmin:h,xmax:c,ymin:y,ymax:b,imgborder:g,imgwidth:nt,imgheight:tt,mode:it,dotline:rt},typeof ft=="string"&&ft.indexOf(":")!=-1?(ft=ft.split(":"),r[n].snaptogridx=1*ft[0],r[n].snaptogridy=1*ft[1]):(r[n].snaptogridx=ft,r[n].snaptogridy=ft),r[n].pixperx=(nt-2*g)/(c-h),r[n].pixpery=y==b?1:(tt-2*g)/(b-y),at[n]=document.getElementById(s),e[n]==null&&(e[n]=[]),p[n]==null&&(p[n]=[]),a[n]==null&&(a[n]=[]),u[n]==null&&(u[n]=[]),l[n]==null&&(l[n]=[]),f[n]==null&&(f[n]=[]),w[n]==null&&(w[n]=[]),pt[n]=it>=5?1:0,k[n]=ut,ht[n]=new Image,ht[n].onload=function(){var i=t;t=n,v(),t=i},ht[n].src=o}function di(n,i,r){for(var e=document.getElementById("drawtools"+i),f=e.getElementsByTagName("span"),u=0;u<f.length;u++)f[u].className="";for(f=e.getElementsByTagName("img"),u=0;u<f.length;u++)f[u].className="";n.className="sel",gi(i,r),t=i,v()}function gi(n,t){r[n].mode=t}function v(n,i){var v,bt,ft,ii,kt,ai,it,lt,at,oi,rt,d,b,tt,nt,ot,ct,et,st,ut,vi,h,g;try{v=r[t].el.getContext("2d")}catch(tr){ei||(ei=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}for(v.fillStyle="rgb(0,0,255)",v.lineWidth=2,v.strokeStyle="rgb(0,0,255)",v.clearRect(0,0,r[t].imgwidth,r[t].imgheight),v.drawImage(ht[t],0,0),v.beginPath(),h=0;h<f[t].length;h++){bt=h%3,v.strokeStyle=fi[bt],v.fillStyle=fi[bt];var it=null,b=null,pt=null,d=null,dt=null;if(f[t][h].length==3?(b=f[t][h][1][0],d=f[t][h][1][1],pt=f[t][h][2][0],dt=f[t][h][2][1]):f[t][h].length==2?(b=f[t][h][1][0],d=f[t][h][1][1],pt=n,dt=i):y==h&&n!=null&&f[t][h].length==1&&(b=n,d=i),pt!=null){if(v.save(),v.fillStyle=ci[bt],v.beginPath(),w[t][h]<=10.2)if(b!=f[t][h][0][0]&&(it=(d-f[t][h][0][1])/(b-f[t][h][0][0])),Math.abs(b-f[t][h][0][0])<1||Math.abs(it)>100)v.moveTo(f[t][h][0][0],0),v.lineTo(f[t][h][0][0],r[t].imgheight),pt>b?(v.lineTo(r[t].imgwidth,r[t].imgheight),v.lineTo(r[t].imgwidth,0),v.closePath()):(v.lineTo(0,r[t].imgheight),v.lineTo(0,0),v.closePath());else{var nr=it*(pt-b)+d,lt=f[t][h][0][1]-it*f[t][h][0][0],at=f[t][h][0][1]+it*(r[t].imgwidth-f[t][h][0][0]);v.moveTo(0,lt),v.lineTo(r[t].imgwidth,at),dt>nr?(v.lineTo(r[t].imgwidth,r[t].imgheight),v.lineTo(0,r[t].imgheight),v.closePath()):(v.lineTo(r[t].imgwidth,0),v.lineTo(0,0),v.closePath())}else pi(v,f[t][h][0][0],f[t][h][0][1],b,d,pt,dt,r[t].imgwidth,r[t].imgheight);v.fill(),v.restore()}if(v.beginPath(),b!=null)if(w[t][h]<=10.2)b!=f[t][h][0][0]&&(it=(d-f[t][h][0][1])/(b-f[t][h][0][0])),Math.abs(b-f[t][h][0][0])<1||Math.abs(it)>100?w[t][h]==10.2?o!=null&&o.mode>=10&&o.mode<11&&o.num==h&&o.subnum==0?(v.dashedLine(f[t][h][1][0],f[t][h][1][1],f[t][h][1][0],r[t].imgheight),v.dashedLine(f[t][h][1][0],f[t][h][1][1],f[t][h][1][0],0)):(v.dashedLine(f[t][h][0][0],f[t][h][0][1],f[t][h][0][0],r[t].imgheight),v.dashedLine(f[t][h][0][0],f[t][h][0][1],f[t][h][0][0],0)):(v.moveTo(f[t][h][0][0],0),v.lineTo(f[t][h][0][0],r[t].imgheight),v.stroke()):(lt=f[t][h][0][1]-it*f[t][h][0][0],at=f[t][h][0][1]+it*(r[t].imgwidth-f[t][h][0][0]),w[t][h]==10.2?o!=null&&o.mode>=10&&o.mode<11&&o.num==h&&o.subnum==0?(v.dashedLine(f[t][h][1][0],f[t][h][1][1],r[t].imgwidth,at),v.dashedLine(f[t][h][1][0],f[t][h][1][1],0,lt)):(v.dashedLine(f[t][h][0][0],f[t][h][0][1],r[t].imgwidth,at),v.dashedLine(f[t][h][0][0],f[t][h][0][1],0,lt)):(v.moveTo(0,lt),v.lineTo(r[t].imgwidth,at),v.stroke()));else if(w[t][h]==10.3){if(b!=f[t][h][0][0])if(d==f[t][h][0][1])v.moveTo(0,d),v.lineTo(r[t].imgwidth,d);else{if(rt=(d-f[t][h][0][1])/((b-f[t][h][0][0])*(b-f[t][h][0][0])),d>f[t][h][0][1])var yt=Math.sqrt((r[t].imgheight-f[t][h][0][1])/rt)+f[t][h][0][0],gt=-1*Math.sqrt((r[t].imgheight-f[t][h][0][1])/rt)+f[t][h][0][0],wi=f[t][h][0][1]-(r[t].imgheight-f[t][h][0][1]),vt=r[t].imgheight;else var yt=Math.sqrt((0-f[t][h][0][1])/rt)+f[t][h][0][0],gt=-1*Math.sqrt((0-f[t][h][0][1])/rt)+f[t][h][0][0],wi=2*f[t][h][0][1],vt=0;var ti=yt+2/3*(f[t][h][0][0]-yt),ni=vt+2/3*(wi-vt),yi=ti+(gt-yt)/3,li=ni;v.moveTo(yt,vt),v.bezierCurveTo(ti,ni,yi,li,gt,vt)}v.stroke()}else b!=f[t][h][0][0]&&hi(v,f[t][h][0][0],f[t][h][0][1],b,d,r[t].imgwidth,r[t].imgheight);for(v.beginPath(),g=0;g<f[t][h].length;g++)g==2?(v.arc(f[t][h][g][0],f[t][h][g][1],4,0,Math.PI*2,!0),v.fill()):v.fillRect(f[t][h][g][0]-3,f[t][h][g][1]-3,6,6);f[t][h].length==1&&b!=null&&v.fillRect(b-3,d-3,6,6),v.beginPath()}for(v.fillStyle="rgb(0,0,255)",v.lineWidth=k[t]==1?4:2,v.strokeStyle="rgb(0,0,255)",h=0;h<u[t].length;h++){if(l[t][h]>=5&&l[t][h]<6){var it=null,b=null,d=null,ft,wt;if(u[t][h].length==2?(b=u[t][h][1][0],d=u[t][h][1][1]):c==h&&n!=null&&u[t][h].length==1&&(b=n,d=i),b!=null)if(l[t][h]==5.3||l[t][h]==5.4)v.moveTo(u[t][h][0][0],u[t][h][0][1]),v.lineTo(b,d),l[t][h]==5.4&&(ft=[b-u[t][h][0][0],d-u[t][h][0][1]],ii=Math.sqrt(ft[0]*ft[0]+ft[1]*ft[1]),ii>.0001&&(ft=[ft[0]/ii,ft[1]/ii],wt=[-ft[1],ft[0]],v.moveTo(b-15*ft[0]-4*wt[0],d-15*ft[1]-5*wt[1]),v.lineTo(b,d),v.moveTo(b-15*ft[0]+4*wt[0],d-15*ft[1]+5*wt[1]),v.lineTo(b,d)));else if(b!=u[t][h][0][0]&&(it=(d-u[t][h][0][1])/(b-u[t][h][0][0])),Math.abs(b-u[t][h][0][0])<1||Math.abs(it)>100)l[t][h]==5.2?(v.moveTo(u[t][h][0][0],u[t][h][0][1]),d>u[t][h][0][1]?v.lineTo(u[t][h][0][0],r[t].imgheight):v.lineTo(u[t][h][0][0],0)):(v.moveTo(u[t][h][0][0],0),v.lineTo(u[t][h][0][0],r[t].imgheight));else{var lt=u[t][h][0][1]-it*u[t][h][0][0],at=u[t][h][0][1]+it*(r[t].imgwidth-u[t][h][0][0]),lt=u[t][h][0][1]-it*u[t][h][0][0],at=u[t][h][0][1]+it*(r[t].imgwidth-u[t][h][0][0]);l[t][h]==5.2?(v.moveTo(u[t][h][0][0],u[t][h][0][1]),b>u[t][h][0][0]?v.lineTo(r[t].imgwidth,at):v.lineTo(0,lt)):(v.moveTo(0,lt),v.lineTo(r[t].imgwidth,at))}}else if(l[t][h]==6){if(d=null,b=null,u[t][h].length==2?(b=u[t][h][1][0],d=u[t][h][1][1]):c==h&&n!=null&&u[t][h].length==1&&(b=n,d=i),b!=null&&b!=u[t][h][0][0])if(d==u[t][h][0][1])v.moveTo(0,d),v.lineTo(r[t].imgwidth,d);else{if(rt=(d-u[t][h][0][1])/((b-u[t][h][0][0])*(b-u[t][h][0][0])),d>u[t][h][0][1])var yt=Math.sqrt((r[t].imgheight-u[t][h][0][1])/rt)+u[t][h][0][0],gt=-1*Math.sqrt((r[t].imgheight-u[t][h][0][1])/rt)+u[t][h][0][0],wi=u[t][h][0][1]-(r[t].imgheight-u[t][h][0][1]),vt=r[t].imgheight;else var yt=Math.sqrt((0-u[t][h][0][1])/rt)+u[t][h][0][0],gt=-1*Math.sqrt((0-u[t][h][0][1])/rt)+u[t][h][0][0],wi=2*u[t][h][0][1],vt=0;var ti=yt+2/3*(u[t][h][0][0]-yt),ni=vt+2/3*(wi-vt),yi=ti+(gt-yt)/3,li=ni;v.moveTo(yt,vt),v.bezierCurveTo(ti,ni,yi,li,gt,vt)}}else if(l[t][h]==6.5){if(d=null,b=null,u[t][h].length==2?(b=u[t][h][1][0],d=u[t][h][1][1]):c==h&&n!=null&&u[t][h].length==1&&(b=n,d=i),b!=null&&b!=u[t][h][0][0])if(d==u[t][h][0][1])v.moveTo(u[t][h][0][0],d),b>u[t][h][0][0]?v.lineTo(r[t].imgwidth,d):v.lineTo(0,d);else{kt=b<u[t][h][0][0]?-1:1,rt=(d-u[t][h][0][1])/Math.sqrt(kt*(b-u[t][h][0][0])),v.moveTo(u[t][h][0][0],u[t][h][0][1]),nt=u[t][h][0][0],tt=u[t][h][0][1];do nt+=kt*3,v.lineTo(nt,rt*Math.sqrt(kt*(nt-u[t][h][0][0]))+u[t][h][0][1]);while(nt>0&&nt<r[t].imgwidth&&tt>0&&tt<r[t].imgheight)}}else if(l[t][h]==7)u[t][h].length==2?(b=u[t][h][1][0],d=u[t][h][1][1]):c==h&&n!=null&&u[t][h].length==1&&(b=n,d=i),b!=null&&(b!=u[t][h][0][0]||d!=u[t][h][0][1])&&(ai=Math.sqrt((b-u[t][h][0][0])*(b-u[t][h][0][0])+(d-u[t][h][0][1])*(d-u[t][h][0][1])),v.arc(u[t][h][0][0],u[t][h][0][1],ai,0,2*Math.PI,!0));else if(l[t][h]==8){var it=null,b=null,d=null;u[t][h].length==2?(b=u[t][h][1][0],d=u[t][h][1][1]):c==h&&n!=null&&u[t][h].length==1&&(b=n,d=i),b!=null&&(b!=u[t][h][0][0]&&(it=(d-u[t][h][0][1])/(b-u[t][h][0][0]),b<u[t][h][0][0]&&(it*=-1)),Math.abs(b-u[t][h][0][0])<1||Math.abs(it)>100?(v.moveTo(u[t][h][0][0],u[t][h][0][1]),d>u[t][h][0][1]?v.lineTo(u[t][h][0][0],r[t].imgheight):v.lineTo(u[t][h][0][0],0)):(lt=u[t][h][0][1]+it*u[t][h][0][0],at=u[t][h][0][1]+it*(r[t].imgwidth-u[t][h][0][0]),v.moveTo(0,lt),v.lineTo(u[t][h][0][0],u[t][h][0][1]),v.lineTo(r[t].imgwidth,at)))}else if(l[t][h]==8.3){if(d=null,b=null,u[t][h].length==2?(b=u[t][h][1][0],d=u[t][h][1][1]):c==h&&n!=null&&u[t][h].length==1&&(b=n,d=i),b!=null&&b!=u[t][h][0][0])if(d==u[t][h][0][1])v.moveTo(0,d),v.lineTo(r[t].imgwidth,d);else{var ri=r[t].ymax*r[t].pixpery+r[t].imgborder,bi=ri-u[t][h][0][1],ui=ri-d;if(bi*ui>0&&b!=u[t][h][0][0])for(oi=safepow(ui/bi,1/(b-u[t][h][0][0])),rt=ui/safepow(oi,b),v.moveTo(u[t][h][0][0],u[t][h][0][1]),tt=0,nt=0;nt<r[t].imgwidth+4;nt+=3)tt=ri-rt*safepow(oi,nt),tt<-100&&(tt=-100),tt>r[t].imgheight+100&&(tt=r[t].imgheight+100),nt==0?v.moveTo(nt,tt):v.lineTo(nt,tt)}}else if(l[t][h]==8.2){if(d=null,b=null,u[t][h].length==2?(b=u[t][h][1][0],d=u[t][h][1][1]):c==h&&n!=null&&u[t][h].length==1&&(b=n,d=i),v.strokeStyle="rgb(0,255,0)",v.dashedLine(5,u[t][h][0][1],r[t].imgwidth,u[t][h][0][1]),v.dashedLine(u[t][h][0][0],5,u[t][h][0][0],r[t].imgheight),v.beginPath(),v.strokeStyle="rgb(0,0,255)",b!=null&&b!=u[t][h][0][0]&&d!=u[t][h][0][1]){for(rt=(d-u[t][h][0][1])*(b-u[t][h][0][0]),nt=u[t][h][0][0]-1;nt>-4;nt-=3)tt=rt/(nt-u[t][h][0][0])+u[t][h][0][1],tt<-100&&(tt=-100),tt>r[t].imgheight+100&&(tt=r[t].imgheight+100),nt==u[t][h][0][0]-1?v.moveTo(nt,tt):v.lineTo(nt,tt);for(nt=u[t][h][0][0]+1;nt<r[t].imgwidth+4;nt+=3)tt=rt/(nt-u[t][h][0][0])+u[t][h][0][1],tt<-100&&(tt=-100),tt>r[t].imgheight+100&&(tt=r[t].imgheight+100),nt==u[t][h][0][0]+1?v.moveTo(nt,tt):v.lineTo(nt,tt);v.stroke()}}else if((l[t][h]==9||l[t][h]==9.1)&&(d=null,b=null,u[t][h].length==2?(b=u[t][h][1][0],d=u[t][h][1][1]):c==h&&n!=null&&u[t][h].length==1&&(b=n,d=i),b!=null&&b!=u[t][h][0][0]))if(d==u[t][h][0][1])v.moveTo(0,d),v.lineTo(r[t].imgwidth,d);else{if(l[t][h]==9)var ki=Math.abs(d-u[t][h][0][1])/-2,di=(d+u[t][h][0][1])/2,rt=Math.PI/Math.abs(b-u[t][h][0][0]),gi=d<u[t][h][0][1]?b:u[t][h][0][0];else if(l[t][h]==9.1)var ki=-1*Math.abs(d-u[t][h][0][1]),di=u[t][h][0][1],rt=.5*Math.PI/Math.abs(b-u[t][h][0][0]),gi=d<u[t][h][0][1]?b:b+2*Math.abs(b-u[t][h][0][0]);for(tt=0,nt=0;nt<r[t].imgwidth+4;nt+=3)tt=ki*Math.cos(rt*(nt-gi))+di,nt==0?v.moveTo(nt,tt):v.lineTo(nt,tt)}v.stroke(),v.beginPath()}for(v.fillStyle="rgba(0,0,255,.5)",h=0;h<e[t].length;h++){for(v.beginPath(),g=0;g<e[t][h].length;g++)g==0?(v.moveTo(e[t][h][g][0],e[t][h][g][1]),ot=e[t][h][g][0],ct=e[t][h][g][1]):(v.lineTo(e[t][h][g][0],e[t][h][g][1]),et=e[t][h][g][0],st=e[t][h][g][1]);if(h==s&&n!=null&&(v.lineTo(n,i),et=n,st=i),ut=r[t].imgwidth*.02,k[t]==1&&et>r[t].imgwidth*.98?(v.moveTo(et,st),v.lineTo(et-ut,st+ut),v.moveTo(et,st),v.lineTo(et-ut,st-ut)):k[t]==1&&ot>r[t].imgwidth*.98&&(v.moveTo(ot,ct),v.lineTo(ot-ut,ct+ut),v.moveTo(ot,ct),v.lineTo(ot-ut,ct-ut)),k[t]==1&&et<r[t].imgwidth*.02?(v.moveTo(et,st),v.lineTo(et+ut,st+ut),v.moveTo(et,st),v.lineTo(et+ut,st-ut)):k[t]==1&&ot<r[t].imgwidth*.02&&(v.moveTo(ot,ct),v.lineTo(ot+ut,ct+ut),v.moveTo(ot,ct),v.lineTo(ot+ut,ct-ut)),v.stroke(),r[t].dotline>1){if(vi=e[t][h].length-1,vi<1)continue;if(Math.pow(et-ot,2)+Math.pow(st-ct,2)<25){for(v.moveTo(e[t][h][0][0],e[t][h][0][1]),g=1;g<e[t][h].length;g++)v.lineTo(e[t][h][g][0],e[t][h][g][1]);v.closePath(),v.fill()}}}for(v.fillStyle="rgb(0,0,255)",v.beginPath(),h=0;h<p[t].length;h++)v.moveTo(p[t][h][0]+5,p[t][h][1]),v.arc(p[t][h][0],p[t][h][1],5,0,Math.PI*2,!0);if(v.fill(),r[t].dotline>0){for(v.beginPath(),h=0;h<e[t].length;h++)for(g=0;g<e[t][h].length;g++)(g==0||Math.pow(e[t][h][g][0]-e[t][h][g-1][0],2)+Math.pow(e[t][h][g][1]-e[t][h][g-1][1],2)>25)&&(v.moveTo(e[t][h][g][0]+5,e[t][h][g][1]),v.arc(e[t][h][g][0],e[t][h][g][1],5,0,Math.PI*2,!0));v.fill()}for(v.fillStyle="rgb(255,255,255)",v.beginPath(),h=0;h<a[t].length;h++)v.moveTo(a[t][h][0]+5,a[t][h][1]),v.arc(a[t][h][0],a[t][h][1],4,0,Math.PI*2,!0);for(r[t].mode<3?v.fill():v.stroke(),v.lineWidth=2,v.beginPath(),h=0;h<a[t].length;h++)v.moveTo(a[t][h][0]+5,a[t][h][1]),v.arc(a[t][h][0],a[t][h][1],4,0,Math.PI*2,!0);for(v.stroke(),h=0;h<u[t].length;h++)if(l[t][h]==r[t].mode){for(v.fillStyle="rgb(255,0,0)",g=0;g<u[t][h].length;g++)v.fillRect(u[t][h][g][0]-3,u[t][h][g][1]-3,6,6);u[t][h].length==1&&n!=null&&c==h&&v.fillRect(n-3,i-3,6,6),v.fillStyle="rgb(0,0,255)"}si()}function si(){for(var i="",r,o,s,n=0;n<e[t].length;n++)for(n!=0&&(i+=";"),r=0;r<e[t][n].length;r++)r!=0&&(i+=","),i+="("+e[t][n][r][0]+","+e[t][n][r][1]+")";for(i+=";;",n=0;n<p[t].length;n++)n!=0&&(i+=","),i+="("+p[t][n][0]+","+p[t][n][1]+")";for(i+=";;",n=0;n<a[t].length;n++)n!=0&&(i+=","),i+="("+a[t][n][0]+","+a[t][n][1]+")";for(i+=";;",o=[],n=0;n<u[t].length;n++)u[t][n].length>1&&o.push("("+l[t][n]+","+u[t][n][0][0]+","+u[t][n][0][1]+","+u[t][n][1][0]+","+u[t][n][1][1]+")");for(i+=o.join(","),i+=";;",s=[],n=0;n<f[t].length;n++)f[t][n].length>2&&s.push("("+w[t][n]+","+f[t][n][0][0]+","+f[t][n][0][1]+","+f[t][n][1][0]+","+f[t][n][1][1]+","+f[t][n][2][0]+","+f[t][n][2][1]+")");i+=s.join(","),at[t].value=i}function it(h){var ht,ot,tt,nt;if(nr++,lt(),b&&h.originalEvent.touches.length>1){ut=!0;n(document).on("touchend.imathasdraw",vt);return!0}if(b){window.clearTimeout(oi);n(document).on("touchstart.imathasdraw",function(n){b=!0,it(n)});n(document).on("touchmove.imathasdraw",rt);n(document).on("touchend.imathasdraw",vt)}else{n(document).on("mousemove.imathasdraw",rt);n(document).on("mouseup.imathasdraw",vt)}if(ht=st(h),t==null||s==null&&c==null&&y==null)for(i in r)if(ot=d(r[i].el),ot.x<ht.x&&ot.x+r[i].width>ht.x&&ot.y<ht.y&&ot.y+r[i].height>ht.y){t=i;break}t!=null&&(g=!0,ot=d(r[t].el),tt={x:ht.x-ot.x,y:ht.y-ot.y},tt.x>-1&&tt.x<r[t].width&&tt.y>-1&&tt.y<r[t].height?(navigator.userAgent.match(/Android/i),r[t].snaptogridx>0&&(tt=ct(tt,t)),k[t]==1&&(tt.y=r[t].imgheight/2),nt=ft(t,tt),nt!=null&&(s!=null&&nt[0]<1&&s!=nt[1]?nt=null:c!=null&nt[0]>=5&&nt[0]<10&&c!=nt[1]?nt=null:y!=null&&nt[0]>=10&&nt[0]<11&&y!=nt[1]&&(nt=null)),nt==null?(r[t].el.style.cursor="url("+imasroot+"/img/pendown.cur), default",r[t].mode==1?(p[t].push([tt.x,tt.y]),o={mode:1,num:p[t].length-1}):r[t].mode==2?(a[t].push([tt.x,tt.y]),o={mode:2,num:a[t].length-1}):r[t].mode==0||r[t].mode==.7?s==null?(e[t].push([[tt.x,tt.y]]),s=e[t].length-1):e[t][s].push([tt.x,tt.y]):r[t].mode==.5?s==null?(e[t].push([[tt.x,tt.y]]),s=e[t].length-1):(e[t][s].push([tt.x,tt.y]),s=null,o=null):r[t].mode>=5&&r[t].mode<10?c==null?(u[t].push([[tt.x,tt.y]]),c=u[t].length-1,l[t][c]=r[t].mode,g=!1):(u[t][c].push([tt.x,tt.y]),u[t][c].length==2&&(o={mode:r[t].mode,num:c,subnum:1},c=null)):r[t].mode>=10&&r[t].mode<11&&(y==null?(f[t].push([[tt.x,tt.y]]),y=f[t].length-1,w[t][y]=r[t].mode,g=!1):(f[t][y].push([tt.x,tt.y]),f[t][y].length==3&&(o={mode:r[t].mode,num:y,subnum:1},y=null)))):(nt[0]==0||nt[0]==.5?s==null?(r[t].el.style.cursor="move",o={mode:r[t].mode,num:nt[1],subnum:nt[2]},et=e[t][nt[1]][nt[2]],nt[2]==e[t][nt[1]].length-1&&r[t].mode==0?s=nt[1]:nt[2]==0&&r[t].mode==0&&(s=nt[1],e[t][s].reverse(),o.subnum=e[t][s].length-1)):nt[1]==s&&nt[2]==e[t][nt[1]].length-1?(e[t][s].length<2&&e[t].splice(s,1),s=null):r[t].dotline>1&&nt[1]==s&&nt[2]==0?(e[t][s].push(e[t][s][0]),s=null):(r[t].el.style.cursor="url("+imasroot+"/img/pendown.cur), default",e[t][s].push([tt.x,tt.y])):nt[0]==1?(r[t].el.style.cursor="move",o={mode:1,num:nt[1]}):nt[0]==2?(r[t].el.style.cursor="move",o={mode:2,num:nt[1]}):nt[0]>=5&&nt[0]<10?(r[t].el.style.cursor="move",o={mode:nt[0],num:nt[1],subnum:nt[2]},et=u[t][nt[1]][nt[2]]):nt[0]>=10&&nt[0]<11&&(r[t].el.style.cursor="move",o={mode:nt[0],num:nt[1],subnum:nt[2]},et=f[t][nt[1]][nt[2]]),yt=!0),v()):(s!=null&&(e[t][s].length<2&&e[t].splice(s,1),r[t].el.style.cursor="url("+imasroot+"/img/pen.cur), default"),c!=null&&(u[t][c].length<2&&u[t].splice(c,1),r[t].el.style.cursor="url("+imasroot+"/img/pen.cur), default"),y!=null&&(f[t][y].length<3&&f[t].splice(y,1),r[t].el.style.cursor="url("+imasroot+"/img/pen.cur), default"),s=null,c=null,y=null,o=null,v(),t=null))}function ft(n,t){var s,i,o,h;if(b?(s=Math.max(15*window.innerWidth/screen.width,15),s*=s):s=25,pt[n]==0){if(r[n].mode==0||r[n].mode==.5){for(i=0;i<e[n].length;i++)for(o=e[n][i].length-1;o>=0;o--)if(h=Math.pow(e[n][i][o][0]-t.x,2)+Math.pow(e[n][i][o][1]-t.y,2),h<s)return[r[n].mode,i,o]}else if(r[n].mode==1){for(i=0;i<p[n].length;i++)if(Math.pow(p[n][i][0]-t.x,2)+Math.pow(p[n][i][1]-t.y,2)<s)return[1,i]}else if(r[n].mode==2){for(i=0;i<a[n].length;i++)if(Math.pow(a[n][i][0]-t.x,2)+Math.pow(a[n][i][1]-t.y,2)<s)return[2,i]}else if(r[n].mode>=5&&r[n].mode<10){for(i=0;i<u[n].length;i++)if(l[n][i]==r[n].mode)for(o=u[n][i].length-1;o>=0;o--)if(h=Math.pow(u[n][i][o][0]-t.x,2)+Math.pow(u[n][i][o][1]-t.y,2),h<s)return[l[n][i],i,o]}else if(r[n].mode>=10&&r[n].mode<11)for(i=0;i<f[n].length;i++)for(o=f[n][i].length-1;o>=0;o--)if(h=Math.pow(f[n][i][o][0]-t.x,2)+Math.pow(f[n][i][o][1]-t.y,2),h<s)return[w[n][i],i,o]}else if(r[n].mode==1){for(i=0;i<p[n].length;i++)if(Math.pow(p[n][i][0]-t.x,2)+Math.pow(p[n][i][1]-t.y,2)<s)return[1,i]}else if(r[n].mode==2){for(i=0;i<a[n].length;i++)if(Math.pow(a[n][i][0]-t.x,2)+Math.pow(a[n][i][1]-t.y,2)<s)return[2,i]}else if(r[n].mode>=5&&r[n].mode<10){for(i=0;i<u[n].length;i++)for(o=u[n][i].length-1;o>=0;o--)if(l[n][i]==r[n].mode&&(h=Math.pow(u[n][i][o][0]-t.x,2)+Math.pow(u[n][i][o][1]-t.y,2),h<s))return[l[n][i],i,o]}else if(r[n].mode>=10&&r[n].mode<11)for(i=0;i<f[n].length;i++)for(o=f[n][i].length-1;o>=0;o--)if(h=Math.pow(f[n][i][o][0]-t.x,2)+Math.pow(f[n][i][o][1]-t.y,2),h<s)return[w[n][i],i,o];return null}function vt(i){var nt=st(i),h,ht,tt;if(g=!1,t!=null&&(tt=d(r[t].el),h={x:nt.x-tt.x,y:nt.y-tt.y},r[t].snaptogridx>0&&(h=ct(h,t)),ht=h.x>-1&&h.x<r[t].width&&h.y>-1&&h.y<r[t].height,yt==!0&&(r[t].mode>=5&&r[t].mode<10?(u[t].push([[h.x,h.y]]),c=u[t].length-1,l[t][c]=r[t].mode):r[t].mode>=10&&r[t].mode<11&&(f[t].push([[h.x,h.y]]),y=f[t].length-1,w[t][y]=r[t].mode)),ot!=null&&nt.x==ot.x&&nt.y==ot.y&&s!=null&&o==null&&(e[t][s].length<2&&e[t].splice(s,1),s=null,o=null,v()),s!=null&&o==null&&(r[t].mode==.5&&e[t][s].length>1?(s=null,dragobj=null,v()):r[t].mode==.7&&(s=null,dragobj=null,v())),c!=null&&u[t][c].length==1&&(ut||!ht?(u[t].splice(c,1),c=null,v()):ft(t,h)==null&&(u[t][c].push([h.x,h.y]),c=null,v())),y!=null&&f[t][y].length==1&&(ut||!ht?(f[t].splice(y,1),y=null,v()):ft(t,h)==null&&(f[t][y].push([h.x,h.y]),v())),r[t].el.style.cursor=s==null&&c==null?"move":"url("+imasroot+"/img/pen.cur), default",typeof i!="undefined"&&i.preventDefault()),ot=nt,t!=null&&o!=null&&(tt=d(r[t].el),h.x>-1&&h.x<r[t].width&&h.y>-1&&h.y<r[t].height?(o.mode==0&&r[t].dotline>1&&(o.subnum==0||o.subnum==e[t][o.num].length-1)&&Math.pow(e[t][o.num][0][0]-e[t][o.num][e[t][o.num].length-1][0],2)+Math.pow(e[t][o.num][0][1]-e[t][o.num][e[t][o.num].length-1][1],2)<25&&(o.subnum==0?(e[t][o.num][e[t][o.num].length-1][0]=e[t][o.num][0][0],e[t][o.num][e[t][o.num].length-1][1]=e[t][o.num][0][1]):(e[t][o.num][0][0]=e[t][o.num][e[t][o.num].length-1][0],e[t][o.num][0][1]=e[t][o.num][e[t][o.num].length-1][1]),s=null,v()),o=null):(k[t]==1&&(h.y=r[t].imgheight/2),o.mode==1?p[t].splice(o.num,1):o.mode==2?a[t].splice(o.num,1):o.mode==.5?e[t].splice(o.num,1):o.mode==0?e[t][o.num][o.subnum]=et:o.mode>=5&&o.mode<10?(u[t].splice(o.num,1),c=null):o.mode>=10&&o.mode<11&&(f[t].splice(o.num,1),y=null),o=null,v())),ut=!1,b)oi=window.setTimeout(function(){b=!1,lt();n(document).on("mousemove.imathasdraw",rt);n(document).on("touchstart.imathasdraw",function(n){b=!0,it(n)});n(document).on("mousedown.imathasdraw",it)},350);else{lt();n(document).on("mousemove.imathasdraw",rt);n(document).on("touchstart.imathasdraw",function(n){b=!0,it(n)});n(document).on("mousedown.imathasdraw",it)}}function rt(n){var l=null,b,w,h,nt,it,tt;yt=!1,b=st(n);for(i in r)if(w=d(r[i].el),w.x<b.x&&w.x+r[i].width>b.x&&w.y<b.y&&w.y+r[i].height>b.y){l=i;break}if(l!=null&&(w=d(r[l].el),h={x:b.x-w.x,y:b.y-w.y},r[l].snaptogridx>0&&(h=ct(h,l)),k[l]==1&&(h.y=r[l].imgheight/2),h.x>-1&&h.x<r[l].width&&h.y>-1&&h.y<r[l].height&&o==null&&s==null&&(tt=ft(l,h),r[l].el.style.cursor=tt==null?"url("+imasroot+"/img/pen.cur), default":"move")),t!=null){if(n.originalEvent.touches&&n.originalEvent.touches.length>1)return ut=!0,!0;if(typeof n!="undefined"&&n.preventDefault(),w=d(r[t].el),h={x:b.x-w.x,y:b.y-w.y},r[t].snaptogridx>0&&(h=ct(h,t)),k[t]==1&&(h.y=r[t].imgheight/2),h.x>-1&&h.x<r[t].width&&h.y>-1&&h.y<r[t].height)return o==null?s!=null?g&&(r[t].mode==0||r[t].mode==.7)?(nt=e[t][s].length-1,it=Math.pow(e[t][s][nt][0]-h.x,2)+Math.pow(e[t][s][nt][1]-h.y,2),it>25?(e[t][s].push([h.x,h.y]),v()):v(h.x,h.y)):g&&r[t].mode==.5?(nt=e[t][s].length-1,nt==0?(it=Math.pow(e[t][s][nt][0]-h.x,2)+Math.pow(e[t][s][nt][1]-h.y,2),it>25?(e[t][s].push([h.x,h.y]),v()):v(h.x,h.y)):(e[t][s][nt]=[h.x,h.y],v())):v(h.x,h.y):c!=null?g?v():v(h.x,h.y):y!=null?g?v():v(h.x,h.y):(tt=ft(t,h),r[t].el.style.cursor=tt==null?"url("+imasroot+"/img/pen.cur), default":"move"):(r[t].el.style.cursor="move",o.mode==0||o.mode==.5?e[t][o.num][o.subnum]=[h.x,h.y]:o.mode==1?p[t][o.num]=[h.x,h.y]:o.mode==2?a[t][o.num]=[h.x,h.y]:o.mode>=5&&o.mode<10?u[t][o.num][o.subnum]=[h.x,h.y]:o.mode>=10&&o.mode<11&&(f[t][o.num][o.subnum]=[h.x,h.y]),v()),!1}}function st(n){var f,t,i,r,u;return(n=n||window.event,b)?(f=n.originalEvent.changedTouches[0]||n.originalEvent.touches[0],{x:f.pageX,y:f.pageY}):n.pageX||n.pageY?{x:n.pageX,y:n.pageY}:(t=document.documentElement,i=document.body,t&&(t.scrollTop||t.scrollLeft)?(r=t.scrollLeft,u=t.scrollTop):i?(r=i.scrollLeft,u=i.scrollTop):(r=0,u=0),{x:n.clientX+r,y:n.clientY+u})}function ct(n,t){var i=n.x-r[t].imgborder+r[t].xmin*r[t].pixperx,u=n.y-r[t].imgborder-r[t].ymax*r[t].pixpery;return i=Math.round(Math.round(i/(r[t].pixperx*r[t].snaptogridx))*r[t].pixperx*r[t].snaptogridx+r[t].imgborder-r[t].xmin*r[t].pixperx),u=Math.round(Math.round(u/(r[t].pixpery*r[t].snaptogridy))*r[t].pixpery*r[t].snaptogridy+r[t].imgborder+r[t].ymax*r[t].pixpery),{x:i,y:u}}function gt(n,t){var i=d(n),r=st(t);return{x:r.x-i.x,y:r.y-i.y}}function d(n){for(var t=0,i=0;n.offsetParent;)t+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent;return t+=n.offsetLeft,i+=n.offsetTop,{x:t,y:i}}function lt(){n(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw"),n(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw")}function bt(i){var o,h,s;lt();n(document).on("mousemove.imathasdraw",rt);n(document).on("touchstart.imathasdraw",function(n){b=!0,it(n)});n(document).on("mousedown.imathasdraw",it);try{CanvasRenderingContext2D.prototype.dashedLine=function(n,i,u,f,e){var s;e==undefined&&(e=10),this.beginPath(),this.moveTo(n,i);var h=u-n,c=f-i,o=Math.sqrt(h*h+c*c)/e,l=h/o,a=c/o;for(o=Math.round(o),s=0;s++<o&&i>-1&&i<r[t].imgheight+1&&n>-1&&n<r[t].imgwidth+1;)n+=l,i+=a,this[s%2==0?"moveTo":"lineTo"](n,i);this[s%2==0?"moveTo":"lineTo"](u,f),this.stroke(),this.closePath()}}catch(c){}for(o in canvases)if(typeof i=="undefined"||i==o){if(h=null,drawla[o]!=null&&drawla[o].length>2){if(e[canvases[o][0]]=drawla[o][0],p[canvases[o][0]]=drawla[o][1],a[canvases[o][0]]=drawla[o][2],l[canvases[o][0]]=[],u[canvases[o][0]]=[],drawla[o].length>3&&drawla[o][3].length>0)for(s=0;s<drawla[o][3].length;s++)l[canvases[o][0]][s]=drawla[o][3][s][0],u[canvases[o][0]][s]=[drawla[o][3][s].slice(1,3),drawla[o][3][s].slice(3)];if(w[canvases[o][0]]=[],f[canvases[o][0]]=[],drawla[o].length>4&&drawla[o][4].length>0)for(s=0;s<drawla[o][4].length;s++)w[canvases[o][0]][s]=drawla[o][4][s][0],f[canvases[o][0]][s]=[drawla[o][4][s].slice(1,3),drawla[o][4][s].slice(3,5),drawla[o][4][s].slice(5)];drawla[o].length>5&&(h=drawla[o][5])}canvases[o][1].substr(0,8)=="a11ydraw"?vi(canvases[o],h):ki(canvases[o][0],"canvas"+canvases[o][0],imasroot+"/filter/graph/imgs/"+canvases[o][1],"qn"+canvases[o][0],canvases[o][2],canvases[o][3],canvases[o][4],canvases[o][5],canvases[o][6],canvases[o][7],canvases[o][8],canvases[o][9],canvases[o][10],canvases[o][11],canvases[o][12])}}function yi(n){arraysearch(n,h.idnums)==-1?h.idnums.push(n):kt(n)}function kt(t){for(var u,r,i=0;i<h.idnums.length;i++)if(typeof t=="undefined"||t==h.idnums[i]){r=h.idnums[i],ai(r);n("#slid1"+r).on("touchstart.normslider mousedown.normslider",dt);n("#slid2"+r).on("touchstart.normslider mousedown.normslider",dt)}}function ai(n){var i,r,u,t,f=document.getElementById("qn"+n).value;(t=f.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/))?(i=3,r=t[1],u=t[2]):(t=f.match(/\(-oo,([\-\d\.]+)\)/))?(i=0,r=t[1],u=2.5):(t=f.match(/\(([\-\d\.]+),oo\)/))?(i=1,r=t[1],u=2.5):(t=f.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(i=2,r=t[1],u=t[2]):(i=0,r=-1.5,u=2.5),document.getElementById("slid1"+n).style.left=r*60+250-6+"px",document.getElementById("slid2"+n).style.left=u*60+250-6+"px",document.getElementById("shaderegions"+n).selectedIndex=i,h.curslider.type=document.getElementById("shaderegions"+n).value,ii(n)}function dt(t){if(t=t||window.event,t.originalEvent.touches&&t.originalEvent.touches.length>0){b=!0;n(document).on("touchmove.normslider",ni);n(document).on("touchend.normslider",ri)}else{n(document).on("mousemove.normslider",ni);n(document).on("mouseup.normslider",ri)}h.curslider.el=t.target||t.srcElement,h.curslider.id=h.curslider.el.id.substring(5),h.curslider.type=document.getElementById("shaderegions"+h.curslider.id).value,h.curslider.outnode=document.getElementById(h.outputid),h.curslider.startpos=gt(h.curslider.el,t),h.curslider.el.parentNode.style.cursor="pointer";var i=d(h.curslider.el.parentNode);return t.preventDefault&&t.preventDefault(),!1}function ni(n){var r=h.curslider.id,t,i;if(n=n||window.event,t=gt(h.curslider.el.parentNode,n),!(t.x<5)&&!(t.x>h.curslider.el.parentNode.offsetWidth-5)&&!(t.y<5)&&!(t.y>h.curslider.el.parentNode.offsetHeight-5))return i=Math.round((t.x-h.curslider.startpos.x-10)/6)*6+10,h.curslider.el.style.left=i+"px",ti(r),n.preventDefault&&n.preventDefault(),!1}function ri(){h.curslider.el!==null&&(b=!1,n(document).off("touchmove.normslider touchend.normslider"),n(document).off("mousemove.normslider mouseup.normslider"),h.curslider.el.parentNode.style.cursor="",h.curslider.el=null)}function ti(n){var t=parseInt(document.getElementById("slid1"+n).style.left)+6,u=parseInt(document.getElementById("slid2"+n).style.left)+6,f=Math.min(t,u),l=Math.max(t,u),o,s,c,r;h.curslider.type=="2O"?document.getElementById("normleft"+n).style.width=f+1+"px":h.curslider.type=="1L"?document.getElementById("normleft"+n).style.width=t+1+"px":h.curslider.type=="2B"&&(document.getElementById("normleft"+n).style.left=f+"px",document.getElementById("normleft"+n).style.width=l-f+1+"px"),h.curslider.type=="2O"?document.getElementById("normright"+n).style.width=500-l+"px":h.curslider.type=="1R"&&(document.getElementById("normright"+n).style.width=500-t+"px");var i=(-4+(t-10)/60).toFixed(1),e=(-4+(u-10)/60).toFixed(1),a=document.getElementById("slid1txt"+n);a.innerHTML=i,a.style.left=t-6+"px",o=document.getElementById("slid2txt"+n),o.innerHTML=e,o.style.left=u-6+"px",s=Math.min(i,e),c=Math.max(i,e),h.curslider.type=="2O"?r="(-oo,"+s+")U("+c+",oo)":h.curslider.type=="2B"?r="("+s+","+c+")":h.curslider.type=="1L"?r="(-oo,"+i+")":h.curslider.type=="1R"&&(r="("+i+",oo)"),document.getElementById("qn"+n).value=r}function ii(n){var t=document.getElementById("shaderegions"+n).value;h.curslider.type=t;var i=parseInt(document.getElementById("slid1"+n).style.left)+6,u=parseInt(document.getElementById("slid2"+n).style.left)+6,r=Math.min(i,u),f=Math.max(i,u);t=="1R"||t=="1L"?(document.getElementById("slid2"+n).style.display="none",document.getElementById("slid2txt"+n).style.display="none",t=="1R"?(document.getElementById("normleft"+n).style.display="none",document.getElementById("normright"+n).style.display="",document.getElementById("normright"+n).style.right="0px",document.getElementById("normright"+n).style.width=500-i+"px"):(document.getElementById("normright"+n).style.display="none",document.getElementById("normleft"+n).style.display="",document.getElementById("normleft"+n).style.left="0px",document.getElementById("normleft"+n).style.width=i+"px")):t=="2O"?(document.getElementById("slid2"+n).style.display="",document.getElementById("slid2txt"+n).style.display="",document.getElementById("normleft"+n).style.display="",document.getElementById("normright"+n).style.display="",document.getElementById("normright"+n).style.right="0px",document.getElementById("normleft"+n).style.left="0px",document.getElementById("normright"+n).style.width=500-f+"px",document.getElementById("normleft"+n).style.width=r+"px"):t=="2B"&&(document.getElementById("slid2"+n).style.display="",document.getElementById("slid2txt"+n).style.display="",document.getElementById("normleft"+n).style.display="",document.getElementById("normright"+n).style.display="none",document.getElementById("normleft"+n).style.left=r+"px",document.getElementById("normleft"+n).style.width=f-r+"px"),ti(n)}function hi(n,t,i,r,u,f,e){var a,b,k;if(u==i)n.moveTo(0,u),n.dashedLine(0,u,f,u);else{var s=(u-i)/((r-t)*(r-t)),c=-2*s*t,w=0;u>i&&(w=e),a=s*t*t+i-w,b=Math.sqrt(c*c-4*s*a),a+=w;var h=(-c-b)/(2*s),g=s*h*h+c*h+a,v=(-c+b)/(2*s),nt=g;v<h&&(k=h,h=v,v=k);for(var p=8,d=p*p,tt=v-h,o=t,l=i,y=0;o>h-5&&o>-5;)y%2==0?n.moveTo(o,l):n.lineTo(o,l),o-=Math.min(Math.sqrt(d/(1+Math.pow(2*s*(o-t),2))),Math.sqrt(p/Math.abs(s))),l=s*o*o+c*o+a,y++;for(o=t,l=i,y=0;o<v+5&&o<f+5;)y%2==0?n.moveTo(o,l):n.lineTo(o,l),o+=Math.min(Math.sqrt(d/(1+Math.pow(2*s*(o-t),2))),Math.sqrt(p/Math.abs(s))),l=s*o*o+c*o+a,y++}n.stroke()}function pi(n,t,i,r,u,f,e,o,s){var y,g,tt,b;if(n.beginPath(),u==i)n.moveTo(0,u),n.lineTo(o,u),e<i?(n.lineTo(o,0),n.lineTo(0,0)):(n.lineTo(o,s),n.lineTo(0,s));else{var h=(u-i)/((r-t)*(r-t)),l=-2*h*t,k=0;u>i&&(k=s),y=h*t*t+i-k,g=Math.sqrt(l*l-4*h*y),y+=k;var c=(-l-g)/(2*h),v=h*c*c+l*c+y,a=(-l+g)/(2*h),p=v;a<c&&(tt=c,c=a,a=tt);var w=2*h*(c-t),it=v-w*c,rt=-w,ut=p-rt*a,d=(it-ut)/(rt-w),nt=w*d+it;h<0&&e<h*f*f+l*f+y||h>0&&e>h*f*f+l*f+y?(n.moveTo(c,v),n.quadraticCurveTo(d,nt,a,p)):(b=s,Math.abs(v-s)<2&&(b=0),n.moveTo(0,v),n.lineTo(c,v),n.quadraticCurveTo(d,nt,a,p),n.lineTo(o,p),n.lineTo(o,b),n.lineTo(0,b))}n.closePath()}var g=!1,r=[],ht=[],at=[],wt=[],e=[],p=[],a=[],u=[],l=[],f=[],w=[],s=null,pt=[],k=[],c=null,y=null,fi=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],ci=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],o=null,et=null,t=null,ei=!1,b=!1,ut=!1,yt=!1,oi=null,nr=0,ot=null,h,ui;return typeof initstack!="undefined"?initstack.push(bt):n(function(){bt()}),h={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}},typeof initstack!="undefined"&&initstack.push(kt),ui={initCanvases:bt,clearcanvas:li,settool:di,addnormslider:yi,chgnormtype:ii,adda11ydraw:tt,changea11ydraw:wi,encodea11ydraw:bi,removea11ydraw:tr}}(jQuery),ehcurel=null,ehclosetimer=0,ehddclosetimer=0,curehdd=null,eecurel=null;
