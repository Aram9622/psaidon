function mopen(e,t){"homemenu"==e&&0==homemenuloaded&&(basicahah(imasroot+"/gethomemenu.php?cid="+t,"homemenu"),homemenuloaded=1),mcancelclosetime(),ddmenuitem?(ddmenuitem.style.visibility="hidden",ddmenuitem=null):(ddmenuitem=document.getElementById(e),ddmenuitem.style.visibility="visible")}function mclose(){ddmenuitem&&(ddmenuitem.style.visibility="hidden",ddmenuitem=null)}function mclosetime(){closetimer=window.setTimeout(mclose,250)}function mcancelclosetime(){closetimer&&(window.clearTimeout(closetimer),closetimer=null)}function basicahah(e,t,r){null==r&&(r=" Fetching data... "),document.getElementById(t).innerHTML=r;var n=!1;window.XMLHttpRequest?(req=new XMLHttpRequest,n=!0):window.ActiveXObject&&(req=new ActiveXObject("Microsoft.XMLHTTP"),n=!0),n&&(req.onreadystatechange=function(){basicahahDone(e,t)},req.open("GET",e,!0),req.send(""))}function basicahahDone(e,t){4==req.readyState&&(200==req.status?document.getElementById(t).innerHTML=req.responseText:document.getElementById(t).innerHTML=" AHAH Error:\n"+req.status+"\n"+req.statusText)}function arraysearch(e,t){for(var r=0;r<t.length;r++)if(t[r]==e)return r;return-1}function tipshow(e,t){"object"!=typeof tipobj&&(tipobj=document.createElement("div"),tipobj.className="tips",document.getElementsByTagName("body")[0].appendChild(tipobj)),tipobj.innerHTML=t,tipobj.style.left="5px",tipobj.style.display="block","undefined"!=typeof usingASCIIMath&&"undefined"!=typeof noMathRender&&usingASCIIMath&&!noMathRender&&rendermathnode(tipobj);var r=findPos(e);self.innerHeight?x=self.innerWidth:document.documentElement&&document.documentElement.clientHeight?x=document.documentElement.clientWidth:document.body&&(x=document.body.clientWidth);var n=0;"number"==typeof window.pageYOffset?n=window.pageXOffset:document.body&&(document.body.scrollLeft||document.body.scrollTop)?n=document.body.scrollLeft:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(n=document.documentElement.scrollLeft),x+=n,r[0]+tipobj.offsetWidth>x&&(r[0]=x-tipobj.offsetWidth-30),tipobj.style.left=r[0]+20+"px",r[1]<30?tipobj.style.top=r[1]+20+"px":tipobj.style.top=r[1]-tipobj.offsetHeight+"px"}function popupwindow(e,t,r,n,i){"fit"==n&&(n=window.height-80);var a="width="+r+",height="+n+",status=0,resizable=1,directories=0,menubar=0";if(null!=i&&1==i&&(a+=",scrollbars=1"),"undefined"==typeof popupwins[e]||popupwins[e].closed||popupwins[e].focus(),t.match(/^http/))popupwins[e]=window.open(t,e,a);else{var l=window.open("",e,a);l.document.write("<html><head><title>Popup</title></head><body>"),l.document.write(t),l.document.write("</body></html>"),l.document.close(),popupwins[e]=l}}function tipout(e){tipobj.style.display="none"}function findPos(e){var t=curtop=0;if(e.offsetParent)do t+=e.offsetLeft,curtop+=e.offsetTop,e.offsetParent&&(e.parentNode&&e.offsetParent!=e.parentNode?(t-=e.parentNode.scrollLeft,curtop-=e.parentNode.scrollTop):(t-=e.offsetParent.scrollLeft,curtop-=e.offsetParent.scrollTop));while(e=e.offsetParent);return[t,curtop]}function togglepic(e){e.getAttribute("src").match("userimg_sm")?e.setAttribute("src",e.getAttribute("src").replace("_sm","_")):e.setAttribute("src",e.getAttribute("src").replace("_","_sm"))}function addLoadEvent(e){var t=window.onload;"function"!=typeof window.onload?window.onload=e:window.onload=function(){t&&t(),e()}}function submitlimiter(e){var t=e.target;"submitted"==t.className?(alert("You have already submitted this page.  Please be patient while your submission is processed."),t.className="submitted2",e.preventDefault?e.preventDefault():e.returnValue=!1):"submitted2"==t.className?e.preventDefault?e.preventDefault():e.returnValue=!1:t.className="submitted"}function setupFormLimiters(){for(var e=document.getElementsByTagName("form"),t=0;t<e.length;t++)"function"!=typeof e[t].onsubmit&&"nolimit"!=e[t].className&&$(e[t]).on("submit",submitlimiter)}function GB_show(e,t,r,n){if(0==GB_loaded){var i=document.createElement("div");i.id="GB_overlay",i.onclick=GB_hide,document.getElementsByTagName("body")[0].appendChild(i);var a=document.createElement("div");a.id="GB_window",a.innerHTML='<div id="GB_caption"></div><div id="GB_loading">Loading...</div><div id="GB_frameholder" ></div>',document.getElementsByTagName("body")[0].appendChild(a),GB_loaded=!0}if(document.getElementById("GB_frameholder").innerHTML='<iframe onload="GB_doneload()" id="GB_frame" src="'+t+'"></iframe>',jQuery("#GB_frameholder").isolatedScroll(),t.match(/libtree/)){var l='<span class="floatright"><input type="button" value="Use Libraries" onClick="document.getElementById(\'GB_frame\').contentWindow.setlib()" /> ';l+='<span class="pointer" onclick="GB_hide()">[X]</span>&nbsp;</span>Select Libraries<div class="clear"></div>',document.getElementById("GB_caption").innerHTML=l;var s=self.innerHeight||o&&o.clientHeight||document.body.clientHeight}else if(document.getElementById("GB_caption").innerHTML='<span class="floatright"><span class="pointer" onclick="GB_hide()">[X]</span></span>'+e,document.getElementById("GB_caption").onclick=GB_hide,"auto"==n)var s=self.innerHeight||o&&o.clientHeight||document.body.clientHeight;else var s=n;document.getElementById("GB_window").style.display="block",document.getElementById("GB_overlay").style.display="block",document.getElementById("GB_loading").style.display="block";var o=document.documentElement,c=self.innerWidth||o&&o.clientWidth||document.body.clientWidth;document.getElementById("GB_window").style.width=r+"px",document.getElementById("GB_window").style.height=s-30+"px",document.getElementById("GB_window").style.left=(c-r)/2+"px",document.getElementById("GB_frame").style.height=s-30-34+"px"}function GB_doneload(){document.getElementById("GB_loading").style.display="none"}function GB_hide(){document.getElementById("GB_window").style.display="none",document.getElementById("GB_overlay").style.display="none"}function chkAllNone(e,t,r,n){var a=document.getElementById(e);for(i=0;i<=a.elements.length;i++)try{("all"==t&&"checkbox"==a.elements[i].type||a.elements[i].name==t)&&(n&&a.elements[i].className==n?a.elements[i].checked=!r:a.elements[i].checked=r)}catch(l){}return!1}function initeditor(e,t,r){var n=r||0,i="";"exact"==e?i="#"+t.split(/,/).join(",#"):"textareas"==e&&(i="textarea."+t);var a={selector:i,plugins:["advlist attach image charmap anchor","searchreplace code link textcolor","media table paste asciimath asciisvg rollups"],menubar:!1,toolbar1:"myEdit myInsert styleselect | bold italic underline subscript superscript | forecolor backcolor | code",toolbar2:" alignleft aligncenter alignright | bullist numlist outdent indent  | attach link unlink image | table | asciimath asciimathcharmap asciisvg",extended_valid_elements:"iframe[src|width|height|name|align|allowfullscreen|frameborder],param[name|value],@[sscr]",content_css:imasroot+(1==n?"/assessment/mathtest.css,":"/imascore.css,")+imasroot+"/themes/"+coursetheme,AScgiloc:imasroot+"/filter/graph/svgimg.php",convert_urls:!1,file_picker_callback:filePickerCallBackFunc,file_browser_types:"file image",images_upload_url:imasroot+"/tinymce4/upload_handler.php",paste_data_images:!0,default_link_target:"_blank",browser_spellcheck:!0,resize:"both",width:"100%",content_style:"body {background-color: #ffffff !important;}",table_class_list:[{title:"None",value:""},{title:"Gridded",value:"gridded"},{title:"Gridded Centered",value:"gridded centered"}],style_formats_merge:!0,style_formats:[{title:"Font Family",items:[{title:"Arial",inline:"span",styles:{"font-family":"arial"}},{title:"Book Antiqua",inline:"span",styles:{"font-family":"book antiqua"}},{title:"Comic Sans MS",inline:"span",styles:{"font-family":"comic sans ms,sans-serif"}},{title:"Courier New",inline:"span",styles:{"font-family":"courier new,courier"}},{title:"Georgia",inline:"span",styles:{"font-family":"georgia,palatino"}},{title:"Helvetica",inline:"span",styles:{"font-family":"helvetica"}},{title:"Impact",inline:"span",styles:{"font-family":"impact,chicago"}},{title:"Open Sans",inline:"span",styles:{"font-family":"Open Sans"}},{title:"Symbol",inline:"span",styles:{"font-family":"symbol"}},{title:"Tahoma",inline:"span",styles:{"font-family":"tahoma"}},{title:"Terminal",inline:"span",styles:{"font-family":"terminal,monaco"}},{title:"Times New Roman",inline:"span",styles:{"font-family":"times new roman,times"}},{title:"Verdana",inline:"span",styles:{"font-family":"Verdana"}}]},{title:"Font Size",items:[{title:"8pt",inline:"span",styles:{fontSize:"12px","font-size":"8px"}},{title:"10pt",inline:"span",styles:{fontSize:"12px","font-size":"10px"}},{title:"12pt",inline:"span",styles:{fontSize:"12px","font-size":"12px"}},{title:"14pt",inline:"span",styles:{fontSize:"12px","font-size":"14px"}},{title:"16pt",inline:"span",styles:{fontSize:"12px","font-size":"16px"}},{title:"20pt",inline:"span",styles:{fontSize:"12px","font-size":"20px"}}]}]};document.documentElement.clientWidth<385?(a.toolbar1="myEdit myInsert styleselect | bold italic underline",a.toolbar2="bullist numlist outdent indent  | link image | asciimath asciisvg"):document.documentElement.clientWidth<465?(a.toolbar1="myEdit myInsert styleselect | bold italic underline forecolor",a.toolbar2="bullist numlist outdent indent  | link unlink image | asciimath asciisvg"):document.documentElement.clientWidth<575&&(a.toolbar1="myEdit myInsert styleselect | bold italic underline subscript superscript | forecolor",a.toolbar2=" alignleft aligncenter | bullist numlist outdent indent  | link unlink image | asciimath asciimathcharmap asciisvg");for(var l in tinymce.editors)tinymce.editors[l].remove();tinymce.init(a)}function filePickerCallBack(e,t,r){var n=imasroot+"/tinymce4/file_manager.php";switch(r.filetype){case"image":n+="?type=img";break;case"file":n+="?type=files"}tinyMCE.activeEditor.windowManager.open({file:n,title:"File Manager",width:350,height:450,resizable:"yes",inline:"yes",close_previous:"no"},{oninsert:function(t,r){e(t)}})}function imascleanup(e,t){return"get_from_editor"==e&&(t=t.replace(/<!--([\s\S]*?)-->|&lt;!--([\s\S]*?)--&gt;|<style>[\s\S]*?<\/style>/g,""),t=t.replace(/class="?Mso\w+"?/g,""),t=t.replace(/<p\s*>\s*<\/p>/gi,""),t=t.replace(/<script.*?\/script>/gi,""),t=t.replace(/<input[^>]*button[^>]*>/gi,"")),t}function readCookie(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var i=r[n];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return unescape(i.substring(t.length,i.length))}return null}function selectByDivID(e){for(var t=e.value,r=e.value.split(":")[0],n=document.getElementsByTagName("div"),i=0;i<n.length;i++)n[i].className.match(r)&&(n[i].style.display=n[i].id==t?"block":"none");var a=new Date;a.setDate(a.getDate()+365),document.cookie=r+"store="+escape(t)+";expires="+a.toGMTString()}function setselectbycookie(){for(var e=document.getElementsByTagName("select"),t=0;t<e.length;t++)if(e[t].className.match("alts")){var r=e[t].className.replace(/alts/,"").replace(/\s/g,"");null!=(co=readCookie(r+"store"))&&(co=co.replace("store",""),e[t].value=co,selectByDivID(e[t]))}}function recclick(e,t,r,n){if(cid>0){var i,a="";null!==(i=window.location.href.match(/showlinkedtext.*?&id=(\d+)/))&&0==recordedunload&&(a="&unloadinglinked="+i[1],recordedunload=!0),jQuery.ajax({type:"POST",url:imasroot+"/course/rectrack.php?cid="+cid,data:"type="+encodeURIComponent(e)+"&typeid="+encodeURIComponent(t)+"&info="+encodeURIComponent(r+"::"+n)+a})}}function setuptracklinks(e,t){jQuery(t).attr("data-base")&&jQuery(t).click(function(e){var r=jQuery(this).attr("data-base").split("-");return recclick(r[0],r[1],jQuery(this).attr("href"),jQuery(this).text()),"undefined"==typeof jQuery(t).attr("target")?(e.preventDefault(),setTimeout('window.location.href = "'+jQuery(this).attr("href")+'"',100),!1):void 0}).mousedown(function(e){if(3==e.which){var t=jQuery(this).attr("data-base").split("-");recclick(t[0],t[1],jQuery(this).attr("href"),jQuery(this).text())}})}function togglevideoembed(){var e=this.id.substr(13),t=jQuery("#videoiframe"+e);if(t.length>0)"none"==t.css("display")?(t.show(),t.parent(".fluid-width-video-wrapper").show(),jQuery(this).text(" [-]"),jQuery(this).attr("title",_("Hide video"))):(t.hide(),t.get(0).contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"),t.parent(".fluid-width-video-wrapper").hide(),jQuery(this).text(" [+]"),jQuery(this).attr("title",_("Watch video here")));else{var r=jQuery(this).prev().attr("href"),n="?";if(r.match(/youtube\.com/))if(r.indexOf("playlist?list=")>-1){var i=r.split("list=")[1].split(/[#&]/)[0],a="www.youtube.com/embed/videoseries?list=";n="&"}else var i=r.split("v=")[1].split(/[#&]/)[0],a="www.youtube.com/embed/";else if(r.match(/youtu\.be/))var i=r.split(".be/")[1].split(/[#&]/)[0],a="www.youtube.com/embed/";else if(r.match(/vimeo/))var i=r.split(".com/")[1].split(/[#&]/)[0],a="player.vimeo.com/video/";var l=r.match(/.*\Wt=((\d+)m)?((\d+)s)?.*/);if(null==l){var s=n+"rel=0";l=r.match(/.*start=(\d+)/),null!=l&&(s+="&start="+l[1])}else var s=n+"rel=0&start="+((l[2]?60*l[2]:0)+(l[4]?1*l[4]:0));if(l=r.match(/.*end=(\d+)/),null!=l&&(s+="&end="+l[1]),s+="&enablejsapi=1",jQuery("<iframe/>",{id:"videoiframe"+e,width:640,height:400,src:location.protocol+"//"+a+i+s,frameborder:0,allowfullscreen:1}).insertAfter(jQuery(this)),jQuery(this).parent().fitVids(),jQuery("<br/>").insertAfter(jQuery(this)),jQuery(this).text(" [-]"),jQuery(this).attr("title",_("Hide video")),jQuery(this).prev().attr("data-base")){var o=jQuery(this).prev().attr("data-base").split("-");recclick(o[0],o[1],r,jQuery(this).prev().text())}}}function setupvideoembeds(e,t){jQuery("<span/>",{text:" [+]",title:_("Watch video here"),id:"videoembedbtn"+videoembedcounter,click:togglevideoembed,"class":"videoembedbtn"}).insertAfter(t),videoembedcounter++}function addmultiselect(e,t){var r=jQuery(e).parent(),n=jQuery("#"+t).val(),i=jQuery("#"+t+" option[value="+n+"]").prop("disabled",!0).html();"null"!=n&&r.append('<div class="multiselitem"><span class="right"><a href="#" onclick="removemultiselect(this);return false;">Remove</a></span><input type="hidden" name="'+t+'[]" value="'+n+'"/>'+i+"</div>"),jQuery("#"+t).val("null")}function removemultiselect(e){var t=jQuery(e).parent().parent(),r=t.find("input").val();t.parent().find("option[value="+r+"]").prop("disabled",!1),t.remove()}function hidefromcourselist(e,t){confirm("Are you SURE you want to hide this course from your course list?")&&jQuery.ajax({type:"GET",url:imasroot+"/admin/hidefromcourselist.php?cid="+t}).done(function(t){"OK"==t&&(jQuery(e).parent().slideUp(),jQuery("#unhidelink").show())})}function rotateimg(e){if($(e).data("rotation"))var t=($(e).data("rotation")+90)%360;else var t=90;if($(e).data("rotation",t).css({transform:"rotate("+t+"deg)"}),t%180==90){var r=($(e).width()-$(e).height())/2;r>0&&$(e).parent().css({"padding-top":r,"padding-bottom":r})}else $(e).parent().css({"padding-top":0,"padding-bottom":0})}function _(e){if("undefined"!=typeof i18njs&&i18njs[e])var t=i18njs[e];else var t=e;if(arguments.length>1)for(var r=1;r<arguments.length;r++)t=t.replace("$"+r,arguments[r]);return t}function setAltSelectors(e,t){console.log("looking for "+e),$(".alts."+e).parents(".altWrap").find(".altContentOn").removeClass("altContentOn").addClass("altContentOff"),$(".alts."+e).parents(".altWrap").find("."+t).addClass("altContentOn").removeClass("altContentOff"),$("select.alts."+e).val(e+":"+t);var r=new Date;r.setDate(r.getDate()+365),document.cookie="alt_store_"+e+"="+escape(t)+";expires="+r.toGMTString()+";path=/"}function factorial(e,t){null==t&&(t=1);for(var r=e-t;r>0;r-=t)e*=r;return 0>e?NaN:0==e?1:e}function C(e,t){for(var r=1,n=0;t>n;n++)r*=(e-n)/(t-n);return r}function matchtolower(e){return e.toLowerCase()}function nthroot(e,t){return safepow(t,1/e)}function nthlogten(e,t){return Math.log(t)/Math.log(e)}function functoindex(e){for(var t=0;t<funcstoindexarr.length;t++)if(funcstoindexarr[t]==e)return"@"+t+"@"}function indextofunc(e,t){return funcstoindexarr[t]}function safepow(e,t){if(0>e&&Math.floor(t)!=t){for(var r=3;50>r;r+=2)if(Math.abs(Math.round(r*t)-r*t)<1e-6)return Math.round(r*t)%2==0?Math.pow(Math.abs(e),t):-1*Math.pow(Math.abs(e),t);return Math.sqrt(-1)}return Math.pow(e,t)}function mathjs(e,t){if(e=e.replace("[","("),e=e.replace("]",")"),e=e.replace(/root\s*(\d+)/,"root($1)"),e=e.replace(/arc(sin|cos|tan|sec|csc|cot|sinh|cosh|tanh|sech|csch|coth)/gi,"$1^-1"),e=e.replace(/(Sin|Cos|Tan|Sec|Csc|Cot|Arc|Abs|Log|Ln|Sqrt)/gi,matchtolower),null!=t){var r=t.split("|");e=e.replace(/(sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex);var n=new RegExp("(sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root)[(]","g");e=e.replace(n,"$1#(");var n=new RegExp("("+t+")("+t+")$","g");e=e.replace(n,"($1)($2)");var n=new RegExp("("+t+")(a#|sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root)","g");e=e.replace(n,"($1)$2");var n=new RegExp("("+t+")("+t+")([^a-df-zA-Z#])","g");e=e.replace(n,"($1)($2)$3");var n=new RegExp("([^a-df-zA-Z#])("+t+")([^a-df-zA-Z#])","g");e=e.replace(n,"$1($2)$3");var n=new RegExp("([^a-df-zA-Z#(])("+t+")([^a-df-zA-Z#)])","g");e=e.replace(n,"$1($2)$3");var n=new RegExp("^("+t+")([^a-df-zA-Z])","g");e=e.replace(n,"($1)$2");var n=new RegExp("([^a-df-zA-Z])("+t+")$","g");e=e.replace(n,"$1($2)"),e=e.replace(new RegExp("(("+t+"))","g"),function(e){for(var t=0;t<r.length;t++)if(r[t]==e)return"(@v"+t+"@)"}),e=e.replace(/@(\d+)@/g,indextofunc)}e=e.replace(/([0-9])\s+([0-9])/g,"$1*$2"),e=e.replace(/#/g,""),e=e.replace(/\s/g,""),e=e.replace(/log_([a-zA-Z\d\.]+)\(/g,"nthlog($1,"),e=e.replace(/log_\(([a-zA-Z\/\d\.]+)\)\(/g,"nthlog($1,"),e=e.replace(/log/g,"logten"),-1!=e.indexOf("^-1")&&(e=e.replace(/sin\^-1/g,"arcsin"),e=e.replace(/cos\^-1/g,"arccos"),e=e.replace(/tan\^-1/g,"arctan"),e=e.replace(/sec\^-1/g,"arcsec"),e=e.replace(/csc\^-1/g,"arccsc"),e=e.replace(/cot\^-1/g,"arccot"),e=e.replace(/sinh\^-1/g,"arcsinh"),e=e.replace(/cosh\^-1/g,"arccosh"),e=e.replace(/tanh\^-1/g,"arctanh"),e=e.replace(/sech\^-1/g,"arcsech"),e=e.replace(/csch\^-1/g,"arccsch"),e=e.replace(/coth\^-1/g,"arccoth")),e=e.replace(/(sin|cos|tan|sec|csc|cot)\^(\d+)\(/g,"$1n($2,"),e=e.replace(/root\((\d+)\)\(/g,"nthroot($1,"),e=e.replace(/([0-9])E([\-0-9])/g,"$1(EE)$2"),e=e.replace(/^e$/g,"(E)"),e=e.replace(/pi/g,"(pi)"),e=e.replace(/@v(\d+)@/g,function(e,t){return r[t]}),e=e.replace(/^e([^a-zA-Z])/g,"(E)$1"),e=e.replace(/([^a-zA-Z])e$/g,"$1(E)"),e=e.replace(/([^a-zA-Z])e(?=[^a-zA-Z])/g,"$1(E)"),e=e.replace(/([0-9])([\(a-zA-Z])/g,"$1*$2"),e=e.replace(/(!)([0-9\(])/g,"$1*$2"),e=e.replace(/([0-9])\*\(EE\)([\-0-9])/,"$1e$2"),e=e.replace(/\)([\(0-9a-zA-Z]|\.\d+)/g,")*$1");for(var i,a,l,s,o;-1!=(i=e.indexOf("^"));){if(0==i)return"Error: missing argument";if(a=i-1,s=e.charAt(a),s>="0"&&"9">=s){for(a--;a>=0&&(s=e.charAt(a))>="0"&&"9">=s;)a--;if("."==s)for(a--;a>=0&&(s=e.charAt(a))>="0"&&"9">=s;)a--}else if(")"==s){for(o=1,a--;a>=0&&o>0;)s=e.charAt(a),"("==s?o--:")"==s&&o++,a--;for(;a>=0&&((s=e.charAt(a))>="a"&&"z">=s||s>="A"&&"Z">=s);)a--}else{if(!(s>="a"&&"z">=s||s>="A"&&"Z">=s))return"Error: incorrect syntax in "+e+" at position "+a;for(a--;a>=0&&((s=e.charAt(a))>="a"&&"z">=s||s>="A"&&"Z">=s);)a--}if(i==e.length-1)return"Error: missing argument";if(l=i+1,s=e.charAt(l),nch=e.charAt(l+1),s>="0"&&"9">=s||"-"==s&&"("!=nch||"."==s){for(l++;l<e.length&&(s=e.charAt(l))>="0"&&"9">=s;)l++;if("."==s)for(l++;l<e.length&&(s=e.charAt(l))>="0"&&"9">=s;)l++}else if("("==s||"-"==s&&"("==nch)for("-"==s&&l++,o=1,l++;l<e.length&&o>0;)s=e.charAt(l),"("==s?o++:")"==s&&o--,l++;else{if(!(s>="a"&&"z">=s||s>="A"&&"Z">=s))return"Error: incorrect syntax in "+e+" at position "+l;for(l++;l<e.length&&((s=e.charAt(l))>="a"&&"z">=s||s>="A"&&"Z">=s);)l++;if("("==s&&e.slice(i+1,l).match(/^(sin|cos|tan|sec|csc|cot|logten|log|ln|exp|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|sqrt|abs|nthroot)$/))for(o=1,l++;l<e.length&&o>0;)s=e.charAt(l),"("==s?o++:")"==s&&o--,l++}e=e.slice(0,a+1)+"safepow("+e.slice(a+1,i)+","+e.slice(i+1,l)+")"+e.slice(l)}for(;-1!=(i=e.indexOf("!"));){if(0==i)return"Error: missing argument";if(a=i-1,s=e.charAt(a),s>="0"&&"9">=s){for(a--;a>=0&&(s=e.charAt(a))>="0"&&"9">=s;)a--;if("."==s)for(a--;a>=0&&(s=e.charAt(a))>="0"&&"9">=s;)a--}else if(")"==s){for(o=1,a--;a>=0&&o>0;)s=e.charAt(a),"("==s?o--:")"==s&&o++,a--;for(;a>=0&&((s=e.charAt(a))>="a"&&"z">=s||s>="A"&&"Z">=s);)a--}else{if(!(s>="a"&&"z">=s||s>="A"&&"Z">=s))return"Error: incorrect syntax in "+e+" at position "+a;for(a--;a>=0&&((s=e.charAt(a))>="a"&&"z">=s||s>="A"&&"Z">=s);)a--}e=e.slice(0,a+1)+"factorial("+e.slice(a+1,i)+")"+e.slice(i+1)}return e}function setupLivePreview(e){LivePreviews.hasOwnProperty(e)||("MathJax"==mathRenderer||"Katex"==mathRenderer?(LivePreviews[e]={delay:"MathJax"==mathRenderer?100:20,finaldelay:1e3,preview:null,buffer:null,timeout:null,finaltimeout:null,mjRunning:!1,mjPending:!1,oldText:null,Init:function(){$("#p"+e).css("positive","relative").append('<span id="lpbuf1'+e+'" style="visibility:hidden;position:absolute;"></span>').append('<span id="lpbuf2'+e+'" style="visibility:hidden;position:absolute;"></span>'),this.preview=document.getElementById("lpbuf1"+e),this.buffer=document.getElementById("lpbuf2"+e)},SwapBuffers:function(){var e=this.preview,t=this.buffer;this.buffer=e,this.preview=t,e.style.visibility="hidden",e.style.position="absolute",t.style.position="",t.style.visibility=""},Update:function(e){this.timeout&&clearTimeout(this.timeout),this.finaltimeout&&clearTimeout(this.finaltimeout),this.timeout=setTimeout(this.callback,this.delay),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(e){this.buffer.innerHTML=this.oldtext=e,this.mjRunning=!0,this.RenderBuffer()},RenderBuffer:function(){"MathJax"==mathRenderer?MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.buffer],["PreviewDone",this]):"Katex"==mathRenderer&&(renderMathInElement(this.buffer),$(this.buffer).children(".mj").length>0?MathJax.Hub.Queue(["PreviewDone",this]):this.PreviewDone())},DoFinalPreview:function(){$("#pbtn"+e).trigger("click")},preformat:function(t){if(intcalctoproc.hasOwnProperty(e))calcformat[e].match(/inequality/)?(t=t.replace("<=","le").replace(">=","ge").replace("<","lt").replace(">","gt"),t.match(/all\s*real/i)&&(t="text("+t+")")):t=t.replace(/U/g,"uu");else if(vlist.hasOwnProperty(e))t=AMnumfuncPrepVar(e,t)[1];else if(calcformat.hasOwnProperty(e)){var r=calcformat[e];-1==r.indexOf("list")&&-1==r.indexOf("set")&&(t=t.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"))}return t},CreatePreview:function(){if(this.timeout=null,!this.mjPending){if(null==document.getElementById("tc"+e))var t=document.getElementById("qn"+e).value;else var t=document.getElementById("tc"+e).value;t!==this.oldtext&&(this.mjRunning?(this.mjPending=!0,MathJax.Hub.Queue(["CreatePreview",this])):(this.oldtext=t,this.buffer.innerHTML="`"+this.preformat(t)+"`",this.mjRunning=!0,this.RenderBuffer()))}},PreviewDone:function(){this.mjRunning=this.mjPending=!1,this.SwapBuffers(),updateeeddpos(),updateehpos()}},LivePreviews[e].callback=MathJax.Callback(["CreatePreview",LivePreviews[e]]),LivePreviews[e].callback.autoReset=!0,LivePreviews[e].Init()):LivePreviews[e]={finaldelay:1e3,finaltimeout:null,Update:function(e){this.finaltimeout&&clearTimeout(this.finaltimeout),this.finaltimeout=setTimeout(this.DoFinalPreview,this.finaldelay)},RenderNow:function(t){var r=document.getElementById("p"+e);r.innerHTML=t,rendermathnode(r)},DoFinalPreview:function(){$("#pbtn"+e).trigger("click")}})}function updateLivePreview(e){var t=e.id.substr(2);setupLivePreview(t),LivePreviews[t].Update()}function normalizemathunicode(e){return e=e.replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/g,""),e=e.replace(/\u2013|\u2014|\u2015|\u2212/g,"-"),e=e.replace(/\u2044|\u2215/g,"/"),e=e.replace(/∞/g,"oo").replace(/≤/g,"<=").replace(/≥/g,">=").replace(/∪/g,"U"),e=e.replace(/±/g,"+-").replace(/÷/g,"/").replace(/·|✕|×|⋅/g,"*"),e=e.replace(/√/g,"sqrt").replace(/∛/g,"root(3)"),e=e.replace(/²/g,"^2").replace(/³/g,"^3"),e=e.replace(/\bOO\b/i,"oo"),e=e.replace(/θ/,"theta").replace(/φ/,"phi").replace(/π/,"pi").replace(/σ/,"sigma").replace(/μ/,"mu"),e=e.replace(/α/,"alpha").replace(/β/,"beta").replace(/γ/,"gamma").replace(/δ/,"delta").replace(/ε/,"epsilon").replace(/κ/,"kappa"),e=e.replace(/λ/,"lambda").replace(/ρ/,"rho").replace(/τ/,"tau").replace(/χ/,"chi").replace(/ω/,"omega"),e=e.replace(/Ω/,"Omega").replace(/Γ/,"Gamma").replace(/Φ/,"Phi").replace(/Δ/,"Delta").replace(/Σ/,"Sigma")}function wrapAMnotice(e){return'<span class="AMHnotice">'+e+"</span>"}function calculate(inputId,outputId,format){var fullstr=document.getElementById(inputId).value;if(fullstr=normalizemathunicode(fullstr),fullstr=fullstr.replace(/=/,""),-1!=format.indexOf("list"))var strarr=fullstr.split(/,/);else if(-1!=format.indexOf("set"))var strarr=fullstr.replace(/[\{\}]/g,"").split(/,/);else{var strarr=new Array;strarr[0]=fullstr}for(var sc=0;sc<strarr.length;sc++){str=strarr[sc],str=str.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1");var err="";if(str.match(/DNE/i))str=str.toUpperCase();else if(str.match(/oo$/)||str.match(/oo\W/))str="`"+str+"`";else{err+=singlevalsyntaxcheck(str,format),str.match(/,/)&&(err+=_("Invalid use of a comma.")),-1!=format.indexOf("allowxtimes")&&(str=str.replace(/(x|X|\u00D7)/,"*")),-1!=format.indexOf("mixed")?str=str.replace(/_/," "):-1!=format.indexOf("scinot")?str=str.replace(/(x|X|\u00D7)/,"xx"):(str=str.replace(/([0-9])\s+([0-9])/g,"$1*$2"),str=str.replace(/\s/g,"")),err+=syntaxcheckexpr(str,format);try{var evalstr=str;with(evalstr=evalstr.replace(",","*NaN*"),evalstr.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(evalstr=evalstr.replace(/%/,"")+"/100"),-1!=format.indexOf("mixed")&&(evalstr=evalstr.replace(/(\d+)\s+(\d+\s*\/\s*\d+)/,"($1+$2)")),-1!=format.indexOf("scinot")&&(evalstr=evalstr.replace("xx","*")),Math)var res=eval(mathjs(evalstr))}catch(e){err=_("syntax incomplete")+". "+err,res=NaN}isNaN(res)||"Infinity"==res?""!=str&&(str="`"+str+"` = "+_("undefined")+". "+wrapAMnotice(err)):-1!=format.indexOf("fraction")||-1!=format.indexOf("reducedfraction")||-1!=format.indexOf("mixednumber")||-1!=format.indexOf("scinot")||-1!=format.indexOf("noval")?str="`"+str+"` "+wrapAMnotice(err):str="`"+str+" =` "+(Math.abs(res)<1e-15?0:res)+". "+wrapAMnotice(err)}strarr[sc]=str+" "}fullstr=strarr.join(", "),-1!=format.indexOf("set")&&(document.getElementById(inputId).value.match(/^\s*{.*?}\s*$/)?fullstr="{"+fullstr+"}":fullstr+=wrapAMnotice(_("syntax error: this answer must be in set notation, a list wrapped in braces like {1,2,3}")));var qn=outputId.substr(1);setupLivePreview(qn),LivePreviews[qn].RenderNow(fullstr)}function ineqtointerval(e){e=e.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1");var t=e.split(/or/);for(i=0;i<t.length;i++){str=t[i];var r="";(pat=str.match(/^([^<]+)\s*(<=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*(<=?)([^<]+)$/))?(r+="<="==pat[2]?"[":"(",r+=pat[1]+","+pat[5],r+="<="==pat[4]?"]":")"):(pat=str.match(/^([^>]+)\s*(>=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*(>=?)([^>]+)$/))?(r+=">="==pat[4]?"[":"(",r+=pat[5]+","+pat[1],r+=">="==pat[2]?"]":")"):(pat=str.match(/^([^><]+)\s*([><]=?)\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*$/))?">"==pat[2]?r="(-oo,"+pat[1]+")":">="==pat[2]?r="(-oo,"+pat[1]+"]":"<"==pat[2]?r="("+pat[1]+",oo)":"<="==pat[2]&&(r="["+pat[1]+",oo)"):(pat=str.match(/^\s*([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)\s*([><]=?)\s*([^><]+)$/))?"<"==pat[2]?r="(-oo,"+pat[3]+")":"<="==pat[2]?r="(-oo,"+pat[3]+"]":">"==pat[2]?r="("+pat[3]+",oo)":">="==pat[2]&&(r="["+pat[3]+",oo)"):r=str.match(/all\s*real/i)?"(-oo,oo)":"",t[i]=r}return r=t.join("U")}function intcalculate(inputId,outputId,format){var fullstr=document.getElementById(inputId).value;if(fullstr=normalizemathunicode(fullstr),fullstr.match(/DNE/i))fullstr=fullstr.toUpperCase();else if(""==fullstr.replace(/\s+/g,""))fullstr=_("no answer given");else{var calcvals=new Array,calcstrarr=new Array;if(-1!=format.indexOf("inequality")){fullstr=fullstr.replace(/or/g," or ");var origstr=fullstr;fullstr=ineqtointerval(fullstr);var pats=str.match(/\b([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+\b)/),pat=str.match(/([a-zA-Z]\(\s*[a-zA-Z]\s*\)|[a-zA-Z]+)/),ineqvar=null!=pats?pats[1]:null!=pat?pat[1]:""}else{var origstr=fullstr;fullstr=fullstr.replace(/\s+/g,"")}if(-1!=format.indexOf("list")){for(var lastpos=0,strarr=[],pos=1;pos<fullstr.length-1;pos++)","==fullstr.charAt(pos)&&(")"!=fullstr.charAt(pos-1)&&"]"!=fullstr.charAt(pos-1)||"("!=fullstr.charAt(pos+1)&&"["!=fullstr.charAt(pos+1)||(strarr.push(fullstr.substring(lastpos,pos)),lastpos=pos+1));strarr.push(fullstr.substring(lastpos))}else var strarr=fullstr.split(/U/i);var isok=!0,fullerr="";for(i=0;i<strarr.length;i++){if(str=strarr[i],sm=str.charAt(0),em=str.charAt(str.length-1),vals=str.substring(1,str.length-1),vals=vals.split(/,/),2!=vals.length||"("!=sm&&"["!=sm||")"!=em&&"]"!=em){-1!=format.indexOf("inequality")?(origstr=origstr.replace("<=","le").replace(">=","ge").replace("<","lt").replace(">","gt"),fullstr="`"+origstr+"`: "+wrapAMnotice(_("invalid inequality notation"))):fullstr="`"+origstr.replace(/U/g,"uu")+"`: "+wrapAMnotice(_("invalid interval notation")),isok=!1;break}for(j=0;j<2;j++)if(vals[j].match(/oo$/)||vals[j].match(/oo\W/))calcvals[j]=vals[j];else{var err="";if(res=NaN,err+=singlevalsyntaxcheck(vals[j],format),-1!=format.indexOf("mixed")?vals[j]=vals[j].replace(/_/," "):vals[j]=vals[j].replace(/\s/g,""),err+=syntaxcheckexpr(vals[j],format),""==err)try{with(Math)var res=eval(mathjs(vals[j]))}catch(e){err=_("syntax incomplete")+". "}isNaN(res)||"Infinity"==res?calcvals[j]=_("undefined"):(vals[j]=vals[j],calcvals[j]=(Math.abs(res)<1e-15?0:res).toString()),""!=err&&(fullerr+=err)}strarr[i]=sm+vals[0]+","+vals[1]+em,-1!=format.indexOf("inequality")?(calcvals[0].match(/oo/)?calcvals[1].match(/oo/)?calcstrarr[i]="RR":calcstrarr[i]=ineqvar+("]"==em?"le":"lt")+calcvals[1]:calcvals[1].match(/oo/)?calcstrarr[i]=ineqvar+("["==sm?"ge":"gt")+calcvals[0]:calcstrarr[i]=calcvals[0]+("["==sm?"le":"lt")+ineqvar+("]"==em?"le":"lt")+calcvals[1],calcstrarr[i]=calcstrarr[i].replace("undefined",'"undefined"')):calcstrarr[i]=sm+calcvals[0]+","+calcvals[1]+em}isok&&(-1!=format.indexOf("inequality")?origstr.match(/all\s*real/)?fullstr=origstr:(origstr=origstr.replace(/or/g,' \\ "or" \\ '),origstr=origstr.replace(/<=/g,"le"),origstr=origstr.replace(/>=/g,"ge"),origstr=origstr.replace(/</g,"lt"),origstr=origstr.replace(/>/g,"gt"),fullstr=-1!=format.indexOf("fraction")||-1!=format.indexOf("reducedfraction")||-1!=format.indexOf("mixednumber")||-1!=format.indexOf("scinot")||-1!=format.indexOf("noval")?"`"+origstr+"`. "+wrapAMnotice(fullerr):"`"+origstr+"= "+calcstrarr.join(' \\ "or" \\ ')+"`. "+wrapAMnotice(fullerr)):fullstr=-1!=format.indexOf("fraction")||-1!=format.indexOf("reducedfraction")||-1!=format.indexOf("mixednumber")||-1!=format.indexOf("scinot")||-1!=format.indexOf("noval")?"`"+strarr.join("uu")+"`. "+wrapAMnotice(fullerr):-1!=format.indexOf("list")?"`"+strarr.join(",")+"` = "+calcstrarr.join(" , ")+". "+wrapAMnotice(fullerr):"`"+strarr.join("uu")+"` = "+calcstrarr.join(" U ")+". "+wrapAMnotice(fullerr))}var qn=outputId.substr(1);setupLivePreview(qn),LivePreviews[qn].RenderNow(fullstr)}function ntuplecalc(inputId,outputId,format){var fullstr=document.getElementById(inputId).value;if(fullstr=normalizemathunicode(fullstr),fullstr=fullstr.replace(/\s+/g,""),fullstr.match(/DNE/i))fullstr=fullstr.toUpperCase(),outcalced="DNE",outstr="DNE";else{var outcalced="",NCdepth=0,lastcut=0,err="",notationok=!0;fullstr.charAt(0).match(/[\(\[\<\{]/)||(notationok=!1);for(var i=0;i<fullstr.length;i++)if(dec=!1,0==NCdepth&&(outcalced+=fullstr.charAt(i),lastcut=i+1,","==fullstr.charAt(i)&&(fullstr.charAt(i+1).match(/[\(\[\<\{]/)&&fullstr.charAt(i-1).match(/[\)\]\>\}]/)||(notationok=!1))),fullstr.charAt(i).match(/[\(\[\<\{]/)?NCdepth++:fullstr.charAt(i).match(/[\)\]\>\}]/)&&(NCdepth--,dec=!0),
0==NCdepth&&dec||1==NCdepth&&","==fullstr.charAt(i)){sub=fullstr.substring(lastcut,i),res=NaN;try{with(Math)var res=eval(mathjs(sub))}catch(e){err+=_("syntax incomplete")+". "}err+=singlevalsyntaxcheck(sub,format),-1!=format.indexOf("mixed")?sub=sub.replace(/_/," "):sub=sub.replace(/\s/g,""),err+=syntaxcheckexpr(sub,format),outcalced+=isNaN(res)||"Infinity"==res?_("undefined"):res,outcalced+=fullstr.charAt(i),lastcut=i+1}0!=NCdepth&&(notationok=!1),0==notationok&&(err+=_("Invalid notation")+". "),-1!=format.indexOf("fraction")||-1!=format.indexOf("reducedfraction")||-1!=format.indexOf("mixednumber")||-1!=format.indexOf("scinot")||-1!=format.indexOf("noval")||0==notationok?outstr="`"+fullstr+"`. "+wrapAMnotice(err):outstr="`"+fullstr+"` = "+outcalced+". "+wrapAMnotice(err)}if(null!=outputId){var qn=outputId.substr(1);setupLivePreview(qn),LivePreviews[qn].RenderNow(outstr)}return outcalced}function complexcalc(inputId,outputId,format){var fullstr=document.getElementById(inputId).value;if(fullstr=normalizemathunicode(fullstr),fullstr=fullstr.replace(/\s+/g,""),fullstr.match(/DNE/i))fullstr=fullstr.toUpperCase(),outcalced="DNE",outstr="DNE";else{for(var outcalced="",err="",arr=fullstr.split(","),cnt=0;cnt<arr.length;cnt++){var prep=mathjs(arr[cnt],"i");if(-1==format.indexOf("sloppycomplex")){var cparts=parsecomplex(arr[cnt]);err+=singlevalsyntaxcheck(cparts[0],format),err+=singlevalsyntaxcheck(cparts[1],format)}err+=syntaxcheckexpr(arr[cnt],format);try{with(Math)var real=scopedeval("var i=0;"+prep);with(Math)var imag=scopedeval("var i=1;"+prep)}catch(e){err+=_("syntax incomplete")}if(("synerr"==real||"synerr"==imag)&&(err+=_("syntax incomplete"),real=NaN),isNaN(real)||"Infinity"==real||isNaN(imag)||"Infinity"==imag){outcalced+=_("undefined");break}imag-=real,0!=cnt&&(outcalced+=","),outcalced+=real+(imag>=0?"+":"")+imag+"i"}-1!=format.indexOf("fraction")||-1!=format.indexOf("reducedfraction")||-1!=format.indexOf("mixednumber")||-1!=format.indexOf("scinot")||-1!=format.indexOf("noval")?outstr="`"+fullstr+"`. "+wrapAMnotice(err):outstr="`"+fullstr+"` = "+outcalced+". "+wrapAMnotice(err)}if(null!=outputId){var qn=outputId.substr(1);setupLivePreview(qn),LivePreviews[qn].RenderNow(outstr)}return outcalced}function parsecomplex(e){var t,r,n,i,a,l,s;e=e.replace(/\s/,""),e=e.replace(/sin/,"s$n"),e=e.replace(/pi/,"p$");var o=e.length;if(e.split("i").length>2)return _("error - more than 1 i in expression");if(a=e.indexOf("i"),-1==a)t=e,r="0";else{for(i=0,s=a-1;s>0;s--)if(n=e.charAt(s),")"==n)i++;else if("("==n)i--;else if(("+"==n||"-"==n)&&0==i)break;for(i=0,l=a+1;o>l;l++)if(n=e.charAt(l),"("==n)i++;else if(")"==n)i--;else if(("+"==n||"-"==n)&&0==i)break;if(a-s>1&&l-a>1)return _("error - invalid form");if(a-s>1)r=e.substr(s,a-s),t=e.substr(0,s)+e.substr(a+1);else if(l-a>1)if(a>0){if("+"!=e.charAt(a-1)&&"-"!=e.charAt(a-1))return _("error - invalid form");r=e.charAt(a-1)+e.substr(a+1+("*"==e.charAt(a+1)?1:0),l-a-1),t=e.substr(0,a-1)+e.substr(l)}else r=e.substr(a+1,l-a-1),t=e.substr(0,a)+e.substr(l);else r="+"==e.charAt(s)?"1":"-"==e.charAt(s)?"-1":0==a?"1":e.charAt(s),t=(a>0?e.substr(0,s):"")+e.substr(a+1);""==t&&(t="0"),"/"==r.charAt(0)?r="1"+r:"+"!=r.charAt(0)&&"-"!=r.charAt(0)||"/"!=r.charAt(1)||(r=r.charAt(0)+"1"+r.substr(1)),"*"==r.charAt(r.length-1)&&(r=r.substr(0,r.length-1)),"+"==r.charAt(0)&&(r=r.substr(1)),"+"==t.charAt(0)&&(t=t.substr(1))}return t=t.replace("s$n","sin"),t=t.replace("p$","pi"),r=r.replace("s$n","sin"),r=r.replace("p$","pi"),[t,r]}function matrixcalc(inputId,outputId,rows,cols){function calced(estr){var err="";try{with(Math)var res=eval(mathjs(estr))}catch(e){err=_("syntax incomplete")}return isNaN(res)||"Infinity"==res?""!=estr&&(estr=_("undefined")):estr=(Math.abs(res)<1e-15?0:res)+err,estr}if(null!=rows&&null!=cols){for(var count=0,str="[",calcstr="[",row=0;rows>row;row++){row>0&&(str+=",",calcstr+=","),str+="(",calcstr+="(";for(var col=0;cols>col;col++)col>0&&(str+=",",calcstr+=","),val=normalizemathunicode(document.getElementById(inputId+"-"+count).value),str+=val,calcstr+=calced(val),count++;str+=")",calcstr+=")"}str+="]",calcstr+="]"}else{var str=normalizemathunicode(document.getElementById(inputId).value),calcstr=str,MCdepth=0;calcstr=calcstr.replace("[","("),calcstr=calcstr.replace("]",")"),calcstr=calcstr.replace(/\s+/g,"");var calclist=new Array;calcstr=calcstr.substring(1,calcstr.length-1);for(var lastcut=0,i=0;i<calcstr.length;i++)"("==calcstr.charAt(i)?MCdepth++:")"==calcstr.charAt(i)?MCdepth--:","==calcstr.charAt(i)&&0==MCdepth&&(calclist[calclist.length]=calcstr.substring(lastcut+1,i-1),lastcut=i+1);calclist[calclist.length]=calcstr.substring(lastcut+1,calcstr.length-1);for(var i=0;i<calclist.length;i++){calclist2=calclist[i].split(",");for(var j=0;j<calclist2.length;j++)calclist2[j]=calced(calclist2[j]);calclist[i]=calclist2.join(",")}calcstr="[("+calclist.join("),(")+")]"}if(str="`"+str+"` = `"+calcstr+"`",null!=outputId){for(var outnode=document.getElementById(outputId),n=outnode.childNodes.length,i=0;n>i;i++)outnode.removeChild(outnode.firstChild);outnode.appendChild(document.createTextNode(str)),noMathRender||rendermathnode(outnode)}return calcstr}function mathjsformat(e,t){var r=document.getElementById(e).value,n=document.getElementById(t);n.value=mathjs(r)}function stringqpreview(e,t){var r=document.getElementById(e).value,n=t.substr(1);setupLivePreview(n),LivePreviews[n].RenderNow("`"+r+"`")}function AMnumfuncPrepVar(e,t){var r=vlist[e],n=(flist[e],r.split("|"));t=t.replace(/,/g,""),t=normalizemathunicode(t);var i=[],a=t;a=a.replace(/(arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth|arcsin|arccos|arctan|arcsec|arccsc|arccot|sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root)/g,functoindex);for(var l=0;l<n.length;l++)if("varE"==n[l])t=t.replace("E","varE"),a=a.replace("E","varE");else{i[l]=!1;for(var s=0;s<n.length;s++)if(l!=s&&n[s].toLowerCase()==n[l].toLowerCase()&&n[s]!=n[l]){i[l]=!0;break}i[l]||(t=t.replace(new RegExp(n[l],"gi"),n[l]),a=a.replace(new RegExp(n[l],"gi"),n[l]))}for(var o,c=new Array,l=0;l<n.length;l++)if(n[l].length>1){var u=!1;if(-1!=arraysearch(n[l].toLowerCase(),greekletters)&&(u=!0),n[l].match(/^\w+_\w+$/)){o=i[l]?"g":"gi";var d=new RegExp(/^(\w+)_(\w+)$/,o).exec(n[l]),m=new RegExp(d[1]+"_\\("+d[2]+"\\)",o);a=a.replace(m,n[l]),t=t.replace(m,n[l]),d[1].length>1&&-1==arraysearch(d[1].toLowerCase(),greekletters)&&(d[1]='"'+d[1]+'"'),d[2].length>1&&-1==arraysearch(d[2].toLowerCase(),greekletters)&&(d[2]='"'+d[2]+'"'),a=a.replace(new RegExp(d[0],o),d[1]+"_"+d[2]),t=t.replace(new RegExp(d[0],"g"),"repvars"+l),n[l]="repvars"+l}else u||"varE"==n[l]||c.push(n[l])}if(c.length>0){vltq=c.join("|");var h=new RegExp("("+vltq+")","g");a=a.replace(h,'"$1"')}return a=a.replace("varE","E"),a=a.replace(/@(\d+)@/g,indextofunc),[t,a,n.join("|")]}function AMpreview(inputId,outputId){var qn=inputId.slice(2),strprocess=AMnumfuncPrepVar(qn,document.getElementById(inputId).value),str=strprocess[0],dispstr=strprocess[1],vl=strprocess[2],fl=flist[qn];ptlist=pts[qn].split(",");var err="",tstpt=0,res=NaN,isnoteqn=!1;1==iseqn[qn]?(str.match(/=/)?str.match(/=/g).length>1&&(isnoteqn=!0):isnoteqn=!0,str=str.replace(/(.*)=(.*)/,"$1-($2)")):str.match(/=/)||(isnoteqn=!0),""!=fl&&(reg=new RegExp("("+fl+")\\(","g"),str=str.replace(reg,"$1*sin($1+")),vars=vl.split("|");for(var totesteqn=mathjs(str,vl);tstpt<ptlist.length&&(isNaN(res)||"Infinity"==res);){var totest="";testvals=ptlist[tstpt].split("~");for(var j=0;j<vars.length;j++)totest+="var "+vars[j]+"="+testvals[j]+";";totest+=totesteqn,err=_("syntax ok");try{with(Math)var res=scopedeval(totest)}catch(e){err=_("syntax error")}"synerr"==res&&(err=_("syntax error")),tstpt++}var formaterr=syntaxcheckexpr(str,"",vl);(isNaN(res)||"Infinity"==res)&&(err=_("syntax error")),""!=formaterr&&(err+=err==_("syntax ok")?". "+_("warning")+": "+formaterr:". "+formaterr),1==iseqn[qn]&&isnoteqn?err=_("syntax error: this is not an equation"):"undefined"!=typeof iseqn[qn]||isnoteqn||(err=_("syntax error: you gave an equation, not an expression"));var qn=outputId.substr(1);setupLivePreview(qn),LivePreviews[qn].RenderNow("`"+dispstr+"` "+wrapAMnotice(err))}function AMmathpreview(e,t){for(var r=document.getElementById(e).value,n=document.getElementById(t),i=n.childNodes.length,a=0;i>a;a++)n.removeChild(n.firstChild);n.appendChild(document.createTextNode("`"+r+"`")),noMathRender||rendermathnode(n)}function singlevalsyntaxcheck(e,t){if(e.match(/DNE/i))return"";if(e.match(/oo$/)||e.match(/oo\W/))return"";if(-1!=t.indexOf("fraction")||-1!=t.indexOf("reducedfraction")){if(e=e.replace(/\s/g,""),!e.match(/^\(?\-?\(?\d+\)?\/\(?\d+\)?$/)&&!e.match(/^\(?\d+\)?\/\(?\-?\d+\)?$/)&&!e.match(/^\s*?\-?\d+\s*$/))return _("not a valid fraction")+". "}else if(-1!=t.indexOf("fracordec")){if(e=e.replace(/\s/g,""),!e.match(/^\-?\(?\d+\s*\/\s*\-?\d+\)?$/)&&!e.match(/^\-?\d+$/)&&!e.match(/^\-?(\d+|\d+\.\d*|\d*\.\d+)$/))return _(" invalid entry format")+". "}else if(-1!=t.indexOf("mixednumber")){if(!e.match(/^\s*\-?\s*\d+\s*(_|\s)\s*\d+\s*\/\s*\d+\s*$/)&&!e.match(/^\s*?\-?\d+\s*$/)&&!e.match(/^\s*\-?\d+\s*\/\s*\-?\d+\s*$/))return _("not a valid mixed number")+". ";e=e.replace(/_/," ")}else if(-1!=t.indexOf("scinot")&&(e=e.replace(/\s/g,""),e=e.replace(/(x|X|\u00D7)/,"xx"),!e.match(/^\-?[1-9](\.\d*)?(\*|xx)10\^(\(?\-?\d+\)?)$/)))return _("not valid scientific notation")+". ";return""}function syntaxcheckexpr(e,t,r){var n="";-1!=t.indexOf("notrig")&&e.match(/(sin|cos|tan|cot|sec|csc)/i)?n+=_("no trig functions allowed")+". ":-1!=t.indexOf("nodecimal")&&-1!=e.indexOf(".")&&(n+=_("no decimals allowed")+". ");for(var i=0,a=0,l=0;l<e.length;l++)"("==e.charAt(l)?i++:")"==e.charAt(l)?i--:"["==e.charAt(l)?a++:"]"==e.charAt(l)&&a--;return(0!=i||0!=a)&&(n+=" ("+_("unmatched parens")+"). "),r?reg=new RegExp("(sqrt|ln|log|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*("+r+"|\\d+)","i"):reg=new RegExp("(sqrt|ln|log|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs)s*(\\d+)","i"),errstuff=e.match(reg),null!=errstuff&&(n+="["+_("use function notation")+" - "+_("use $1 instead of $2",errstuff[1]+"("+errstuff[2]+")",errstuff[0])+"]. "),r&&(reg=new RegExp("(repvars\\d+|"+r+"|arc|sqrt|root|ln|log|sinh|cosh|tanh|sech|csch|coth|sin|cos|tan|sec|csc|cot|abs|pi|e|sign|DNE|oo)","ig"),e.replace(reg,"").match(/[a-zA-Z]/)&&(n+=_(" Check your variables - you might be using an incorrect one")+". ")),e.match(/\|/)&&(n+=_(" Use abs(x) instead of |x| for absolute values")+". "),e.match(/%/)&&!e.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(n+=_(" Do not use the percent symbol, %")+". "),n}function doonsubmit(form,type2,skipconfirm){for(var qn in callbackstack)callbackstack[qn](qn);if(null!=form){if("submitted"==form.className)return alert(_("You have already submitted this page.  Please be patient while your submission is processed.")),form.className="submitted2",!1;if("submitted2"==form.className)return!1;if(form.className="submitted",!skipconfirm){if(type2)var reallysubmit=confirmSubmit2(form);else var reallysubmit=confirmSubmit(form);if(!reallysubmit)return form.className="",!1}}for(var qn in intcalctoproc)if(qn=parseInt(qn),null!=document.getElementById("tc"+qn)){if(fullstr=document.getElementById("tc"+qn).value,fullstr=fullstr.replace(/\s+/g,""),fullstr=normalizemathunicode(fullstr),fullstr.match(/DNE/i))fullstr=fullstr.toUpperCase();else{if(-1!=calcformat[qn].indexOf("inequality")&&(fullstr=ineqtointerval(fullstr)),-1!=calcformat[qn].indexOf("list")){for(var lastpos=0,strarr=[],pos=1;pos<fullstr.length-1;pos++)","==fullstr.charAt(pos)&&(")"!=fullstr.charAt(pos-1)&&"]"!=fullstr.charAt(pos-1)||"("!=fullstr.charAt(pos+1)&&"["!=fullstr.charAt(pos+1)||(strarr.push(fullstr.substring(lastpos,pos)),lastpos=pos+1));strarr.push(fullstr.substring(lastpos))}else var strarr=fullstr.split(/U/i);for(k=0;k<strarr.length;k++)if(str=strarr[k],str.length>0&&str.match(/,/)){for(sm=str.charAt(0),em=str.charAt(str.length-1),vals=str.substring(1,str.length-1),vals=vals.split(/,/),j=0;2>j;j++)if(!vals[j].match(/oo$/)&&!vals[j].match(/oo\W/)){var err="";try{with(Math)var res=eval(mathjs(vals[j]))}catch(e){err="syntax incomplete"}isNaN(res)||"Infinity"==res||(vals[j]=(Math.abs(res)<1e-15?0:res)+err)}strarr[k]=sm+vals[0]+","+vals[1]+em}-1!=calcformat[qn].indexOf("list")?fullstr=strarr.join(","):fullstr=strarr.join("U")}document.getElementById("qn"+qn).value=fullstr}for(var qn in calctoproc)if(qn=parseInt(qn),null!=document.getElementById("tc"+qn)){if(str=document.getElementById("tc"+qn).value,str=normalizemathunicode(str),str=str.replace(/=/,""),-1!=calcformat[qn].indexOf("list"))strarr=str.split(/,/);else if(-1!=calcformat[qn].indexOf("set")){if(!str.match(/^\s*{.*?}\s*$/))continue;strarr=str.replace(/^\s*{(.*?)}\s*$/,"$1").split(/,/)}else{var strarr=new Array;strarr[0]=str}for(var sc=0;sc<strarr.length;sc++){if(str=strarr[sc],str=str.replace(/(\d)\s*,\s*(?=\d{3}\b)/g,"$1"),str=str.replace(",","*NaN*"),(-1!=calcformat[qn].indexOf("scinot")||-1!=calcformat[qn].indexOf("allowxtimes"))&&(str=str.replace(/(x|X|\u00D7)/,"*")),str.match(/^\s*[+-]?\s*((\d+(\.\d*)?)|(\.\d+))\s*%\s*$/)&&(str=str.replace(/%/,"")+"/100"),str=str.replace(/(\d+)\s*_\s*(\d+\s*\/\s*\d+)/,"($1+$2)"),-1!=calcformat[qn].indexOf("mixed")&&(str=str.replace(/(\d+)\s+(\d+\s*\/\s*\d+)/,"($1+$2)")),str.match(/^\s*$/))var res="";else if(str.match(/oo$/)||str.match(/oo\W/))var res=str;else if(str.match(/DNE/i))var res=str.toUpperCase();else try{with(Math)var res=eval(mathjs(str))}catch(e){var res=""}strarr[sc]=res}document.getElementById("qn"+qn).value=strarr.join(",")}for(var qn in matcalctoproc){if(qn=parseInt(qn),null!=matsize[qn]){if(null==document.getElementById("qn"+qn+"-0"))continue;msize=matsize[qn].split(","),str=matrixcalc("qn"+qn,null,msize[0],msize[1])}else{if(null==document.getElementById("tc"+qn))continue;str=matrixcalc("tc"+qn,null)}document.getElementById("qn"+qn).value=str}for(var qn in ntupletoproc)qn=parseInt(qn),null!=document.getElementById("tc"+qn)&&(str=ntuplecalc("tc"+qn,null,""),document.getElementById("qn"+qn).value=str);for(var qn in complextoproc)qn=parseInt(qn),null!=document.getElementById("tc"+qn)&&(str=complexcalc("tc"+qn,null,""),document.getElementById("qn"+qn).value=str);for(var qn in functoproc)if(qn=parseInt(qn),null!=document.getElementById("tc"+qn)){if(str=document.getElementById("tc"+qn).value,str=str.replace(/,/g,""),str=normalizemathunicode(str),1==iseqn[qn])str=str.replace(/(.*)=(.*)/,"$1-($2)");else if(str.match("="))continue;fl=flist[qn],varlist=vlist[qn],vars=varlist.split("|");for(var i=0;i<vars.length;i++){foundaltcap=!1;for(var j=0;j<vars.length;j++)if(i!=j&&vars[j].toLowerCase()==vars[i].toLowerCase()&&vars[j]!=vars[i]){foundaltcap=!0;break}if(foundaltcap?regmod="g":(str=str.replace(new RegExp(vars[i],"gi"),vars[i]),regmod="gi"),vars[i].length>2&&vars[i].match(/^\w+_\w+$/)){var varpts=vars[i].match(/^(\w+)_(\w+)$/);str=str.replace(new RegExp(varpts[1]+"_\\("+varpts[2]+"\\)",regmod),vars[i]),str=str.replace(new RegExp(varpts[0],"g"),"repvars"+i),vars[i]="repvars"+i}else"varE"==vars[i]&&(str=str.replace("E","varE"))}varlist=vars.join("|"),""!=fl&&(reg=new RegExp("("+fl+")\\(","g"),str=str.replace(reg,"$1*sin($1+")),vars=varlist.split("|");var nh=document.getElementById("qn"+qn);nh.value=mathjs(str,varlist),ptlist=pts[qn].split(","),vals=new Array;for(var fj=0;fj<ptlist.length;fj++){inputs=ptlist[fj].split("~"),totest="";for(var fk=0;fk<inputs.length;fk++)totest+="var "+vars[fk]+"="+inputs[fk]+";";""==nh.value?totest+=Math.random()+";":totest+=nh.value+";";try{with(Math)vals[fj]=scopedeval(totest)}catch(e){vals[fj]=NaN}"synerr"==vals[fj]&&(vals[fj]=NaN)}document.getElementById("qn"+qn+"-vals").value=vals.join(",")}return!0}function scopedeval(c){var res;try{with(Math)res=eval(c);return res}catch(e){return"synerr"}}function arraysearch(e,t){for(var r=0;r<t.length;r++)if(t[r]==e)return r;return-1}function toggleinlinebtn(e,t){var r=document.getElementById(e);if("none"==r.style.display?r.style.display="":r.style.display="none",null!=t){var n=document.getElementById(t),i=n.innerHTML;n.innerHTML=i.match(/\+/)?i.replace(/\+/,"-"):i.replace(/\-/,"+")}}function assessbackgsubmit(e,t){if(null!=t&&document.getElementById(t).innerHTML==_("Submitting..."))return!1;if(window.XMLHttpRequest?req=new XMLHttpRequest:window.ActiveXObject&&(req=new ActiveXObject("Microsoft.XMLHTTP")),"undefined"!=typeof req){if("undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),doonsubmit(),params="embedpostback=true",null!=e){for(var r=new Array,n=document.getElementsByTagName("input"),i=0;i<n.length;i++)r.push(n[i]);for(var n=document.getElementsByTagName("select"),i=0;i<n.length;i++)r.push(n[i]);for(var n=document.getElementsByTagName("textarea"),i=0;i<n.length;i++)r.push(n[i]);for(var a=new RegExp("^(qn|tc|qs)("+e+"\\b|"+(e+1)+"\\d{3})"),i=0;i<r.length;i++)r[i].name.match(a)&&("radio"!=r[i].type&&"checkbox"!=r[i].type||r[i].checked)&&(params+="&"+r[i].name+"="+encodeURIComponent(r[i].value));params+="&toscore="+e,params+="&verattempts="+document.getElementById("verattempts"+e).value}else{for(var r=document.getElementsByTagName("input"),i=0;i<r.length;i++)r[i].name.match(/^(qn|tc)/)&&("radio"!=r[i].type||"checkbox"!=r[i].type||r[i].checked)&&(params+="&"+r[i].name+"="+encodeURIComponent(r[i].value));params+="&verattempts="+document.getElementById("verattempts").value}params+="&asidverify="+document.getElementById("asidverify").value,params+="&disptime="+document.getElementById("disptime").value,params+="&isreview="+document.getElementById("isreview").value,null!=t&&(document.getElementById(t).innerHTML=_("Submitting...")),req.open("POST",assesspostbackurl,!0),req.setRequestHeader("Content-type","application/x-www-form-urlencoded"),req.onreadystatechange=function(){assessbackgsubmitCallback(e,t)},req.send(params)}else null!=t&&(document.getElementById(t).innerHTML=_("Error Submitting."))}function assessbackgsubmitCallback(qn,noticetgt){if(4==req.readyState)if(200==req.status){if(null!=noticetgt&&(document.getElementById(noticetgt).innerHTML=""),null!=qn){for(var scripts=new Array,resptxt=req.responseText;resptxt.indexOf("<script")>-1||resptxt.indexOf("</script")>-1;){var s=resptxt.indexOf("<script"),s_e=resptxt.indexOf(">",s),e=resptxt.indexOf("</script",s),e_e=resptxt.indexOf(">",e);scripts.push(resptxt.substring(s_e+1,e)),resptxt=resptxt.substring(0,s)+resptxt.substring(e_e+1)}document.getElementById("embedqwrapper"+qn).innerHTML=resptxt,usingASCIIMath&&rendermathnode(document.getElementById("embedqwrapper"+qn)),usingASCIISvg&&setTimeout("drawPics()",100),usingTinymceEditor&&initeditor("textareas","mceEditor"),initstack.length=0;for(var i=0;i<scripts.length;i++)try{(k=scripts[i].match(/canvases\[(\d+)\]/))&&("undefined"!=typeof G_vmlCanvasManager&&(scripts[i]=scripts[i]+'G_vmlCanvasManager.initElement(document.getElementById("canvas'+k[1]+'"));'),scripts[i]=scripts[i]+"imathasDraw.initCanvases("+k[1]+");"),eval(scripts[i])}catch(ex){}for(var i=0;i<initstack.length;i++)var foo=initstack[i]();var qnlen=(qn+1).toString().length;for(i in LivePreviews)(i==qn||i>999&&i.toString().substr(0,qnlen)==qn+1)&&LivePreviews[i].Init();$(window).trigger("ImathasEmbedReload"),initcreditboxes();var pagescroll=0;if("undefined"!=typeof window.pageYOffset)pagescroll=window.pageYOffset;else{var B=document.body,D=document.documentElement;D=D.clientHeight?D:B,pagescroll=D.scrollTop}var elpos=findPos(document.getElementById("embedqwrapper"+qn))[1];pagescroll>elpos&&setTimeout(function(){window.scroll(0,elpos)},150)}}else null!=noticetgt&&(document.getElementById(noticetgt).innerHTML=_("Submission Error")+":\n"+req.status+"\n"+req.statusText)}function AutoSuggest(e,t){var r=this;this.elem=e,this.suggestions=t,this.eligible=new Array,this.inputText=null,this.highlighted=-1,this.div=document.getElementById("autosuggest"),null==this.div&&(this.div=document.createElement("div"),this.div.id="autosuggest",document.getElementsByTagName("body")[0].appendChild(this.div),this.div.appendChild(document.createElement("ul")));var n=9,a=27,l=38,s=40,o=13;if(e.setAttribute("autocomplete","off"),!e.id){var c="autosuggest"+AutoSuggestIdCounter;AutoSuggestIdCounter++,e.id=c}e.onkeydown=function(e){var t=r.getKeyCode(e);switch(t){case n:r.useSuggestion("tab");break;case o:return r.useSuggestion("enter"),!1;case a:r.hideDiv();break;case l:r.highlighted>0&&r.highlighted--,r.changeHighlight(t);break;case s:r.highlighted<r.eligible.length-1&&r.highlighted++,r.changeHighlight(t)}},e.onkeyup=function(e){var t=r.getKeyCode(e);switch(t){case n:case a:case l:case s:return;default:this.value.length>1?(r.inputText=this.value,r.getEligible(),r.eligible.length>0?r.highlighted=0:r.highlighted=-1,r.createDiv(),r.positionDiv(),r.showDiv()):(r.hideDiv(),0==this.value.length&&(r.inputText=""))}},e.onblur=function(e){setTimeout(r.hideDiv,100)},this.useSuggestion=function(e){this.highlighted>-1?(this.elem.value=this.eligible[this.highlighted],this.hideDiv()):this.hideDiv()},this.showDiv=function(){this.div.style.display="block"},this.hideDiv=function(){r.div.style.display="none",r.highlighted=-1},this.changeHighlight=function(){var e=this.div.getElementsByTagName("LI");for(i in e){var t=e[i];this.highlighted==i?t.className="selected":t.className=""}},this.positionDiv=function(){var e=this.elem,t=findPos(e);t[1]+=e.offsetHeight,this.div.style.left=t[0]+"px",this.div.style.top=t[1]+"px"},this.createDiv=function(){var e=document.createElement("ul");for(i in this.eligible){var t=this.eligible[i],n=document.createElement("li"),a=document.createElement("a");a.href="#",a.onclick=function(){return!1},a.innerHTML=t,n.appendChild(a),r.highlighted==i&&(n.className="selected"),e.appendChild(n)}this.div.replaceChild(e,this.div.childNodes[0]),e.onmouseover=function(e){for(var t=r.getEventSource(e);t.parentNode&&"LI"!=t.tagName.toUpperCase();)t=t.parentNode;var n=r.div.getElementsByTagName("LI");for(i in n){var a=n[i];if(a==t){r.highlighted=i;break}}r.changeHighlight()},e.onclick=function(e){return r.useSuggestion("click"),r.hideDiv(),r.cancelEvent(e),!1},this.div.className="suggestion_list",this.div.style.position="absolute"},this.getEligible=function(){this.eligible=new Array;var e=",";if(-1==this.inputText.indexOf(" ")){var t=new RegExp("\\b"+this.inputText.toLowerCase());for(i in this.suggestions){var r=this.suggestions[i];r.toLowerCase().match(t)&&(this.eligible[this.eligible.length]=r,e+=i+",")}}},this.getKeyCode=function(e){return e?e.keyCode:window.event?window.event.keyCode:void 0},this.getEventSource=function(e){return e?e.target:window.event?window.event.srcElement:void 0},this.cancelEvent=function(e){e&&(e.preventDefault(),e.stopPropagation()),window.event&&(window.event.returnValue=!1)}}function isBlank(e){return!e||0===e.length||/^\s*$/.test(e)}function editdebit(e){var t=$("#qn"+(1*e.id.substr(2)-1));!isBlank(e.value)&&t.hasClass("iscredit")&&(t.is("select")?t.css("margin-right",20):t.width(t.width()+20),t.css("padding-left",0),t.removeClass("iscredit"))}function editcredit(e){var t=$("#qn"+(1*e.id.substr(2)-2));isBlank(e.value)||t.hasClass("iscredit")||(t.is("select")?t.css("margin-right",0):t.width(t.width()-20),t.css("padding-left",20),t.addClass("iscredit"))}function initcreditboxes(){$(".creditbox").each(function(e,t){if(!isBlank(t.value)&&20!=$(t).css("padding-left")){var r=$("#qn"+(1*t.id.substr(2)-2));r.is("select")?r.css("margin-right",0):r.width(r.width()-20),r.css("padding-left",20),r.addClass("iscredit")}})}function initqsclickchange(){$("input[id^=qs][value=spec]").each(function(e,t){$(t).siblings("input[type=text]").off("keyup.qsclickchange").on("keyup.qsclickchange",function(e){8!=e.keyCode&&46!=e.keyCode&&$(t).prop("checked",!0)})})}function assessmentTimer(e,t){function r(){if(n=e-Math.floor((Date.now()-c)/1e3),0>=n){if(n=0,clearInterval(s),t){if(document.getElementById("timelimitholder").className="",document.getElementById("timelimitholder").style.color="#f00",document.getElementById("timelimitholder").innerHTML=_("Time limit expired - submitting now"),document.getElementById("timelimitholder").style.fontSize="300%",null==document.getElementById("qform"))return void setTimeout("window.location.pathname='"+imasroot+"/assessment/showtest.php?action=skip&superdone=true'",2e3);var r=document.getElementById("qform"),u=r.getAttribute("action");return r.setAttribute("action",u+"&superdone=true"),doonsubmit(r,!0,!0)&&setTimeout('document.getElementById("qform").submit()',2e3),0}alert(_("Time Limit has elapsed"))}l=Math.floor(n%60),a=Math.floor(n/60%60),i=Math.floor(n/3600),0==i&&5>=a&&(document.getElementById("timeremaining").style.color="#f00"),0==i&&0==a&&5>=l&&(document.getElementById("timeremaining").style.fontSize="150%"),o=(i>0?i+":":"")+(i>0&&10>a?"0":"")+a+":"+(10>l?"0":"")+l,document.getElementById("timeremaining").innerHTML=o}var n,i,a,l,s,o,c=Date.now();s=setInterval(r,1e3),$(document).ready(function(){var e=$("#timerwrap"),t=e.position();$(window).scroll(function(){var r=$(window).scrollTop();r>=t.top?e.addClass("sticky"):e.removeClass("sticky")})})}function toggletimer(){"[x]"==$("#timerhide").text()?($("#timercontent").hide(),$("#timerhide").text("["+_("Show Timer")+"]"),$("#timerhide").attr("title","["+_("Show Timer")+"]")):($("#timercontent").show(),$("#timerhide").text("[x]"),$("#timerhide").attr("title",_("Hide Timer")))}function toggleintroshow(e){var t=document.getElementById("introtoggle"+e),r=document.getElementById("intropiece"+e);t.innerHTML.match("Hide")?(t.innerHTML=t.innerHTML.replace("Hide","Show"),r.style.display="none"):(t.innerHTML=t.innerHTML.replace("Show","Hide"),r.style.display="block")}function togglemainintroshow(e){$("#intro").hasClass("hidden")?($(e).html(_("Hide Intro/Instructions")),$("#intro").removeClass("hidden").addClass("intro")):($("#intro").addClass("hidden"),$(e).html(_("Show Intro/Instructions")))}function checkComplete(e){if("undefined"!=typeof tinyMCE)try{tinyMCE.triggerSave()}catch(t){}if(!e.elements)return!0;for(var r=0;r<e.elements.length;r++){var n=e.elements[r];if("undefined"!=typeof n.type&&"undefined"!=typeof n.name&&""!=n.name&&!$(n).is(":not(:visible)"))if("text"==n.type||"textarea"==n.type||"password"==n.type||"file"==n.type){if(""==n.value)return!1}else if(-1!=n.type.indexOf("select")){if(-1==n.selectedIndex)return!1}else if("radio"==n.type){var i=e[n.name],a=!1;if(i.length)for(var l=0;l<i.length&&!(a=i[l].checked);l++);else a=n.checked;if(!a)return!1}}return!0}function confirmSubmit(e){var t=checkComplete(e);if(t)return!0;var r="Not all question parts have been answered.  Are you sure you want to submit this question?";return confirm(r)}function confirmSubmit2(e){var t=checkComplete(e);if(t)return!0;var r="Not all questions have been answered completely.  If you are saving your answers for later, this is fine.  If you are submitting for grading, are you sure you want to submit now?";return confirm(r)}function showeh(e){if(null==eecurel){unhideeh(0),el=document.getElementById(e);var t=document.getElementById("eh");e!=ehcurel?(ehcurel=e,p=findPos(el),t.style.display="block",t.style.left=p[0]+"px",t.style.top=p[1]+el.offsetHeight+"px"):(t.style.display="none",ehcurel=null),el.focus()}}function reshrinkeh(e){null==eecurel&&e==ehcurel&&(document.getElementById("ehdd").style.display="block",document.getElementById("eh").style.display="none",ehcurel=null,curehdd=e,unhideeh(0))}function unhideeh(e){ehcancelclosetimer()}function hideeh(e){null==ehcurel?ehddclosetimer=window.setTimeout(function(){curehdd=null,document.getElementById("ehdd").style.display="none"},250):ehclosetimer=window.setTimeout(reallyhideeh,250)}function reallyhideeh(){var e=document.getElementById("eh");e.style.display="none",ehcurel=null}function ehcancelclosetimer(){ehclosetimer&&(window.clearTimeout(ehclosetimer),ehclosetimer=null)}function showehdd(e,t,r){if((null==eecurel||eecurel!=e)&&null!=document.getElementById("tips"+r)){if(ehddclosetimer&&e!=curehdd&&(window.clearTimeout(ehddclosetimer),ehddclosetimer=null),e!=ehcurel){var n=document.getElementById("ehdd"),i=document.getElementById(e);p=findPos(i),document.getElementById("ehddtext").innerHTML=t,document.getElementById("eh").innerHTML=document.getElementById("tips"+r).innerHTML,n.style.display="block",n.style.left=p[0]+"px",n.style.top=p[1]+i.offsetHeight+"px"}curehdd=e}}function updateehpos(){if(curehdd||ehcurel){var e=document.getElementById("eh"),t=document.getElementById("ehdd"),r=document.getElementById(curehdd||ehcurel);p=findPos(r),e.style.left=p[0]+"px",e.style.top=p[1]+r.offsetHeight+"px",t.style.left=p[0]+"px",t.style.top=p[1]+r.offsetHeight+"px"}}var closetimer=0,ddmenuitem=0,homemenuloaded=0,tipobj=0,popupwins=[];addLoadEvent(setupFormLimiters);var GB_loaded=!1;addLoadEvent(setselectbycookie);var recordedunload=!1,videoembedcounter=0;jQuery(document).ready(function(e){e(window).on("message",function(t){if(t.originalEvent.data.match(/lti\.frameResize/))for(var r=JSON.parse(t.originalEvent.data),n=document.getElementsByTagName("iframe"),i=0;i<n.length;i++)if(n[i].contentWindow===t.originalEvent.source){e(n[i]).height(r.height);break}})}),jQuery(document).ready(function(e){e("a").each(setuptracklinks),e('a[href*="youtu"]').each(setupvideoembeds),e('a[href*="vimeo"]').each(setupvideoembeds),e("body").fitVids(),e('a[target="_blank"]').each(function(){this.href.match(/youtu/)||this.href.match(/vimeo/)||e(this).append(' <img src="'+imasroot+'/img/extlink.png"/>')})}),jQuery.fn.isolatedScroll=function(){return this.bind("mousewheel DOMMouseScroll",function(e){var t=e.wheelDelta||e.originalEvent&&e.originalEvent.wheelDelta||-e.detail,r=this.scrollTop+jQuery(this).outerHeight()-this.scrollHeight>=0,n=this.scrollTop<=0;(0>t&&r||t>0&&n)&&e.preventDefault()}),this},jQuery(document).ready(function(e){for(var t=e(".fixedonscroll"),r=[],n=0;n<t.length;n++)r[n]=e(t[n]).offset().top,e(t[n]).height()>e(window).height()&&(r[n]=-1);t.length>0&&"left"==e(t[0]).css("float")&&e(window).scroll(function(){for(var n=e(window).scrollTop(),i=0;i<t.length;i++)n>r[i]&&r[i]>0?e(t[i]).css("position","fixed").css("top","5px"):e(t[i]).css("position","static")})}),function(e){"use strict";e.fn.fitVids=function(){return this.each(function(){var t=["iframe[src*='player.vimeo.com']","iframe[src*='youtube.com']","iframe[src*='youtube-nocookie.com']"],r=e(this).find(t.join(","));r.each(function(){var t=e(this);t.parentsUntil(".intro","table").each(function(){e(this).css("width","100%")});var r=t.attr("height")&&!isNaN(parseInt(t.attr("height"),10))?parseInt(t.attr("height"),10):t.height(),n=isNaN(parseInt(t.attr("width"),10))?t.width():parseInt(t.attr("width"),10),i=r/n;if(!t.attr("id")){var a="fitvid"+Math.floor(999999*Math.random());t.attr("id",a)}t.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*i+"%").wrap('<div class="video-wrapper-wrapper"></div>').parent(".video-wrapper-wrapper").css("max-width",n+"px"),t.removeAttr("height").removeAttr("width").css("height","").css("width","")})})}}(window.jQuery||window.Zepto),jQuery(document).ready(function(e){e(".alts").on("change",function(){var e=this.value.split(":");e.length>1&&setAltSelectors(e[0],e[1])}).each(function(t,r){var n=r.value.split(":");null!=(co=readCookie("alt_store_"+n[0]))?setAltSelectors(n[0],co):e(r).hasClass("setDefault")&&setAltSelectors(n[0],n[1])}),e(document).on("keydown",function(t){8!==t.which||e(t.target).is("input[type='text']:not([readonly]),input:not([type]):not([readonly]),input[type='password']:not([readonly]), textarea")||t.preventDefault()})}),+function(e){"use strict";function t(t){var r=t.attr("data-target");r||(r=t.attr("href"),r=r&&/#[A-Za-z]/.test(r)&&r.replace(/.*(?=#[^\s]*$)/,""));var n=r&&e(r);return n&&n.length?n:t.parent()}function r(r){r&&3===r.which||(e(i).remove(),e(a).each(function(){var n=e(this),i=t(n),a={relatedTarget:this};i.hasClass("open")&&(r&&"click"==r.type&&/input|textarea/i.test(r.target.tagName)&&e.contains(i[0],r.target)||(i.trigger(r=e.Event("hide.bs.dropdown",a)),
r.isDefaultPrevented()||(n.attr("aria-expanded","false"),i.removeClass("open").trigger("hidden.bs.dropdown",a))))}))}function n(t){return this.each(function(){var r=e(this),n=r.data("bs.dropdown");n||r.data("bs.dropdown",n=new l(this)),"string"==typeof t&&n[t].call(r)})}var i=".dropdown-backdrop",a='[data-toggle="dropdown"]',l=function(t){e(t).on("click.bs.dropdown",this.toggle)};l.VERSION="3.3.5",l.prototype.toggle=function(n){var i=e(this);if(!i.is(".disabled, :disabled")){var a=t(i),l=a.hasClass("open");if(r(),!l){"ontouchstart"in document.documentElement&&!a.closest(".navbar-nav").length&&e(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(e(this)).on("click",r);var s={relatedTarget:this};if(a.trigger(n=e.Event("show.bs.dropdown",s)),n.isDefaultPrevented())return;i.trigger("focus").attr("aria-expanded","true"),a.toggleClass("open").trigger("shown.bs.dropdown",s)}return!1}},l.prototype.keydown=function(r){if(/(38|40|27|32)/.test(r.which)&&!/input|textarea/i.test(r.target.tagName)){var n=e(this);if(r.preventDefault(),r.stopPropagation(),!n.is(".disabled, :disabled")){var i=t(n),l=i.hasClass("open");if(!l&&27!=r.which||l&&27==r.which)return 27==r.which&&i.find(a).trigger("focus"),n.trigger("click");var s=" li:not(.disabled):visible a",o=i.find(".dropdown-menu"+s);if(o.length){var c=o.index(r.target);38==r.which&&c>0&&c--,40==r.which&&c<o.length-1&&c++,~c||(c=0),o.eq(c).trigger("focus")}}}};var s=e.fn.dropdown;e.fn.dropdown=n,e.fn.dropdown.Constructor=l,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.bs.dropdown.data-api",r).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",a,l.prototype.toggle).on("keydown.bs.dropdown.data-api",a,l.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",l.prototype.keydown)}(jQuery);var pi=Math.PI,ln=Math.log,e=Math.E,arcsin=Math.asin,arccos=Math.acos,arctan=Math.atan,sec=function(e){return 1/Math.cos(e)},csc=function(e){return 1/Math.sin(e)},cot=function(e){return 1/Math.tan(e)},arcsec=function(e){return arccos(1/e)},arccsc=function(e){return arcsin(1/e)},arccot=function(e){return arctan(1/e)},sinh=function(e){return(Math.exp(e)-Math.exp(-e))/2},cosh=function(e){return(Math.exp(e)+Math.exp(-e))/2},tanh=function(e){return(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))},sech=function(e){return 1/cosh(e)},csch=function(e){return 1/sinh(e)},coth=function(e){return 1/tanh(e)},arcsinh=function(e){return ln(e+Math.sqrt(e*e+1))},arccosh=function(e){return ln(e+Math.sqrt(e*e-1))},arctanh=function(e){return ln((1+e)/(1-e))/2},sech=function(e){return 1/cosh(e)},csch=function(e){return 1/sinh(e)},coth=function(e){return 1/tanh(e)},arcsech=function(e){return arccosh(1/e)},arccsch=function(e){return arcsinh(1/e)},arccoth=function(e){return arctanh(1/e)},sign=function(e){return 0==e?0:0>e?-1:1},logten=function(e){return Math.LOG10E*Math.log(e)},sinn=function(e,t){return Math.pow(Math.sin(t),e)},cosn=function(e,t){return Math.pow(Math.cos(t),e)},tann=function(e,t){return Math.pow(Math.tan(t),e)},cscn=function(e,t){return 1/Math.pow(Math.sin(t),e)},secn=function(e,t){return 1/Math.pow(Math.cos(t),e)},cotn=function(e,t){return 1/Math.pow(Math.tan(t),e)},funcstoindexarr="sinh|cosh|tanh|sech|csch|coth|sqrt|ln|log|sin|cos|tan|sec|csc|cot|abs|root|arcsin|arccos|arctan|arcsec|arccsc|arccot|arcsinh|arccosh|arctanh|arcsech|arccsch|arccoth".split("|"),updateeeddpos=function(){},updateehpos=function(){},LivePreviews=[],greekletters=["alpha","beta","chi","delta","epsilon","gamma","phi","psi","sigma","rho","theta","lambda","mu","nu","omega","tau"],calctoproc={},intcalctoproc={},calcformat={},functoproc={},matcalctoproc={},ntupletoproc={},complextoproc={},callbackstack={},matsize={},vlist={},flist={},pts={},iseqn={},AutoSuggestIdCounter=0;initstack.push(initcreditboxes),$(window).on("ImathasEmbedReload",initqsclickchange),initstack.push(initqsclickchange);var canvases=new Array,drawla=new Array,imathasDraw=function(e){function t(e){_[e].length=0,N[e].length=0,C[e].length=0,L[e].length=0,P[e].length=0,O[e].length=0,S[e].length=0,X=e,l(),X=null,z=null,W=null}function r(e,t,r,n,i,a,s,o,c,u,d,m,h,f,g){var v=document.getElementById(t);v.style.userSelect="none",v.style.webkitUserSelect="none",v.style.MozUserSelect="none";var y=p(v);A[e]={el:v,left:y.x,top:y.y,width:v.offsetWidth,height:v.offsetHeight,xmin:i,xmax:a,ymin:s,ymax:o,imgborder:c,imgwidth:u,imgheight:d,mode:m,dotline:h},"string"==typeof g&&-1!=g.indexOf(":")?(g=g.split(":"),A[e].snaptogridx=1*g[0],A[e].snaptogridy=1*g[1]):(A[e].snaptogridx=g,A[e].snaptogridy=g),A[e].pixperx=(u-2*c)/(a-i),A[e].pixpery=s==o?1:(d-2*c)/(o-s),$[e]=document.getElementById(n),null==_[e]&&(_[e]=new Array),null==N[e]&&(N[e]=new Array),null==C[e]&&(C[e]=new Array),null==L[e]&&(L[e]=new Array),null==P[e]&&(P[e]=new Array),null==O[e]&&(O[e]=new Array),null==S[e]&&(S[e]=new Array),m>=5?D[e]=1:D[e]=0,R[e]=f,j[e]=new Image,j[e].onload=function(){var t=X;X=e,l(),X=t},j[e].src=r}function n(e,t,r){for(var n=document.getElementById("drawtools"+t),i=n.getElementsByTagName("span"),s=0;s<i.length;s++)i[s].className="";i=n.getElementsByTagName("img");for(var s=0;s<i.length;s++)i[s].className="";e.className="sel",a(t,r),X=t,l()}function a(e,t){A[e].mode=t}function l(e,t){try{var r=A[X].el.getContext("2d")}catch(n){F||(F=!0,alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)"))}r.fillStyle="rgb(0,0,255)",r.lineWidth=2,r.strokeStyle="rgb(0,0,255)",r.clearRect(0,0,A[X].imgwidth,A[X].imgheight),r.drawImage(j[X],0,0),r.beginPath();for(var i=0;i<O[X].length;i++){var a=i%3;r.strokeStyle=G[a],r.fillStyle=G[a];var l=null,o=null,c=null,u=null,d=null;if(3==O[X][i].length?(o=O[X][i][1][0],u=O[X][i][1][1],c=O[X][i][2][0],d=O[X][i][2][1]):2==O[X][i].length?(o=O[X][i][1][0],u=O[X][i][1][1],c=e,d=t):Q==i&&null!=e&&1==O[X][i].length&&(o=e,u=t),null!=c){if(r.save(),r.fillStyle=Z[a],r.beginPath(),S[X][i]<=10.2){if(o!=O[X][i][0][0])var l=(u-O[X][i][0][1])/(o-O[X][i][0][0]);if(Math.abs(o-O[X][i][0][0])<1||Math.abs(l)>100)r.moveTo(O[X][i][0][0],0),r.lineTo(O[X][i][0][0],A[X].imgheight),c>o?(r.lineTo(A[X].imgwidth,A[X].imgheight),r.lineTo(A[X].imgwidth,0),r.closePath()):(r.lineTo(0,A[X].imgheight),r.lineTo(0,0),r.closePath());else{var m=l*(c-o)+u,h=O[X][i][0][1]-l*O[X][i][0][0],f=O[X][i][0][1]+l*(A[X].imgwidth-O[X][i][0][0]);r.moveTo(0,h),r.lineTo(A[X].imgwidth,f),d>m?(r.lineTo(A[X].imgwidth,A[X].imgheight),r.lineTo(0,A[X].imgheight),r.closePath()):(r.lineTo(A[X].imgwidth,0),r.lineTo(0,0),r.closePath())}}else q(r,O[X][i][0][0],O[X][i][0][1],o,u,c,d,A[X].imgwidth,A[X].imgheight);r.fill(),r.restore()}if(r.beginPath(),null!=o)if(S[X][i]<=10.2){if(o!=O[X][i][0][0])var l=(u-O[X][i][0][1])/(o-O[X][i][0][0]);if(Math.abs(o-O[X][i][0][0])<1||Math.abs(l)>100)10.2==S[X][i]?null!=W&&W.mode>=10&&W.mode<11&&W.num==i&&0==W.subnum?(r.dashedLine(O[X][i][1][0],O[X][i][1][1],O[X][i][1][0],A[X].imgheight),r.dashedLine(O[X][i][1][0],O[X][i][1][1],O[X][i][1][0],0)):(r.dashedLine(O[X][i][0][0],O[X][i][0][1],O[X][i][0][0],A[X].imgheight),r.dashedLine(O[X][i][0][0],O[X][i][0][1],O[X][i][0][0],0)):(r.moveTo(O[X][i][0][0],0),r.lineTo(O[X][i][0][0],A[X].imgheight),r.stroke());else{var h=O[X][i][0][1]-l*O[X][i][0][0],f=O[X][i][0][1]+l*(A[X].imgwidth-O[X][i][0][0]);10.2==S[X][i]?null!=W&&W.mode>=10&&W.mode<11&&W.num==i&&0==W.subnum?(r.dashedLine(O[X][i][1][0],O[X][i][1][1],A[X].imgwidth,f),r.dashedLine(O[X][i][1][0],O[X][i][1][1],0,h)):(r.dashedLine(O[X][i][0][0],O[X][i][0][1],A[X].imgwidth,f),r.dashedLine(O[X][i][0][0],O[X][i][0][1],0,h)):(r.moveTo(0,h),r.lineTo(A[X].imgwidth,f),r.stroke())}}else if(10.3==S[X][i]){if(o!=O[X][i][0][0])if(u==O[X][i][0][1])r.moveTo(0,u),r.lineTo(A[X].imgwidth,u);else{var p=(u-O[X][i][0][1])/((o-O[X][i][0][0])*(o-O[X][i][0][0]));if(u>O[X][i][0][1])var g=Math.sqrt((A[X].imgheight-O[X][i][0][1])/p)+O[X][i][0][0],v=-1*Math.sqrt((A[X].imgheight-O[X][i][0][1])/p)+O[X][i][0][0],y=O[X][i][0][1]-(A[X].imgheight-O[X][i][0][1]),w=A[X].imgheight;else var g=Math.sqrt((0-O[X][i][0][1])/p)+O[X][i][0][0],v=-1*Math.sqrt((0-O[X][i][0][1])/p)+O[X][i][0][0],y=2*O[X][i][0][1],w=0;var x=g+2/3*(O[X][i][0][0]-g),b=w+2/3*(y-w),E=x+(v-g)/3,M=b;r.moveTo(g,w),r.bezierCurveTo(x,b,E,M,v,w)}r.stroke()}else o!=O[X][i][0][0]&&k(r,O[X][i][0][0],O[X][i][0][1],o,u,A[X].imgwidth,A[X].imgheight);r.beginPath();for(var I=0;I<O[X][i].length;I++)2==I?(r.arc(O[X][i][I][0],O[X][i][I][1],4,0,2*Math.PI,!0),r.fill()):r.fillRect(O[X][i][I][0]-3,O[X][i][I][1]-3,6,6);1==O[X][i].length&&null!=o&&r.fillRect(o-3,u-3,6,6),r.beginPath()}r.fillStyle="rgb(0,0,255)",1==R[X]?r.lineWidth=4:r.lineWidth=2,r.strokeStyle="rgb(0,0,255)";for(var i=0;i<L[X].length;i++){if(P[X][i]>=5&&P[X][i]<6){var T,B,l=null,o=null,u=null;if(2==L[X][i].length?(o=L[X][i][1][0],u=L[X][i][1][1]):H==i&&null!=e&&1==L[X][i].length&&(o=e,u=t),null!=o)if(5.3==P[X][i]||5.4==P[X][i]){if(r.moveTo(L[X][i][0][0],L[X][i][0][1]),r.lineTo(o,u),5.4==P[X][i]){var T=[o-L[X][i][0][0],u-L[X][i][0][1]],$=Math.sqrt(T[0]*T[0]+T[1]*T[1]);$>1e-4&&(T=[T[0]/$,T[1]/$],B=[-T[1],T[0]],r.moveTo(o-15*T[0]-4*B[0],u-15*T[1]-5*B[1]),r.lineTo(o,u),r.moveTo(o-15*T[0]+4*B[0],u-15*T[1]+5*B[1]),r.lineTo(o,u))}}else{if(o!=L[X][i][0][0])var l=(u-L[X][i][0][1])/(o-L[X][i][0][0]);if(Math.abs(o-L[X][i][0][0])<1||Math.abs(l)>100)5.2==P[X][i]?(r.moveTo(L[X][i][0][0],L[X][i][0][1]),u>L[X][i][0][1]?r.lineTo(L[X][i][0][0],A[X].imgheight):r.lineTo(L[X][i][0][0],0)):(r.moveTo(L[X][i][0][0],0),r.lineTo(L[X][i][0][0],A[X].imgheight));else{var h=L[X][i][0][1]-l*L[X][i][0][0],f=L[X][i][0][1]+l*(A[X].imgwidth-L[X][i][0][0]),h=L[X][i][0][1]-l*L[X][i][0][0],f=L[X][i][0][1]+l*(A[X].imgwidth-L[X][i][0][0]);5.2==P[X][i]?(r.moveTo(L[X][i][0][0],L[X][i][0][1]),o>L[X][i][0][0]?r.lineTo(A[X].imgwidth,f):r.lineTo(0,h)):(r.moveTo(0,h),r.lineTo(A[X].imgwidth,f))}}}else if(6==P[X][i]){var u=null,o=null;if(2==L[X][i].length?(o=L[X][i][1][0],u=L[X][i][1][1]):H==i&&null!=e&&1==L[X][i].length&&(o=e,u=t),null!=o&&o!=L[X][i][0][0])if(u==L[X][i][0][1])r.moveTo(0,u),r.lineTo(A[X].imgwidth,u);else{var p=(u-L[X][i][0][1])/((o-L[X][i][0][0])*(o-L[X][i][0][0]));if(u>L[X][i][0][1])var g=Math.sqrt((A[X].imgheight-L[X][i][0][1])/p)+L[X][i][0][0],v=-1*Math.sqrt((A[X].imgheight-L[X][i][0][1])/p)+L[X][i][0][0],y=L[X][i][0][1]-(A[X].imgheight-L[X][i][0][1]),w=A[X].imgheight;else var g=Math.sqrt((0-L[X][i][0][1])/p)+L[X][i][0][0],v=-1*Math.sqrt((0-L[X][i][0][1])/p)+L[X][i][0][0],y=2*L[X][i][0][1],w=0;var x=g+2/3*(L[X][i][0][0]-g),b=w+2/3*(y-w),E=x+(v-g)/3,M=b;r.moveTo(g,w),r.bezierCurveTo(x,b,E,M,v,w)}}else if(6.5==P[X][i]){var u=null,o=null;if(2==L[X][i].length?(o=L[X][i][1][0],u=L[X][i][1][1]):H==i&&null!=e&&1==L[X][i].length&&(o=e,u=t),null!=o&&o!=L[X][i][0][0])if(u==L[X][i][0][1])r.moveTo(L[X][i][0][0],u),o>L[X][i][0][0]?r.lineTo(A[X].imgwidth,u):r.lineTo(0,u);else{var D=o<L[X][i][0][0]?-1:1,p=(u-L[X][i][0][1])/Math.sqrt(D*(o-L[X][i][0][0]));r.moveTo(L[X][i][0][0],L[X][i][0][1]),te=L[X][i][0][0],ee=L[X][i][0][1];do te+=3*D,r.lineTo(te,p*Math.sqrt(D*(te-L[X][i][0][0]))+L[X][i][0][1]);while(te>0&&te<A[X].imgwidth&&ee>0&&ee<A[X].imgheight)}}else if(7==P[X][i]){if(2==L[X][i].length?(o=L[X][i][1][0],u=L[X][i][1][1]):H==i&&null!=e&&1==L[X][i].length&&(o=e,u=t),null!=o&&(o!=L[X][i][0][0]||u!=L[X][i][0][1])){var U=Math.sqrt((o-L[X][i][0][0])*(o-L[X][i][0][0])+(u-L[X][i][0][1])*(u-L[X][i][0][1]));r.arc(L[X][i][0][0],L[X][i][0][1],U,0,2*Math.PI,!0)}}else if(8==P[X][i]){var l=null,o=null,u=null;if(2==L[X][i].length?(o=L[X][i][1][0],u=L[X][i][1][1]):H==i&&null!=e&&1==L[X][i].length&&(o=e,u=t),null!=o){if(o!=L[X][i][0][0]){var l=(u-L[X][i][0][1])/(o-L[X][i][0][0]);o<L[X][i][0][0]&&(l*=-1)}if(Math.abs(o-L[X][i][0][0])<1||Math.abs(l)>100)r.moveTo(L[X][i][0][0],L[X][i][0][1]),u>L[X][i][0][1]?r.lineTo(L[X][i][0][0],A[X].imgheight):r.lineTo(L[X][i][0][0],0);else{var h=L[X][i][0][1]+l*L[X][i][0][0],f=L[X][i][0][1]+l*(A[X].imgwidth-L[X][i][0][0]);r.moveTo(0,h),r.lineTo(L[X][i][0][0],L[X][i][0][1]),r.lineTo(A[X].imgwidth,f)}}}else if(8.3==P[X][i]){var u=null,o=null;if(2==L[X][i].length?(o=L[X][i][1][0],u=L[X][i][1][1]):H==i&&null!=e&&1==L[X][i].length&&(o=e,u=t),null!=o&&o!=L[X][i][0][0])if(u==L[X][i][0][1])r.moveTo(0,u),r.lineTo(A[X].imgwidth,u);else{var V=A[X].ymax*A[X].pixpery+A[X].imgborder,Y=V-L[X][i][0][1],J=V-u;if(Y*J>0&&o!=L[X][i][0][0]){var K=safepow(J/Y,1/(o-L[X][i][0][0])),p=J/safepow(K,o);r.moveTo(L[X][i][0][0],L[X][i][0][1]);for(var ee=0,te=0;te<A[X].imgwidth+4;te+=3)ee=V-p*safepow(K,te),-100>ee&&(ee=-100),ee>A[X].imgheight+100&&(ee=A[X].imgheight+100),0==te?r.moveTo(te,ee):r.lineTo(te,ee)}}}else if(8.2==P[X][i]){var u=null,o=null;if(2==L[X][i].length?(o=L[X][i][1][0],u=L[X][i][1][1]):H==i&&null!=e&&1==L[X][i].length&&(o=e,u=t),r.strokeStyle="rgb(0,255,0)",r.dashedLine(5,L[X][i][0][1],A[X].imgwidth,L[X][i][0][1]),r.dashedLine(L[X][i][0][0],5,L[X][i][0][0],A[X].imgheight),r.beginPath(),r.strokeStyle="rgb(0,0,255)",null!=o&&o!=L[X][i][0][0]&&u!=L[X][i][0][1]){for(var p=(u-L[X][i][0][1])*(o-L[X][i][0][0]),te=L[X][i][0][0]-1;te>-4;te-=3)ee=p/(te-L[X][i][0][0])+L[X][i][0][1],-100>ee&&(ee=-100),ee>A[X].imgheight+100&&(ee=A[X].imgheight+100),te==L[X][i][0][0]-1?r.moveTo(te,ee):r.lineTo(te,ee);for(var te=L[X][i][0][0]+1;te<A[X].imgwidth+4;te+=3)ee=p/(te-L[X][i][0][0])+L[X][i][0][1],-100>ee&&(ee=-100),ee>A[X].imgheight+100&&(ee=A[X].imgheight+100),te==L[X][i][0][0]+1?r.moveTo(te,ee):r.lineTo(te,ee);r.stroke()}}else if(9==P[X][i]||9.1==P[X][i]){var u=null,o=null;if(2==L[X][i].length?(o=L[X][i][1][0],u=L[X][i][1][1]):H==i&&null!=e&&1==L[X][i].length&&(o=e,u=t),null!=o&&o!=L[X][i][0][0])if(u==L[X][i][0][1])r.moveTo(0,u),r.lineTo(A[X].imgwidth,u);else{if(9==P[X][i])var re=-1*Math.abs(u-L[X][i][0][1])/2,ne=(u+L[X][i][0][1])/2,p=Math.PI/Math.abs(o-L[X][i][0][0]),ie=u<L[X][i][0][1]?o:L[X][i][0][0];else if(9.1==P[X][i])var re=-1*Math.abs(u-L[X][i][0][1]),ne=L[X][i][0][1],p=.5*Math.PI/Math.abs(o-L[X][i][0][0]),ie=u<L[X][i][0][1]?o:o+2*Math.abs(o-L[X][i][0][0]);for(var ee=0,te=0;te<A[X].imgwidth+4;te+=3)ee=re*Math.cos(p*(te-ie))+ne,0==te?r.moveTo(te,ee):r.lineTo(te,ee)}}r.stroke(),r.beginPath()}var ae,le,se,oe;r.fillStyle="rgba(0,0,255,.5)";for(var i=0;i<_[X].length;i++){r.beginPath();for(var I=0;I<_[X][i].length;I++)0==I?(r.moveTo(_[X][i][I][0],_[X][i][I][1]),ae=_[X][i][I][0],le=_[X][i][I][1]):(r.lineTo(_[X][i][I][0],_[X][i][I][1]),se=_[X][i][I][0],oe=_[X][i][I][1]);i==z&&null!=e&&(r.lineTo(e,t),se=e,oe=t);var ce=.02*A[X].imgwidth;if(1==R[X]&&se>.98*A[X].imgwidth?(r.moveTo(se,oe),r.lineTo(se-ce,oe+ce),r.moveTo(se,oe),r.lineTo(se-ce,oe-ce)):1==R[X]&&ae>.98*A[X].imgwidth&&(r.moveTo(ae,le),r.lineTo(ae-ce,le+ce),r.moveTo(ae,le),r.lineTo(ae-ce,le-ce)),1==R[X]&&se<.02*A[X].imgwidth?(r.moveTo(se,oe),r.lineTo(se+ce,oe+ce),r.moveTo(se,oe),r.lineTo(se+ce,oe-ce)):1==R[X]&&ae<.02*A[X].imgwidth&&(r.moveTo(ae,le),r.lineTo(ae+ce,le+ce),r.moveTo(ae,le),r.lineTo(ae+ce,le-ce)),r.stroke(),A[X].dotline>1){var ue=_[X][i].length-1;if(1>ue)continue;if(Math.pow(se-ae,2)+Math.pow(oe-le,2)<25){r.moveTo(_[X][i][0][0],_[X][i][0][1]);for(var I=1;I<_[X][i].length;I++)r.lineTo(_[X][i][I][0],_[X][i][I][1]);r.closePath(),r.fill()}}}r.fillStyle="rgb(0,0,255)",r.beginPath();for(var i=0;i<N[X].length;i++)r.moveTo(N[X][i][0]+5,N[X][i][1]),r.arc(N[X][i][0],N[X][i][1],5,0,2*Math.PI,!0);if(r.fill(),A[X].dotline>0){r.beginPath();for(var i=0;i<_[X].length;i++)for(var I=0;I<_[X][i].length;I++)(0==I||Math.pow(_[X][i][I][0]-_[X][i][I-1][0],2)+Math.pow(_[X][i][I][1]-_[X][i][I-1][1],2)>25)&&(r.moveTo(_[X][i][I][0]+5,_[X][i][I][1]),r.arc(_[X][i][I][0],_[X][i][I][1],5,0,2*Math.PI,!0));r.fill()}r.fillStyle="rgb(255,255,255)",r.beginPath();for(var i=0;i<C[X].length;i++)r.moveTo(C[X][i][0]+5,C[X][i][1]),r.arc(C[X][i][0],C[X][i][1],4,0,2*Math.PI,!0);A[X].mode<3?r.fill():r.stroke(),r.lineWidth=2,r.beginPath();for(var i=0;i<C[X].length;i++)r.moveTo(C[X][i][0]+5,C[X][i][1]),r.arc(C[X][i][0],C[X][i][1],4,0,2*Math.PI,!0);r.stroke();for(var i=0;i<L[X].length;i++)if(P[X][i]==A[X].mode){r.fillStyle="rgb(255,0,0)";for(var I=0;I<L[X][i].length;I++)r.fillRect(L[X][i][I][0]-3,L[X][i][I][1]-3,6,6);1==L[X][i].length&&null!=e&&H==i&&r.fillRect(e-3,t-3,6,6),r.fillStyle="rgb(0,0,255)"}s()}function s(){for(var e="",t=0;t<_[X].length;t++){0!=t&&(e+=";");for(var r=0;r<_[X][t].length;r++)0!=r&&(e+=","),e+="("+_[X][t][r][0]+","+_[X][t][r][1]+")"}e+=";;";for(var t=0;t<N[X].length;t++)0!=t&&(e+=","),e+="("+N[X][t][0]+","+N[X][t][1]+")";e+=";;";for(var t=0;t<C[X].length;t++)0!=t&&(e+=","),e+="("+C[X][t][0]+","+C[X][t][1]+")";e+=";;";for(var n=[],t=0;t<L[X].length;t++)L[X][t].length>1&&n.push("("+P[X][t]+","+L[X][t][0][0]+","+L[X][t][0][1]+","+L[X][t][1][0]+","+L[X][t][1][1]+")");e+=n.join(","),e+=";;";for(var i=[],t=0;t<O[X].length;t++)O[X][t].length>2&&i.push("("+S[X][t]+","+O[X][t][0][0]+","+O[X][t][0][1]+","+O[X][t][1][0]+","+O[X][t][1][1]+","+O[X][t][2][0]+","+O[X][t][2][1]+")");e+=i.join(","),$[X].value=e}function o(t){if(ee++,g(),V&&t.originalEvent.touches.length>1)return Y=!0,e(document).on("touchend.imathasdraw",u),!0;V?(window.clearTimeout(K),e(document).on("touchstart.imathasdraw",function(e){V=!0,o(e)}),e(document).on("touchmove.imathasdraw",d),e(document).on("touchend.imathasdraw",u)):(e(document).on("mousemove.imathasdraw",d),e(document).on("mouseup.imathasdraw",u));var r=m(t);if(null==X||null==z&&null==H&&null==Q)for(i in A){var n=p(A[i].el);if(n.x<r.x&&n.x+A[i].width>r.x&&n.y<r.y&&n.y+A[i].height>r.y){X=i;break}}if(null!=X){B=!0;var n=p(A[X].el),a={x:r.x-n.x,y:r.y-n.y};if(a.x>-1&&a.x<A[X].width&&a.y>-1&&a.y<A[X].height){navigator.userAgent.match(/Android/i),A[X].snaptogridx>0&&(a=h(a,X)),1==R[X]&&(a.y=A[X].imgheight/2);var s=c(X,a);null!=s&&(null!=z&&s[0]<1&&z!=s[1]?s=null:null!=H&s[0]>=5&&s[0]<10&&H!=s[1]?s=null:null!=Q&&s[0]>=10&&s[0]<11&&Q!=s[1]&&(s=null)),null==s?(A[X].el.style.cursor="url("+imasroot+"/img/pendown.cur), default",1==A[X].mode?(N[X].push([a.x,a.y]),W={mode:1,num:N[X].length-1}):2==A[X].mode?(C[X].push([a.x,a.y]),W={mode:2,num:C[X].length-1}):0==A[X].mode||.7==A[X].mode?null==z?(_[X].push([[a.x,a.y]]),z=_[X].length-1):_[X][z].push([a.x,a.y]):.5==A[X].mode?null==z?(_[X].push([[a.x,a.y]]),z=_[X].length-1):(_[X][z].push([a.x,a.y]),z=null,W=null):A[X].mode>=5&&A[X].mode<10?null==H?(L[X].push([[a.x,a.y]]),H=L[X].length-1,P[X][H]=A[X].mode,B=!1):(L[X][H].push([a.x,a.y]),2==L[X][H].length&&(W={mode:A[X].mode,num:H,subnum:1},H=null)):A[X].mode>=10&&A[X].mode<11&&(null==Q?(O[X].push([[a.x,a.y]]),Q=O[X].length-1,S[X][Q]=A[X].mode,B=!1):(O[X][Q].push([a.x,a.y]),3==O[X][Q].length&&(W={mode:A[X].mode,num:Q,subnum:1},Q=null)))):(0==s[0]||.5==s[0]?null==z?(A[X].el.style.cursor="move",W={mode:A[X].mode,num:s[1],subnum:s[2]},U=_[X][s[1]][s[2]],s[2]==_[X][s[1]].length-1&&0==A[X].mode?z=s[1]:0==s[2]&&0==A[X].mode&&(z=s[1],_[X][z].reverse(),W.subnum=_[X][z].length-1)):s[1]==z&&s[2]==_[X][s[1]].length-1?(_[X][z].length<2&&_[X].splice(z,1),z=null):A[X].dotline>1&&s[1]==z&&0==s[2]?(_[X][z].push(_[X][z][0]),z=null):(A[X].el.style.cursor="url("+imasroot+"/img/pendown.cur), default",_[X][z].push([a.x,a.y])):1==s[0]?(A[X].el.style.cursor="move",W={mode:1,num:s[1]}):2==s[0]?(A[X].el.style.cursor="move",W={mode:2,num:s[1]}):s[0]>=5&&s[0]<10?(A[X].el.style.cursor="move",W={mode:s[0],num:s[1],subnum:s[2]},U=L[X][s[1]][s[2]]):s[0]>=10&&s[0]<11&&(A[X].el.style.cursor="move",W={mode:s[0],num:s[1],subnum:s[2]},U=O[X][s[1]][s[2]]),J=!0),l()}else null!=z&&(_[X][z].length<2&&_[X].splice(z,1),A[X].el.style.cursor="url("+imasroot+"/img/pen.cur), default"),null!=H&&(L[X][H].length<2&&L[X].splice(H,1),A[X].el.style.cursor="url("+imasroot+"/img/pen.cur), default"),null!=Q&&(O[X][Q].length<3&&O[X].splice(Q,1),A[X].el.style.cursor="url("+imasroot+"/img/pen.cur), default"),z=null,H=null,Q=null,W=null,l(),X=null}}function c(e,t){if(V){var r=Math.max(15*window.innerWidth/screen.width,15);r*=r}else var r=25;if(0==D[e]){if(0==A[e].mode||.5==A[e].mode)for(var n=0;n<_[e].length;n++)for(var i=_[e][n].length-1;i>=0;i--){var a=Math.pow(_[e][n][i][0]-t.x,2)+Math.pow(_[e][n][i][1]-t.y,2);if(r>a)return[A[e].mode,n,i]}else if(1==A[e].mode){for(var n=0;n<N[e].length;n++)if(Math.pow(N[e][n][0]-t.x,2)+Math.pow(N[e][n][1]-t.y,2)<r)return[1,n]}else if(2==A[e].mode){for(var n=0;n<C[e].length;n++)if(Math.pow(C[e][n][0]-t.x,2)+Math.pow(C[e][n][1]-t.y,2)<r)return[2,n]}else if(A[e].mode>=5&&A[e].mode<10){for(var n=0;n<L[e].length;n++)if(P[e][n]==A[e].mode)for(var i=L[e][n].length-1;i>=0;i--){var a=Math.pow(L[e][n][i][0]-t.x,2)+Math.pow(L[e][n][i][1]-t.y,2);if(r>a)return[P[e][n],n,i]}}else if(A[e].mode>=10&&A[e].mode<11)for(var n=0;n<O[e].length;n++)for(var i=O[e][n].length-1;i>=0;i--){var a=Math.pow(O[e][n][i][0]-t.x,2)+Math.pow(O[e][n][i][1]-t.y,2);if(r>a)return[S[e][n],n,i]}}else if(1==A[e].mode){for(var n=0;n<N[e].length;n++)if(Math.pow(N[e][n][0]-t.x,2)+Math.pow(N[e][n][1]-t.y,2)<r)return[1,n]}else if(2==A[e].mode){for(var n=0;n<C[e].length;n++)if(Math.pow(C[e][n][0]-t.x,2)+Math.pow(C[e][n][1]-t.y,2)<r)return[2,n]}else if(A[e].mode>=5&&A[e].mode<10){for(var n=0;n<L[e].length;n++)for(var i=L[e][n].length-1;i>=0;i--)if(P[e][n]==A[e].mode){var a=Math.pow(L[e][n][i][0]-t.x,2)+Math.pow(L[e][n][i][1]-t.y,2);if(r>a)return[P[e][n],n,i]}}else if(A[e].mode>=10&&A[e].mode<11)for(var n=0;n<O[e].length;n++)for(var i=O[e][n].length-1;i>=0;i--){var a=Math.pow(O[e][n][i][0]-t.x,2)+Math.pow(O[e][n][i][1]-t.y,2);if(r>a)return[S[e][n],n,i]}return null}function u(t){var r=m(t);if(B=!1,null!=X){var n=p(A[X].el),i={x:r.x-n.x,y:r.y-n.y};A[X].snaptogridx>0&&(i=h(i,X));var a=i.x>-1&&i.x<A[X].width&&i.y>-1&&i.y<A[X].height;1==J&&(A[X].mode>=5&&A[X].mode<10?(L[X].push([[i.x,i.y]]),H=L[X].length-1,P[X][H]=A[X].mode):A[X].mode>=10&&A[X].mode<11&&(O[X].push([[i.x,i.y]]),Q=O[X].length-1,S[X][Q]=A[X].mode)),null!=te&&r.x==te.x&&r.y==te.y&&null!=z&&null==W&&(_[X][z].length<2&&_[X].splice(z,1),z=null,W=null,l()),null!=z&&null==W&&(.5==A[X].mode&&_[X][z].length>1?(z=null,dragobj=null,l()):.7==A[X].mode&&(z=null,dragobj=null,l())),null!=H&&1==L[X][H].length&&(Y||!a?(L[X].splice(H,1),H=null,l()):null==c(X,i)&&(L[X][H].push([i.x,i.y]),H=null,l())),null!=Q&&1==O[X][Q].length&&(Y||!a?(O[X].splice(Q,1),Q=null,l()):null==c(X,i)&&(O[X][Q].push([i.x,i.y]),l())),null==z&&null==H?A[X].el.style.cursor="move":A[X].el.style.cursor="url("+imasroot+"/img/pen.cur), default","undefined"!=typeof t&&t.preventDefault()}if(te=r,null!=X&&null!=W){var n=p(A[X].el);i.x>-1&&i.x<A[X].width&&i.y>-1&&i.y<A[X].height?(0==W.mode&&A[X].dotline>1&&(0==W.subnum||W.subnum==_[X][W.num].length-1)&&Math.pow(_[X][W.num][0][0]-_[X][W.num][_[X][W.num].length-1][0],2)+Math.pow(_[X][W.num][0][1]-_[X][W.num][_[X][W.num].length-1][1],2)<25&&(0==W.subnum?(_[X][W.num][_[X][W.num].length-1][0]=_[X][W.num][0][0],_[X][W.num][_[X][W.num].length-1][1]=_[X][W.num][0][1]):(_[X][W.num][0][0]=_[X][W.num][_[X][W.num].length-1][0],_[X][W.num][0][1]=_[X][W.num][_[X][W.num].length-1][1]),z=null,l()),W=null):(1==R[X]&&(i.y=A[X].imgheight/2),1==W.mode?N[X].splice(W.num,1):2==W.mode?C[X].splice(W.num,1):.5==W.mode?_[X].splice(W.num,1):0==W.mode?_[X][W.num][W.subnum]=U:W.mode>=5&&W.mode<10?(L[X].splice(W.num,1),H=null):W.mode>=10&&W.mode<11&&(O[X].splice(W.num,1),Q=null),W=null,l())}Y=!1,V?K=window.setTimeout(function(){V=!1,g(),e(document).on("mousemove.imathasdraw",d),e(document).on("touchstart.imathasdraw",function(e){V=!0,o(e)}),e(document).on("mousedown.imathasdraw",o)},350):(g(),e(document).on("mousemove.imathasdraw",d),e(document).on("touchstart.imathasdraw",function(e){V=!0,o(e)}),e(document).on("mousedown.imathasdraw",o))}function d(e){var t=null;J=!1;var r=m(e);for(i in A){var n=p(A[i].el);if(n.x<r.x&&n.x+A[i].width>r.x&&n.y<r.y&&n.y+A[i].height>r.y){t=i;break}}if(null!=t){var n=p(A[t].el),a={x:r.x-n.x,y:r.y-n.y};if(A[t].snaptogridx>0&&(a=h(a,t)),1==R[t]&&(a.y=A[t].imgheight/2),a.x>-1&&a.x<A[t].width&&a.y>-1&&a.y<A[t].height&&null==W&&null==z){var s=c(t,a);null==s?A[t].el.style.cursor="url("+imasroot+"/img/pen.cur), default":A[t].el.style.cursor="move"}}if(null!=X){if(e.originalEvent.touches&&e.originalEvent.touches.length>1)return Y=!0,!0;"undefined"!=typeof e&&e.preventDefault();var n=p(A[X].el),a={x:r.x-n.x,y:r.y-n.y};if(A[X].snaptogridx>0&&(a=h(a,X)),1==R[X]&&(a.y=A[X].imgheight/2),a.x>-1&&a.x<A[X].width&&a.y>-1&&a.y<A[X].height){if(null==W)if(null!=z)if(!B||0!=A[X].mode&&.7!=A[X].mode)if(B&&.5==A[X].mode){var o=_[X][z].length-1;if(0==o){var u=Math.pow(_[X][z][o][0]-a.x,2)+Math.pow(_[X][z][o][1]-a.y,2);u>25?(_[X][z].push([a.x,a.y]),l()):l(a.x,a.y)}else _[X][z][o]=[a.x,a.y],l()}else l(a.x,a.y);else{var o=_[X][z].length-1,u=Math.pow(_[X][z][o][0]-a.x,2)+Math.pow(_[X][z][o][1]-a.y,2);u>25?(_[X][z].push([a.x,a.y]),l()):l(a.x,a.y)}else if(null!=H)B?l():l(a.x,a.y);else if(null!=Q)B?l():l(a.x,a.y);else{var s=c(X,a);null==s?A[X].el.style.cursor="url("+imasroot+"/img/pen.cur), default":A[X].el.style.cursor="move"}else A[X].el.style.cursor="move",0==W.mode||.5==W.mode?_[X][W.num][W.subnum]=[a.x,a.y]:1==W.mode?N[X][W.num]=[a.x,a.y]:2==W.mode?C[X][W.num]=[a.x,a.y]:W.mode>=5&&W.mode<10?L[X][W.num][W.subnum]=[a.x,a.y]:W.mode>=10&&W.mode<11&&(O[X][W.num][W.subnum]=[a.x,a.y]),l();return!1}}}function m(e){if(e=e||window.event,V){var t=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0];return{x:t.pageX,y:t.pageY}}if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};var r=document.documentElement,n=document.body;if(r&&(r.scrollTop||r.scrollLeft))var i=r.scrollLeft,a=r.scrollTop;else if(n)var i=n.scrollLeft,a=n.scrollTop;else var i=0,a=0;return{x:e.clientX+i,y:e.clientY+a}}function h(e,t){var r=e.x-A[t].imgborder+A[t].xmin*A[t].pixperx,n=e.y-A[t].imgborder-A[t].ymax*A[t].pixpery;return r=Math.round(Math.round(r/(A[t].pixperx*A[t].snaptogridx))*A[t].pixperx*A[t].snaptogridx+A[t].imgborder-A[t].xmin*A[t].pixperx),n=Math.round(Math.round(n/(A[t].pixpery*A[t].snaptogridy))*A[t].pixpery*A[t].snaptogridy+A[t].imgborder+A[t].ymax*A[t].pixpery),{x:r,y:n}}function f(e,t){var r=p(e),n=m(t);return{x:n.x-r.x,y:n.y-r.y}}function p(e){for(var t=0,r=0;e.offsetParent;)t+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return t+=e.offsetLeft,r+=e.offsetTop,{x:t,y:r}}function g(){e(document).off("mousedown.imathasdraw").off("mousemove.imathasdraw").off("mouseup.imathasdraw"),e(document).off("touchstart.imathasdraw").off("touchmove.imathasdraw").off("touchend.imathasdraw")}function v(t){g(),e(document).on("mousemove.imathasdraw",d),e(document).on("touchstart.imathasdraw",function(e){V=!0,o(e)}),e(document).on("mousedown.imathasdraw",o);try{CanvasRenderingContext2D.prototype.dashedLine=function(e,t,r,n,i){void 0==i&&(i=10),this.beginPath(),this.moveTo(e,t);var a=r-e,l=n-t,s=Math.sqrt(a*a+l*l)/i,o=a/s,c=l/s;s=Math.round(s);for(var u=0;u++<s&&t>-1&&t<A[X].imgheight+1&&e>-1&&e<A[X].imgwidth+1;)e+=o,t+=c,this[u%2==0?"moveTo":"lineTo"](e,t);this[u%2==0?"moveTo":"lineTo"](r,n),this.stroke(),this.closePath()}}catch(n){}for(var i in canvases)if("undefined"==typeof t||t==i){if(null!=drawla[i]&&drawla[i].length>2){if(_[canvases[i][0]]=drawla[i][0],N[canvases[i][0]]=drawla[i][1],C[canvases[i][0]]=drawla[i][2],P[canvases[i][0]]=[],L[canvases[i][0]]=[],drawla[i].length>3&&drawla[i][3].length>0)for(var a=0;a<drawla[i][3].length;a++)P[canvases[i][0]][a]=drawla[i][3][a][0],L[canvases[i][0]][a]=[drawla[i][3][a].slice(1,3),drawla[i][3][a].slice(3)];if(S[canvases[i][0]]=[],O[canvases[i][0]]=[],drawla[i].length>4&&drawla[i][4].length>0)for(var a=0;a<drawla[i][4].length;a++)S[canvases[i][0]][a]=drawla[i][4][a][0],O[canvases[i][0]][a]=[drawla[i][4][a].slice(1,3),drawla[i][4][a].slice(3,5),drawla[i][4][a].slice(5)]}r(canvases[i][0],"canvas"+canvases[i][0],imasroot+"/filter/graph/imgs/"+canvases[i][1],"qn"+canvases[i][0],canvases[i][2],canvases[i][3],canvases[i][4],canvases[i][5],canvases[i][6],canvases[i][7],canvases[i][8],canvases[i][9],canvases[i][10],canvases[i][11],canvases[i][12])}}function y(e){-1==arraysearch(e,re.idnums)?re.idnums.push(e):w(e)}function w(t){for(var r,n=0;n<re.idnums.length;n++)("undefined"==typeof t||t==re.idnums[n])&&(r=re.idnums[n],x(r),e("#slid1"+r).on("touchstart.normslider mousedown.normslider",b),e("#slid2"+r).on("touchstart.normslider mousedown.normslider",b))}function x(e){var t,r,n,i,a=document.getElementById("qn"+e).value;(i=a.match(/\(-oo,([\-\d\.]+)\)U\(([\-\d\.]+),oo\)/))?(t=3,r=i[1],n=i[2]):(i=a.match(/\(-oo,([\-\d\.]+)\)/))?(t=0,r=i[1],n=2.5):(i=a.match(/\(([\-\d\.]+),oo\)/))?(t=1,r=i[1],n=2.5):(i=a.match(/\(([\-\d\.]+),([\-\d\.]+)\)/))?(t=2,r=i[1],n=i[2]):(t=0,r=-1.5,n=2.5),document.getElementById("slid1"+e).style.left=60*r+250-6+"px",document.getElementById("slid2"+e).style.left=60*n+250-6+"px",document.getElementById("shaderegions"+e).selectedIndex=t,re.curslider.type=document.getElementById("shaderegions"+e).value,T(e)}function b(t){t=t||window.event,t.originalEvent.touches&&t.originalEvent.touches.length>0?(V=!0,e(document).on("touchmove.normslider",E),e(document).on("touchend.normslider",M)):(e(document).on("mousemove.normslider",E),e(document).on("mouseup.normslider",M)),re.curslider.el=t.target||t.srcElement,re.curslider.id=re.curslider.el.id.substring(5),re.curslider.type=document.getElementById("shaderegions"+re.curslider.id).value,re.curslider.outnode=document.getElementById(re.outputid),re.curslider.startpos=f(re.curslider.el,t),re.curslider.el.parentNode.style.cursor="pointer";p(re.curslider.el.parentNode);return t.preventDefault&&t.preventDefault(),!1}function E(e){var t=re.curslider.id;e=e||window.event;var r=f(re.curslider.el.parentNode,e);if(!(r.x<5||r.x>re.curslider.el.parentNode.offsetWidth-5||r.y<5||r.y>re.curslider.el.parentNode.offsetHeight-5)){var n=6*Math.round((r.x-re.curslider.startpos.x-10)/6)+10;return re.curslider.el.style.left=n+"px",I(t),e.preventDefault&&e.preventDefault(),!1}}function M(t){null!==re.curslider.el&&(V=!1,e(document).off("touchmove.normslider touchend.normslider"),e(document).off("mousemove.normslider mouseup.normslider"),re.curslider.el.parentNode.style.cursor="",re.curslider.el=null)}function I(e){var t=parseInt(document.getElementById("slid1"+e).style.left)+6,r=parseInt(document.getElementById("slid2"+e).style.left)+6,n=Math.min(t,r),i=Math.max(t,r);"2O"==re.curslider.type?document.getElementById("normleft"+e).style.width=n+1+"px":"1L"==re.curslider.type?document.getElementById("normleft"+e).style.width=t+1+"px":"2B"==re.curslider.type&&(document.getElementById("normleft"+e).style.left=n+"px",document.getElementById("normleft"+e).style.width=i-n+1+"px"),"2O"==re.curslider.type?document.getElementById("normright"+e).style.width=500-i+"px":"1R"==re.curslider.type&&(document.getElementById("normright"+e).style.width=500-t+"px");var a=(-4+(t-10)/60).toFixed(1),l=(-4+(r-10)/60).toFixed(1),s=document.getElementById("slid1txt"+e);s.innerHTML=a,s.style.left=t-6+"px";var o=document.getElementById("slid2txt"+e);o.innerHTML=l,o.style.left=r-6+"px";var c=Math.min(a,l),u=Math.max(a,l);if("2O"==re.curslider.type)var d="(-oo,"+c+")U("+u+",oo)";else if("2B"==re.curslider.type)var d="("+c+","+u+")";else if("1L"==re.curslider.type)var d="(-oo,"+a+")";else if("1R"==re.curslider.type)var d="("+a+",oo)";document.getElementById("qn"+e).value=d}function T(e){var t=document.getElementById("shaderegions"+e).value;re.curslider.type=t;var r=parseInt(document.getElementById("slid1"+e).style.left)+6,n=parseInt(document.getElementById("slid2"+e).style.left)+6,i=Math.min(r,n),a=Math.max(r,n);"1R"==t||"1L"==t?(document.getElementById("slid2"+e).style.display="none",document.getElementById("slid2txt"+e).style.display="none","1R"==t?(document.getElementById("normleft"+e).style.display="none",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normright"+e).style.width=500-r+"px"):(document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.display="",document.getElementById("normleft"+e).style.left="0px",
document.getElementById("normleft"+e).style.width=r+"px")):"2O"==t?(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="",document.getElementById("normright"+e).style.right="0px",document.getElementById("normleft"+e).style.left="0px",document.getElementById("normright"+e).style.width=500-a+"px",document.getElementById("normleft"+e).style.width=i+"px"):"2B"==t&&(document.getElementById("slid2"+e).style.display="",document.getElementById("slid2txt"+e).style.display="",document.getElementById("normleft"+e).style.display="",document.getElementById("normright"+e).style.display="none",document.getElementById("normleft"+e).style.left=i+"px",document.getElementById("normleft"+e).style.width=a-i+"px"),I(e)}function k(e,t,r,n,i,a,l){if(i==r)e.moveTo(0,i),e.dashedLine(0,i,a,i);else{var s=(i-r)/((n-t)*(n-t)),o=-2*s*t,c=0;i>r&&(c=l);var u=s*t*t+r-c,d=Math.sqrt(o*o-4*s*u);u+=c;var m=(-o-d)/(2*s),h=(-o+d)/(2*s);if(m>h){var f=m;m=h,h=f}for(var p=8,g=p*p,v=t,y=r,w=0;v>m-5&&v>-5;)w%2==0?e.moveTo(v,y):e.lineTo(v,y),v-=Math.min(Math.sqrt(g/(1+Math.pow(2*s*(v-t),2))),Math.sqrt(p/Math.abs(s))),y=s*v*v+o*v+u,w++;for(v=t,y=r,w=0;h+5>v&&a+5>v;)w%2==0?e.moveTo(v,y):e.lineTo(v,y),v+=Math.min(Math.sqrt(g/(1+Math.pow(2*s*(v-t),2))),Math.sqrt(p/Math.abs(s))),y=s*v*v+o*v+u,w++}e.stroke()}function q(e,t,r,n,i,a,l,s,o){if(e.beginPath(),i==r)e.moveTo(0,i),e.lineTo(s,i),r>l?(e.lineTo(s,0),e.lineTo(0,0)):(e.lineTo(s,o),e.lineTo(0,o));else{var c=(i-r)/((n-t)*(n-t)),u=-2*c*t,d=0;i>r&&(d=o);var m=c*t*t+r-d,h=Math.sqrt(u*u-4*c*m);m+=d;var f=(-u-h)/(2*c),p=c*f*f+u*f+m,g=(-u+h)/(2*c),v=p;if(f>g){var y=f;f=g,g=y}var w=2*c*(f-t),x=p-w*f,b=-w,E=v-b*g,M=(x-E)/(b-w),I=w*M+x;if(0>c&&c*a*a+u*a+m>l||c>0&&l>c*a*a+u*a+m)e.moveTo(f,p),e.quadraticCurveTo(M,I,g,v);else{var T=o;Math.abs(p-o)<2&&(T=0),e.moveTo(0,p),e.lineTo(f,p),e.quadraticCurveTo(M,I,g,v),e.lineTo(s,v),e.lineTo(s,T),e.lineTo(0,T)}}e.closePath()}var B=!1,A=new Array,j=new Array,$=new Array,_=new Array,N=new Array,C=new Array,L=new Array,P=new Array,O=new Array,S=new Array,z=null,D=[],R=[],H=null,Q=null,G=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"],Z=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"],W=null,U=null,X=null,F=!1,V=!1,Y=!1,J=!1,K=null,ee=0,te=null;"undefined"!=typeof initstack?initstack.push(v):e(function(){v()});var re={idnums:[],curslider:{el:null,startpos:[0,0],outnode:null}};"undefined"!=typeof initstack&&initstack.push(w);var ne={initCanvases:v,clearcanvas:t,settool:n,addnormslider:y,chgnormtype:T};return ne}(jQuery),ehcurel=null,ehclosetimer=0,ehddclosetimer=0,curehdd=null,eecurel=null;