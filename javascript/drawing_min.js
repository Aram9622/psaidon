var mouseisdown=false;var targets=new Array();var imgs=new Array();var targetOuts=new Array();var lines=new Array();var dots=new Array();var odots=new Array();var tplines=new Array();var tptypes=new Array();var ineqlines=new Array();var ineqtypes=new Array();var canvases=new Array();var drawla=new Array();var curLine=null;var drawstyle=[];var drawlocky=[];var curTPcurve=null;var curIneqcurve=null;var ineqcolors=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"];var ineqacolors=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"];var dragObj=null;var oldpointpos=null;var curTarget=null;var nocanvaswarning=false;function clearcanvas(a){lines[a].length=0;dots[a].length=0;odots[a].length=0;tplines[a].length=0;tptypes[a].length=0;ineqlines[a].length=0;ineqtypes[a].length=0;curTarget=a;drawTarget();curTarget=null;curLine=null;dragObj=null}function addTarget(p,j,f,m,a,g,o,e,d,q,l,n,c,k){var h=document.getElementById(j);var b=getPosition(h);targets[p]={el:h,left:b.x,top:b.y,width:h.offsetWidth,height:h.offsetHeight,xmin:a,xmax:g,ymin:o,ymax:e,imgborder:d,imgwidth:q,imgheight:l,mode:n,dotline:c};targetOuts[p]=document.getElementById(m);if(lines[p]==null){lines[p]=new Array()}if(dots[p]==null){dots[p]=new Array()}if(odots[p]==null){odots[p]=new Array()}if(tplines[p]==null){tplines[p]=new Array()}if(tptypes[p]==null){tptypes[p]=new Array()}if(ineqlines[p]==null){ineqlines[p]=new Array()}if(ineqtypes[p]==null){ineqtypes[p]=new Array()}if(n>=5){drawstyle[p]=1}else{drawstyle[p]=0}drawlocky[p]=k;imgs[p]=new Image();imgs[p].onload=function(){var r=curTarget;curTarget=p;drawTarget();curTarget=r};imgs[p].src=f}function settool(a,d,e){var c=document.getElementById("drawtools"+d);var f=c.getElementsByTagName("span");for(var b=0;b<f.length;b++){f[b].className=""}f=c.getElementsByTagName("img");for(var b=0;b<f.length;b++){f[b].className=""}a.className="sel";setDrawMode(d,e)}function setDrawMode(a,b){targets[a].mode=b}function setDotLine(b,a){targets[b].dotline=a}function drawTarget(I,H){try{var v=targets[curTarget].el.getContext("2d")}catch(Q){if(!nocanvaswarning){nocanvaswarning=true;alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)")}}v.fillStyle="rgb(0,0,255)";v.lineWidth=2;v.strokeStyle="rgb(0,0,255)";v.clearRect(0,0,targets[curTarget].imgwidth,targets[curTarget].imgheight);v.drawImage(imgs[curTarget],0,0);v.beginPath();for(var N=0;N<ineqlines[curTarget].length;N++){var l=N%3;v.strokeStyle=ineqcolors[l];v.fillStyle=ineqcolors[l];var s=null;var r=null;var q=null;var S=null;var R=null;if(ineqlines[curTarget][N].length==3){r=ineqlines[curTarget][N][1][0];S=ineqlines[curTarget][N][1][1];q=ineqlines[curTarget][N][2][0];R=ineqlines[curTarget][N][2][1]}else{if(ineqlines[curTarget][N].length==2){r=ineqlines[curTarget][N][1][0];S=ineqlines[curTarget][N][1][1];q=I;R=H}else{if(curIneqcurve==N&&I!=null&&ineqlines[curTarget][N].length==1){r=I;S=H}}}if(q!=null){v.save();v.fillStyle=ineqacolors[l];v.beginPath();if(r!=ineqlines[curTarget][N][0][0]){var s=(S-ineqlines[curTarget][N][0][1])/(r-ineqlines[curTarget][N][0][0])}if(Math.abs(r-ineqlines[curTarget][N][0][0])<1||Math.abs(s)>100){v.moveTo(ineqlines[curTarget][N][0][0],0);v.lineTo(ineqlines[curTarget][N][0][0],targets[curTarget].imgheight);if(q>r){v.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight);v.lineTo(targets[curTarget].imgwidth,0);v.closePath()}else{v.lineTo(0,targets[curTarget].imgheight);v.lineTo(0,0);v.closePath()}}else{var C=s*(q-r)+S;var a=ineqlines[curTarget][N][0][1]-s*ineqlines[curTarget][N][0][0];var m=ineqlines[curTarget][N][0][1]+s*(targets[curTarget].imgwidth-ineqlines[curTarget][N][0][0]);v.moveTo(0,a);v.lineTo(targets[curTarget].imgwidth,m);if(R>C){v.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight);v.lineTo(0,targets[curTarget].imgheight);v.closePath()}else{v.lineTo(targets[curTarget].imgwidth,0);v.lineTo(0,0);v.closePath()}}v.fill();v.restore()}v.beginPath();if(r!=null){if(r!=ineqlines[curTarget][N][0][0]){var s=(S-ineqlines[curTarget][N][0][1])/(r-ineqlines[curTarget][N][0][0])}if(Math.abs(r-ineqlines[curTarget][N][0][0])<1||Math.abs(s)>100){if(ineqtypes[curTarget][N]==10.2){var g=targets[curTarget].imgheight/20;for(var M=0;M<10;M++){v.moveTo(ineqlines[curTarget][N][0][0],g*2*M);v.lineTo(ineqlines[curTarget][N][0][0],g*(2*M+1));v.stroke()}}else{v.moveTo(ineqlines[curTarget][N][0][0],0);v.lineTo(ineqlines[curTarget][N][0][0],targets[curTarget].imgheight);v.stroke()}}else{var a=ineqlines[curTarget][N][0][1]-s*ineqlines[curTarget][N][0][0];var m=ineqlines[curTarget][N][0][1]+s*(targets[curTarget].imgwidth-ineqlines[curTarget][N][0][0]);if(ineqtypes[curTarget][N]==10.2){var k=targets[curTarget].imgwidth/20;if(Math.abs(s)>1){k=k/Math.abs(s);if(k<1){k=1}}var K=Math.ceil(targets[curTarget].imgwidth/k);for(var M=0;M<K;M++){v.moveTo(k*2*M,a+s*k*2*M);v.lineTo(k*(2*M+1),a+s*k*(2*M+1));v.stroke()}}else{v.moveTo(0,a);v.lineTo(targets[curTarget].imgwidth,m);v.stroke()}}}v.beginPath();for(var M=0;M<ineqlines[curTarget][N].length;M++){if(M==2){v.arc(ineqlines[curTarget][N][M][0],ineqlines[curTarget][N][M][1],4,0,Math.PI*2,true);v.fill()}else{v.fillRect(ineqlines[curTarget][N][M][0]-3,ineqlines[curTarget][N][M][1]-3,6,6)}}v.beginPath()}v.fillStyle="rgb(0,0,255)";if(drawlocky[curTarget]==1){v.lineWidth=4}else{v.lineWidth=2}v.strokeStyle="rgb(0,0,255)";for(var N=0;N<tplines[curTarget].length;N++){if(tptypes[curTarget][N]>=5&&tptypes[curTarget][N]<6){var s=null;var r=null;var S=null;if(tplines[curTarget][N].length==2){r=tplines[curTarget][N][1][0];S=tplines[curTarget][N][1][1]}else{if(curTPcurve==N&&I!=null&&tplines[curTarget][N].length==1){r=I;S=H}}if(r!=null){if(tptypes[curTarget][N]==5.3){v.moveTo(tplines[curTarget][N][0][0],tplines[curTarget][N][0][1]);v.lineTo(r,S)}else{if(r!=tplines[curTarget][N][0][0]){var s=(S-tplines[curTarget][N][0][1])/(r-tplines[curTarget][N][0][0])}if(Math.abs(r-tplines[curTarget][N][0][0])<1||Math.abs(s)>100){if(tptypes[curTarget][N]==5.2){v.moveTo(tplines[curTarget][N][0][0],tplines[curTarget][N][0][1]);if(S>tplines[curTarget][N][0][1]){v.lineTo(tplines[curTarget][N][0][0],targets[curTarget].imgheight)}else{v.lineTo(tplines[curTarget][N][0][0],0)}}else{v.moveTo(tplines[curTarget][N][0][0],0);v.lineTo(tplines[curTarget][N][0][0],targets[curTarget].imgheight)}}else{var a=tplines[curTarget][N][0][1]-s*tplines[curTarget][N][0][0];var m=tplines[curTarget][N][0][1]+s*(targets[curTarget].imgwidth-tplines[curTarget][N][0][0]);var a=tplines[curTarget][N][0][1]-s*tplines[curTarget][N][0][0];var m=tplines[curTarget][N][0][1]+s*(targets[curTarget].imgwidth-tplines[curTarget][N][0][0]);if(tptypes[curTarget][N]==5.2){v.moveTo(tplines[curTarget][N][0][0],tplines[curTarget][N][0][1]);if(r>tplines[curTarget][N][0][0]){v.lineTo(targets[curTarget].imgwidth,m)}else{v.lineTo(0,a)}}else{v.moveTo(0,a);v.lineTo(targets[curTarget].imgwidth,m)}}}}}else{if(tptypes[curTarget][N]==6){var S=null;var r=null;if(tplines[curTarget][N].length==2){r=tplines[curTarget][N][1][0];S=tplines[curTarget][N][1][1]}else{if(curTPcurve==N&&I!=null&&tplines[curTarget][N].length==1){r=I;S=H}}if(r!=null&&r!=tplines[curTarget][N][0][0]){if(S==tplines[curTarget][N][0][1]){v.moveTo(0,S);v.lineTo(targets[curTarget].imgwidth,S)}else{var E=(S-tplines[curTarget][N][0][1])/((r-tplines[curTarget][N][0][0])*(r-tplines[curTarget][N][0][0]));if(S>tplines[curTarget][N][0][1]){var D=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][N][0][1])/E)+tplines[curTarget][N][0][0];var B=-1*Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][N][0][1])/E)+tplines[curTarget][N][0][0];var J=tplines[curTarget][N][0][1]-(targets[curTarget].imgheight-tplines[curTarget][N][0][1]);var L=targets[curTarget].imgheight}else{var D=Math.sqrt((0-tplines[curTarget][N][0][1])/E)+tplines[curTarget][N][0][0];var B=-1*Math.sqrt((0-tplines[curTarget][N][0][1])/E)+tplines[curTarget][N][0][0];var J=2*tplines[curTarget][N][0][1];var L=0}var u=D+2/3*(tplines[curTarget][N][0][0]-D);var t=L+2/3*(J-L);var h=u+(B-D)/3;var d=t;v.moveTo(D,L);v.bezierCurveTo(u,t,h,d,B,L)}}}else{if(tptypes[curTarget][N]==6.5){var S=null;var r=null;if(tplines[curTarget][N].length==2){r=tplines[curTarget][N][1][0];S=tplines[curTarget][N][1][1]}else{if(curTPcurve==N&&I!=null&&tplines[curTarget][N].length==1){r=I;S=H}}if(r!=null&&r!=tplines[curTarget][N][0][0]){if(S==tplines[curTarget][N][0][1]){v.moveTo(tplines[curTarget][N][0][0],S);if(r>tplines[curTarget][N][0][0]){v.lineTo(targets[curTarget].imgwidth,S)}else{v.lineTo(0,S)}}else{var P=(r<tplines[curTarget][N][0][0])?-1:1;var E=(S-tplines[curTarget][N][0][1])/Math.sqrt(P*(r-tplines[curTarget][N][0][0]));v.moveTo(tplines[curTarget][N][0][0],tplines[curTarget][N][0][1]);G=tplines[curTarget][N][0][0];F=tplines[curTarget][N][0][1];do{G+=P*3;v.lineTo(G,E*Math.sqrt(P*(G-tplines[curTarget][N][0][0]))+tplines[curTarget][N][0][1])}while(G>0&&G<targets[curTarget].imgwidth&&F>0&&F<targets[curTarget].imgheight)}}}else{if(tptypes[curTarget][N]==7){if(tplines[curTarget][N].length==2){r=tplines[curTarget][N][1][0];S=tplines[curTarget][N][1][1]}else{if(curTPcurve==N&&I!=null&&tplines[curTarget][N].length==1){r=I;S=H}}if(r!=null&&(r!=tplines[curTarget][N][0][0]||S!=tplines[curTarget][N][0][1])){var f=Math.sqrt((r-tplines[curTarget][N][0][0])*(r-tplines[curTarget][N][0][0])+(S-tplines[curTarget][N][0][1])*(S-tplines[curTarget][N][0][1]));v.arc(tplines[curTarget][N][0][0],tplines[curTarget][N][0][1],f,0,2*Math.PI,true)}}else{if(tptypes[curTarget][N]==8){var s=null;var r=null;var S=null;if(tplines[curTarget][N].length==2){r=tplines[curTarget][N][1][0];S=tplines[curTarget][N][1][1]}else{if(curTPcurve==N&&I!=null&&tplines[curTarget][N].length==1){r=I;S=H}}if(r!=null){if(r!=tplines[curTarget][N][0][0]){var s=(S-tplines[curTarget][N][0][1])/(r-tplines[curTarget][N][0][0]);if(r<tplines[curTarget][N][0][0]){s*=-1}}if(Math.abs(r-tplines[curTarget][N][0][0])<1||Math.abs(s)>100){v.moveTo(tplines[curTarget][N][0][0],tplines[curTarget][N][0][1]);if(S>tplines[curTarget][N][0][1]){v.lineTo(tplines[curTarget][N][0][0],targets[curTarget].imgheight)}else{v.lineTo(tplines[curTarget][N][0][0],0)}}else{var a=tplines[curTarget][N][0][1]+s*tplines[curTarget][N][0][0];var m=tplines[curTarget][N][0][1]+s*(targets[curTarget].imgwidth-tplines[curTarget][N][0][0]);v.moveTo(0,a);v.lineTo(tplines[curTarget][N][0][0],tplines[curTarget][N][0][1]);v.lineTo(targets[curTarget].imgwidth,m)}}}else{if(tptypes[curTarget][N]==9||tptypes[curTarget][N]==9.1){var S=null;var r=null;if(tplines[curTarget][N].length==2){r=tplines[curTarget][N][1][0];S=tplines[curTarget][N][1][1]}else{if(curTPcurve==N&&I!=null&&tplines[curTarget][N].length==1){r=I;S=H}}if(r!=null&&r!=tplines[curTarget][N][0][0]){if(S==tplines[curTarget][N][0][1]){v.moveTo(0,S);v.lineTo(targets[curTarget].imgwidth,S)}else{if(tptypes[curTarget][N]==9){var b=-1*Math.abs(S-tplines[curTarget][N][0][1])/2;var c=(S+tplines[curTarget][N][0][1])/2;var E=Math.PI/Math.abs(r-tplines[curTarget][N][0][0]);var O=(S<tplines[curTarget][N][0][1])?r:tplines[curTarget][N][0][0]}else{if(tptypes[curTarget][N]==9.1){var b=-1*Math.abs(S-tplines[curTarget][N][0][1]);var c=tplines[curTarget][N][0][1];var E=0.5*Math.PI/Math.abs(r-tplines[curTarget][N][0][0]);var O=(S<tplines[curTarget][N][0][1])?r:(r+2*Math.abs(r-tplines[curTarget][N][0][0]))}}var F=0;for(var G=0;G<targets[curTarget].imgwidth+4;G+=3){F=b*Math.cos(E*(G-O))+c;if(G==0){v.moveTo(G,F)}else{v.lineTo(G,F)}}}}}}}}}}v.stroke();for(var M=0;M<tplines[curTarget][N].length;M++){v.fillRect(tplines[curTarget][N][M][0]-3,tplines[curTarget][N][M][1]-3,6,6)}v.beginPath()}var p,o,A,z;for(var N=0;N<lines[curTarget].length;N++){for(var M=0;M<lines[curTarget][N].length;M++){if(M==0){v.moveTo(lines[curTarget][N][M][0],lines[curTarget][N][M][1]);p=lines[curTarget][N][M][0];o=lines[curTarget][N][M][1]}else{v.lineTo(lines[curTarget][N][M][0],lines[curTarget][N][M][1]);A=lines[curTarget][N][M][0];z=lines[curTarget][N][M][1]}}if(N==curLine&&I!=null){v.lineTo(I,H);A=I;z=H}var w=targets[curTarget].imgwidth*0.02;if(drawlocky[curTarget]==1&&A>targets[curTarget].imgwidth*0.98){v.moveTo(A,z);v.lineTo(A-w,z+w);v.moveTo(A,z);v.lineTo(A-w,z-w)}else{if(drawlocky[curTarget]==1&&p>targets[curTarget].imgwidth*0.98){v.moveTo(p,o);v.lineTo(p-w,o+w);v.moveTo(p,o);v.lineTo(p-w,o-w)}}if(drawlocky[curTarget]==1&&A<targets[curTarget].imgwidth*0.02){v.moveTo(A,z);v.lineTo(A+w,z+w);v.moveTo(A,z);v.lineTo(A+w,z-w)}else{if(drawlocky[curTarget]==1&&p<targets[curTarget].imgwidth*0.02){v.moveTo(p,o);v.lineTo(p+w,o+w);v.moveTo(p,o);v.lineTo(p+w,o-w)}}}v.stroke();v.beginPath();for(var N=0;N<dots[curTarget].length;N++){v.moveTo(dots[curTarget][N][0]+5,dots[curTarget][N][1]);v.arc(dots[curTarget][N][0],dots[curTarget][N][1],5,0,Math.PI*2,true)}v.fill();if(targets[curTarget].dotline==true){v.beginPath();for(var N=0;N<lines[curTarget].length;N++){for(var M=0;M<lines[curTarget][N].length;M++){if((M==0)||Math.pow((lines[curTarget][N][M][0]-lines[curTarget][N][0][0]),2)+Math.pow((lines[curTarget][N][M][1]-lines[curTarget][N][0][1]),2)>25){v.moveTo(lines[curTarget][N][M][0]+5,lines[curTarget][N][M][1]);v.arc(lines[curTarget][N][M][0],lines[curTarget][N][M][1],5,0,Math.PI*2,true)}}}v.fill()}v.fillStyle="rgb(255,255,255)";v.beginPath();for(var N=0;N<odots[curTarget].length;N++){v.moveTo(odots[curTarget][N][0]+5,odots[curTarget][N][1]);v.arc(odots[curTarget][N][0],odots[curTarget][N][1],4,0,Math.PI*2,true)}v.fill();v.lineWidth=2;v.beginPath();for(var N=0;N<odots[curTarget].length;N++){v.moveTo(odots[curTarget][N][0]+5,odots[curTarget][N][1]);v.arc(odots[curTarget][N][0],odots[curTarget][N][1],4,0,Math.PI*2,true)}v.stroke();encodeDraw()}function encodeDraw(){var b="";for(var c=0;c<lines[curTarget].length;c++){if(c!=0){b+=";"}for(var a=0;a<lines[curTarget][c].length;a++){if(a!=0){b+=","}b+="("+lines[curTarget][c][a][0]+","+lines[curTarget][c][a][1]+")"}}b+=";;";for(var c=0;c<dots[curTarget].length;c++){if(c!=0){b+=","}b+="("+dots[curTarget][c][0]+","+dots[curTarget][c][1]+")"}b+=";;";for(var c=0;c<odots[curTarget].length;c++){if(c!=0){b+=","}b+="("+odots[curTarget][c][0]+","+odots[curTarget][c][1]+")"}b+=";;";for(var c=0;c<tplines[curTarget].length;c++){if(c!=0){b+=","}if(tplines[curTarget][c].length>1){b+="("+tptypes[curTarget][c]+","+tplines[curTarget][c][0][0]+","+tplines[curTarget][c][0][1]+","+tplines[curTarget][c][1][0]+","+tplines[curTarget][c][1][1]+")"}}b+=";;";for(var c=0;c<ineqlines[curTarget].length;c++){if(c!=0){b+=","}if(ineqlines[curTarget][c].length>2){b+="("+ineqtypes[curTarget][c]+","+ineqlines[curTarget][c][0][0]+","+ineqlines[curTarget][c][0][1]+","+ineqlines[curTarget][c][1][0]+","+ineqlines[curTarget][c][1][1]+","+ineqlines[curTarget][c][2][0]+","+ineqlines[curTarget][c][2][1]+")"}}targetOuts[curTarget].value=b}function drawMouseDown(d){var a=mouseCoords(d);if(curTarget==null){for(i in targets){var b=getPosition(targets[i].el);if(b.x<a.x&&(b.x+targets[i].width>a.x)&&b.y<a.y&&(b.y+targets[i].height>a.y)){curTarget=i;break}}}if(curTarget!=null){mouseisdown=true;var b=getPosition(targets[curTarget].el);var e={x:(a.x-b.x),y:(a.y-b.y)};if(e.x>-1&&e.x<targets[curTarget].width&&e.y>-1&&e.y<targets[curTarget].height){if(drawlocky[curTarget]==1){e.y=targets[curTarget].imgheight/2}var c=findnearpoint(curTarget,e);if(c==null){targets[curTarget].el.style.cursor="url("+imasroot+"/img/pendown.cur), default";if(targets[curTarget].mode==1){dots[curTarget].push([e.x,e.y]);dragObj={mode:1,num:dots[curTarget].length-1}}else{if(targets[curTarget].mode==2){odots[curTarget].push([e.x,e.y]);dragObj={mode:2,num:odots[curTarget].length-1}}else{if(targets[curTarget].mode==0){if(curLine==null){lines[curTarget].push([[e.x,e.y]]);curLine=lines[curTarget].length-1}else{lines[curTarget][curLine].push([e.x,e.y])}}else{if(targets[curTarget].mode==0.5){if(curLine==null){lines[curTarget].push([[e.x,e.y]]);curLine=lines[curTarget].length-1}else{lines[curTarget][curLine].push([e.x,e.y]);curLine=null;dragObj=null}}else{if(targets[curTarget].mode>=5&&targets[curTarget].mode<10){if(curTPcurve==null){tplines[curTarget].push([[e.x,e.y]]);curTPcurve=tplines[curTarget].length-1;tptypes[curTarget][curTPcurve]=targets[curTarget].mode;mouseisdown=false}else{tplines[curTarget][curTPcurve].push([e.x,e.y]);if(tplines[curTarget][curTPcurve].length==2){dragObj={mode:targets[curTarget].mode,num:curTPcurve,subnum:1};curTPcurve=null}}}else{if(targets[curTarget].mode>=10&&targets[curTarget].mode<11){if(curIneqcurve==null){ineqlines[curTarget].push([[e.x,e.y]]);curIneqcurve=ineqlines[curTarget].length-1;ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode;mouseisdown=false}else{ineqlines[curTarget][curIneqcurve].push([e.x,e.y]);if(ineqlines[curTarget][curIneqcurve].length==3){dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:1};curIneqcurve=null}}}}}}}}}else{if(c[0]==0||c[0]==0.5){if(curLine==null){targets[curTarget].el.style.cursor="move";dragObj={mode:targets[curTarget].mode,num:c[1],subnum:c[2]};oldpointpos=lines[curTarget][c[1]][c[2]];if(c[2]==lines[curTarget][c[1]].length-1&&targets[curTarget].mode==0){curLine=c[1]}else{if(c[2]==0&&targets[curTarget].mode==0){curLine=c[1];lines[curTarget][curLine].reverse();dragObj.subnum=lines[curTarget][curLine].length-1}}}else{if(c[1]==curLine&&c[2]==lines[curTarget][c[1]].length-1){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}curLine=null}else{targets[curTarget].el.style.cursor="url("+imasroot+"/img/pendown.cur), default";lines[curTarget][curLine].push([e.x,e.y])}}}else{if(c[0]==1){targets[curTarget].el.style.cursor="move";dragObj={mode:1,num:c[1]}}else{if(c[0]==2){targets[curTarget].el.style.cursor="move";dragObj={mode:2,num:c[1]}}else{if(c[0]>=5&&c[0]<10){targets[curTarget].el.style.cursor="move";dragObj={mode:c[0],num:c[1],subnum:c[2]};oldpointpos=tplines[curTarget][c[1]][c[2]]}else{if(c[0]>=10&&c[0]<11){targets[curTarget].el.style.cursor="move";dragObj={mode:c[0],num:c[1],subnum:c[2]};oldpointpos=ineqlines[curTarget][c[1]][c[2]]}}}}}}drawTarget()}else{if(curLine!=null){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}if(curTPcurve!=null){if(tplines[curTarget][curTPcurve].length<2){tplines[curTarget].splice(curTPcurve,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}if(curIneqcurve!=null){if(ineqlines[curTarget][curIneqcurve].length<3){ineqlines[curTarget].splice(curIneqcurve,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}curLine=null;curTPcurve=null;curIneqcurve=null;dragObj=null;drawTarget();curTarget=null}}}function findnearpoint(a,e){if(drawstyle[a]==0){if(targets[a].mode==0||targets[a].mode==0.5){for(var c=0;c<lines[a].length;c++){for(var b=lines[a][c].length-1;b>=0;b--){var d=Math.pow(lines[a][c][b][0]-e.x,2)+Math.pow(lines[a][c][b][1]-e.y,2);if(d<25){return[targets[a].mode,c,b]}}}}else{if(targets[a].mode==1){for(var c=0;c<dots[a].length;c++){if(Math.pow(dots[a][c][0]-e.x,2)+Math.pow(dots[a][c][1]-e.y,2)<25){return[1,c]}}}else{if(targets[a].mode==2){for(var c=0;c<odots[a].length;c++){if(Math.pow(odots[a][c][0]-e.x,2)+Math.pow(odots[a][c][1]-e.y,2)<25){return[2,c]}}}else{if(targets[a].mode>=5&&targets[a].mode<10){for(var c=0;c<tplines[a].length;c++){if(tptypes[a][c]!=targets[a].mode){continue}for(var b=tplines[a][c].length-1;b>=0;b--){var d=Math.pow(tplines[a][c][b][0]-e.x,2)+Math.pow(tplines[a][c][b][1]-e.y,2);if(d<25){return[tptypes[a][c],c,b]}}}}else{if(targets[a].mode>=10&&targets[a].mode<11){for(var c=0;c<ineqlines[a].length;c++){for(var b=ineqlines[a][c].length-1;b>=0;b--){var d=Math.pow(ineqlines[a][c][b][0]-e.x,2)+Math.pow(ineqlines[a][c][b][1]-e.y,2);if(d<25){return[ineqtypes[a][c],c,b]}}}}}}}}}else{if(targets[a].mode==1){for(var c=0;c<dots[a].length;c++){if(Math.pow(dots[a][c][0]-e.x,2)+Math.pow(dots[a][c][1]-e.y,2)<25){return[1,c]}}}else{if(targets[a].mode==2){for(var c=0;c<odots[a].length;c++){if(Math.pow(odots[a][c][0]-e.x,2)+Math.pow(odots[a][c][1]-e.y,2)<25){return[2,c]}}}else{if(targets[a].mode>=5&&targets[a].mode<10){for(var c=0;c<tplines[a].length;c++){for(var b=tplines[a][c].length-1;b>=0;b--){if(tptypes[a][c]!=targets[a].mode){continue}var d=Math.pow(tplines[a][c][b][0]-e.x,2)+Math.pow(tplines[a][c][b][1]-e.y,2);if(d<25){return[tptypes[a][c],c,b]}}}}else{if(targets[a].mode>=10&&targets[a].mode<11){for(var c=0;c<ineqlines[a].length;c++){for(var b=ineqlines[a][c].length-1;b>=0;b--){var d=Math.pow(ineqlines[a][c][b][0]-e.x,2)+Math.pow(ineqlines[a][c][b][1]-e.y,2);if(d<25){return[ineqtypes[a][c],c,b]}}}}}}}}return null}var lastdrawmouseup=null;function drawMouseUp(c){var a=mouseCoords(c);mouseisdown=false;if(curTarget!=null){if(lastdrawmouseup!=null&&a.x==lastdrawmouseup.x&&a.y==lastdrawmouseup.y){if(curLine!=null&&dragObj==null){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}curLine=null;dragObj=null;drawTarget()}}if(curLine!=null&&dragObj==null){if(targets[curTarget].mode==0.5&&lines[curTarget][curLine].length>1){curLine=null;dragobj=null;drawTarget()}}if(curLine==null&&curTPcurve==null){targets[curTarget].el.style.cursor="move"}else{targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}}lastdrawmouseup=a;if(curTarget!=null&&dragObj!=null){var b=getPosition(targets[curTarget].el);var d={x:(a.x-b.x),y:(a.y-b.y)};if(d.x>-1&&d.x<targets[curTarget].width&&d.y>-1&&d.y<targets[curTarget].height){dragObj=null}else{if(drawlocky[curTarget]==1){d.y=targets[curTarget].imgheight/2}if(dragObj.mode==1){dots[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==2){odots[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==0.5){lines[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==0){lines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos}else{if(dragObj.mode>=5&&dragObj.mode<10){tplines[curTarget].splice(dragObj.num,1);curTPcurve=null}else{if(dragObj.mode>=10&&dragObj.mode<11){ineqlines[curTarget].splice(dragObj.num,1);curIneqcurve=null}}}}}}dragObj=null;drawTarget()}}}function drawMouseMove(f){var b=null;var a=mouseCoords(f);if(curTarget==null){for(i in targets){var c=getPosition(targets[i].el);if(c.x<a.x&&(c.x+targets[i].width>a.x)&&c.y<a.y&&(c.y+targets[i].height>a.y)){b=i;break}}}if(b!=null){var c=getPosition(targets[b].el);var h={x:(a.x-c.x),y:(a.y-c.y)};if(drawlocky[b]==1){h.y=targets[b].imgheight/2}if(h.x>-1&&h.x<targets[b].width&&h.y>-1&&h.y<targets[b].height){if(dragObj==null){if(curLine==null){var d=findnearpoint(b,h);if(d==null){targets[b].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}else{targets[b].el.style.cursor="move"}}}}}if(curTarget!=null){var c=getPosition(targets[curTarget].el);var h={x:(a.x-c.x),y:(a.y-c.y)};if(drawlocky[curTarget]==1){h.y=targets[curTarget].imgheight/2}if(h.x>-1&&h.x<targets[curTarget].width&&h.y>-1&&h.y<targets[curTarget].height){if(dragObj==null){if(curLine!=null){if(mouseisdown&&targets[curTarget].mode==0){var e=lines[curTarget][curLine].length-1;var g=Math.pow(lines[curTarget][curLine][e][0]-h.x,2)+Math.pow(lines[curTarget][curLine][e][1]-h.y,2);if(g>25){lines[curTarget][curLine].push([h.x,h.y]);drawTarget()}else{drawTarget(h.x,h.y)}}else{if(mouseisdown&&targets[curTarget].mode==0.5){var e=lines[curTarget][curLine].length-1;if(e==0){var g=Math.pow(lines[curTarget][curLine][e][0]-h.x,2)+Math.pow(lines[curTarget][curLine][e][1]-h.y,2);if(g>25){lines[curTarget][curLine].push([h.x,h.y]);drawTarget()}else{drawTarget(h.x,h.y)}}else{lines[curTarget][curLine][e]=[h.x,h.y];drawTarget()}}else{drawTarget(h.x,h.y)}}}else{if(curTPcurve!=null){if(mouseisdown){drawTarget()}else{drawTarget(h.x,h.y)}}else{if(curIneqcurve!=null){if(mouseisdown){drawTarget()}else{drawTarget(h.x,h.y)}}else{var d=findnearpoint(curTarget,h);if(d==null){targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}else{targets[curTarget].el.style.cursor="move"}}}}}else{targets[curTarget].el.style.cursor="move";if(dragObj.mode==0||dragObj.mode==0.5){lines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}else{if(dragObj.mode==1){dots[curTarget][dragObj.num]=[h.x,h.y]}else{if(dragObj.mode==2){odots[curTarget][dragObj.num]=[h.x,h.y]}else{if(dragObj.mode>=5&&dragObj.mode<10){tplines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}else{if(dragObj.mode>=10&&dragObj.mode<11){ineqlines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}}}}}drawTarget()}return false}}}function mouseCoords(e){e=e||window.event;if(e.pageX||e.pageY){return{x:e.pageX,y:e.pageY}}var a=document.documentElement,c=document.body;if(a&&(a.scrollTop||a.scrollLeft)){var b=a.scrollLeft;var d=a.scrollTop}else{if(c){var b=c.scrollLeft;var d=c.scrollTop}else{var b=0;var d=0}}return{x:e.clientX+b,y:e.clientY+d}}function getMouseOffset(d,c){var b=getPosition(d);var a=mouseCoords(c);return{x:a.x-b.x,y:a.y-b.y}}function getPosition(f){var d=0;var c=0;if(f.getBoundingClientRect){var a=f.getBoundingClientRect();var b=Math.max(document.documentElement.scrollTop,document.body.scrollTop);var g=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);return{x:a.left+g,y:a.top+b}}while(f.offsetParent){d+=f.offsetLeft;c+=f.offsetTop;f=f.offsetParent}d+=f.offsetLeft;c+=f.offsetTop;return{x:d,y:c}}function initCanvases(a){for(var c in canvases){if(typeof(a)=="undefined"||a==c){if(drawla[c]!=null&&drawla[c].length>2){lines[canvases[c][0]]=drawla[c][0];dots[canvases[c][0]]=drawla[c][1];odots[canvases[c][0]]=drawla[c][2];if(drawla[c].length>3&&drawla[c][3].length>0){tptypes[canvases[c][0]]=[];tplines[canvases[c][0]]=[];for(var b=0;b<drawla[c][3].length;b++){tptypes[canvases[c][0]][b]=drawla[c][3][b][0];tplines[canvases[c][0]][b]=[drawla[c][3][b].slice(1,3),drawla[c][3][b].slice(3)]}}if(drawla[c].length>4&&drawla[c][4].length>0){ineqtypes[canvases[c][0]]=[];ineqlines[canvases[c][0]]=[];for(var b=0;b<drawla[c][4].length;b++){ineqtypes[canvases[c][0]][b]=drawla[c][4][b][0];ineqlines[canvases[c][0]][b]=[drawla[c][4][b].slice(1,3),drawla[c][4][b].slice(3,5),drawla[c][4][b].slice(5)]}}}addTarget(canvases[c][0],"canvas"+canvases[c][0],imasroot+"/filter/graph/imgs/"+canvases[c][1],"qn"+canvases[c][0],canvases[c][2],canvases[c][3],canvases[c][4],canvases[c][5],canvases[c][6],canvases[c][7],canvases[c][8],canvases[c][9],canvases[c][10],canvases[c][11])}}}document.onmousedown=drawMouseDown;document.onmouseup=drawMouseUp;document.onmousemove=drawMouseMove;if(typeof(initstack)!="undefined"){initstack.push(initCanvases)}else{if(typeof window.addEventListener!="undefined"){window.addEventListener("load",initCanvases,false)}else{if(typeof document.addEventListener!="undefined"){document.addEventListener("load",initCanvases,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onload",initCanvases)}else{if(typeof window.onload=="function"){var existing=onload;window.onload=function(){existing();initCanvases()}}else{window.onload=initCanvases}}}}};