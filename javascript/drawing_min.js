var mouseisdown=false;var targets=new Array();var imgs=new Array();var targetOuts=new Array();var lines=new Array();var dots=new Array();var odots=new Array();var tplines=new Array();var tptypes=new Array();var ineqlines=new Array();var ineqtypes=new Array();var canvases=new Array();var drawla=new Array();var curLine=null;var drawstyle=[];var drawlocky=[];var curTPcurve=null;var curIneqcurve=null;var ineqcolors=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"];var ineqacolors=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"];var dragObj=null;var oldpointpos=null;var curTarget=null;var nocanvaswarning=false;function clearcanvas(a){lines[a].length=0;dots[a].length=0;odots[a].length=0;tplines[a].length=0;tptypes[a].length=0;ineqlines[a].length=0;ineqtypes[a].length=0;curTarget=a;drawTarget();curTarget=null;curLine=null;dragObj=null}function addTarget(p,j,f,m,a,g,o,e,d,q,l,n,c,k){var h=document.getElementById(j);var b=getPosition(h);targets[p]={el:h,left:b.x,top:b.y,width:h.offsetWidth,height:h.offsetHeight,xmin:a,xmax:g,ymin:o,ymax:e,imgborder:d,imgwidth:q,imgheight:l,mode:n,dotline:c};targetOuts[p]=document.getElementById(m);if(lines[p]==null){lines[p]=new Array()}if(dots[p]==null){dots[p]=new Array()}if(odots[p]==null){odots[p]=new Array()}if(tplines[p]==null){tplines[p]=new Array()}if(tptypes[p]==null){tptypes[p]=new Array()}if(ineqlines[p]==null){ineqlines[p]=new Array()}if(ineqtypes[p]==null){ineqtypes[p]=new Array()}if(n>=5){drawstyle[p]=1}else{drawstyle[p]=0}drawlocky[p]=k;imgs[p]=new Image();imgs[p].onload=function(){var r=curTarget;curTarget=p;drawTarget();curTarget=r};imgs[p].src=f}function settool(a,d,e){var c=document.getElementById("drawtools"+d);var f=c.getElementsByTagName("span");for(var b=0;b<f.length;b++){f[b].className=""}f=c.getElementsByTagName("img");for(var b=0;b<f.length;b++){f[b].className=""}a.className="sel";setDrawMode(d,e)}function setDrawMode(a,b){targets[a].mode=b}function setDotLine(b,a){targets[b].dotline=a}function drawTarget(K,J){try{var z=targets[curTarget].el.getContext("2d")}catch(U){if(!nocanvaswarning){nocanvaswarning=true;alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)")}}z.fillStyle="rgb(0,0,255)";z.lineWidth=2;z.strokeStyle="rgb(0,0,255)";z.clearRect(0,0,targets[curTarget].imgwidth,targets[curTarget].imgheight);z.drawImage(imgs[curTarget],0,0);z.beginPath();for(var R=0;R<ineqlines[curTarget].length;R++){var m=R%3;z.strokeStyle=ineqcolors[m];z.fillStyle=ineqcolors[m];var t=null;var s=null;var r=null;var X=null;var W=null;if(ineqlines[curTarget][R].length==3){s=ineqlines[curTarget][R][1][0];X=ineqlines[curTarget][R][1][1];r=ineqlines[curTarget][R][2][0];W=ineqlines[curTarget][R][2][1]}else{if(ineqlines[curTarget][R].length==2){s=ineqlines[curTarget][R][1][0];X=ineqlines[curTarget][R][1][1];r=K;W=J}else{if(curIneqcurve==R&&K!=null&&ineqlines[curTarget][R].length==1){s=K;X=J}}}if(r!=null){z.save();z.fillStyle=ineqacolors[m];z.beginPath();if(s!=ineqlines[curTarget][R][0][0]){var t=(X-ineqlines[curTarget][R][0][1])/(s-ineqlines[curTarget][R][0][0])}if(Math.abs(s-ineqlines[curTarget][R][0][0])<1||Math.abs(t)>100){z.moveTo(ineqlines[curTarget][R][0][0],0);z.lineTo(ineqlines[curTarget][R][0][0],targets[curTarget].imgheight);if(r>s){z.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight);z.lineTo(targets[curTarget].imgwidth,0);z.closePath()}else{z.lineTo(0,targets[curTarget].imgheight);z.lineTo(0,0);z.closePath()}}else{var E=t*(r-s)+X;var a=ineqlines[curTarget][R][0][1]-t*ineqlines[curTarget][R][0][0];var o=ineqlines[curTarget][R][0][1]+t*(targets[curTarget].imgwidth-ineqlines[curTarget][R][0][0]);z.moveTo(0,a);z.lineTo(targets[curTarget].imgwidth,o);if(W>E){z.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight);z.lineTo(0,targets[curTarget].imgheight);z.closePath()}else{z.lineTo(targets[curTarget].imgwidth,0);z.lineTo(0,0);z.closePath()}}z.fill();z.restore()}z.beginPath();if(s!=null){if(s!=ineqlines[curTarget][R][0][0]){var t=(X-ineqlines[curTarget][R][0][1])/(s-ineqlines[curTarget][R][0][0])}if(Math.abs(s-ineqlines[curTarget][R][0][0])<1||Math.abs(t)>100){if(ineqtypes[curTarget][R]==10.2){var h=targets[curTarget].imgheight/20;for(var P=0;P<10;P++){z.moveTo(ineqlines[curTarget][R][0][0],h*2*P);z.lineTo(ineqlines[curTarget][R][0][0],h*(2*P+1));z.stroke()}}else{z.moveTo(ineqlines[curTarget][R][0][0],0);z.lineTo(ineqlines[curTarget][R][0][0],targets[curTarget].imgheight);z.stroke()}}else{var a=ineqlines[curTarget][R][0][1]-t*ineqlines[curTarget][R][0][0];var o=ineqlines[curTarget][R][0][1]+t*(targets[curTarget].imgwidth-ineqlines[curTarget][R][0][0]);if(ineqtypes[curTarget][R]==10.2){var l=targets[curTarget].imgwidth/20;if(Math.abs(t)>1){l=l/Math.abs(t);if(l<1){l=1}}var N=Math.ceil(targets[curTarget].imgwidth/l);for(var P=0;P<N;P++){z.moveTo(l*2*P,a+t*l*2*P);z.lineTo(l*(2*P+1),a+t*l*(2*P+1));z.stroke()}}else{z.moveTo(0,a);z.lineTo(targets[curTarget].imgwidth,o);z.stroke()}}}z.beginPath();for(var P=0;P<ineqlines[curTarget][R].length;P++){if(P==2){z.arc(ineqlines[curTarget][R][P][0],ineqlines[curTarget][R][P][1],4,0,Math.PI*2,true);z.fill()}else{z.fillRect(ineqlines[curTarget][R][P][0]-3,ineqlines[curTarget][R][P][1]-3,6,6)}}z.beginPath()}z.fillStyle="rgb(0,0,255)";if(drawlocky[curTarget]==1){z.lineWidth=4}else{z.lineWidth=2}z.strokeStyle="rgb(0,0,255)";for(var R=0;R<tplines[curTarget].length;R++){if(tptypes[curTarget][R]>=5&&tptypes[curTarget][R]<6){var t=null;var s=null;var X=null;var L,Q;if(tplines[curTarget][R].length==2){s=tplines[curTarget][R][1][0];X=tplines[curTarget][R][1][1]}else{if(curTPcurve==R&&K!=null&&tplines[curTarget][R].length==1){s=K;X=J}}if(s!=null){if(tptypes[curTarget][R]==5.3||tptypes[curTarget][R]==5.4){z.moveTo(tplines[curTarget][R][0][0],tplines[curTarget][R][0][1]);z.lineTo(s,X);if(tptypes[curTarget][R]==5.4){var L=[s-tplines[curTarget][R][0][0],X-tplines[curTarget][R][0][1]];var V=Math.sqrt(L[0]*L[0]+L[1]*L[1]);if(V>0.0001){L=[L[0]/V,L[1]/V];Q=[-L[1],L[0]];z.moveTo(s-15*L[0]-4*Q[0],X-15*L[1]-5*Q[1]);z.lineTo(s,X);z.moveTo(s-15*L[0]+4*Q[0],X-15*L[1]+5*Q[1]);z.lineTo(s,X)}}}else{if(s!=tplines[curTarget][R][0][0]){var t=(X-tplines[curTarget][R][0][1])/(s-tplines[curTarget][R][0][0])}if(Math.abs(s-tplines[curTarget][R][0][0])<1||Math.abs(t)>100){if(tptypes[curTarget][R]==5.2){z.moveTo(tplines[curTarget][R][0][0],tplines[curTarget][R][0][1]);if(X>tplines[curTarget][R][0][1]){z.lineTo(tplines[curTarget][R][0][0],targets[curTarget].imgheight)}else{z.lineTo(tplines[curTarget][R][0][0],0)}}else{z.moveTo(tplines[curTarget][R][0][0],0);z.lineTo(tplines[curTarget][R][0][0],targets[curTarget].imgheight)}}else{var a=tplines[curTarget][R][0][1]-t*tplines[curTarget][R][0][0];var o=tplines[curTarget][R][0][1]+t*(targets[curTarget].imgwidth-tplines[curTarget][R][0][0]);var a=tplines[curTarget][R][0][1]-t*tplines[curTarget][R][0][0];var o=tplines[curTarget][R][0][1]+t*(targets[curTarget].imgwidth-tplines[curTarget][R][0][0]);if(tptypes[curTarget][R]==5.2){z.moveTo(tplines[curTarget][R][0][0],tplines[curTarget][R][0][1]);if(s>tplines[curTarget][R][0][0]){z.lineTo(targets[curTarget].imgwidth,o)}else{z.lineTo(0,a)}}else{z.moveTo(0,a);z.lineTo(targets[curTarget].imgwidth,o)}}}}}else{if(tptypes[curTarget][R]==6){var X=null;var s=null;if(tplines[curTarget][R].length==2){s=tplines[curTarget][R][1][0];X=tplines[curTarget][R][1][1]}else{if(curTPcurve==R&&K!=null&&tplines[curTarget][R].length==1){s=K;X=J}}if(s!=null&&s!=tplines[curTarget][R][0][0]){if(X==tplines[curTarget][R][0][1]){z.moveTo(0,X);z.lineTo(targets[curTarget].imgwidth,X)}else{var G=(X-tplines[curTarget][R][0][1])/((s-tplines[curTarget][R][0][0])*(s-tplines[curTarget][R][0][0]));if(X>tplines[curTarget][R][0][1]){var F=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][R][0][1])/G)+tplines[curTarget][R][0][0];var D=-1*Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][R][0][1])/G)+tplines[curTarget][R][0][0];var M=tplines[curTarget][R][0][1]-(targets[curTarget].imgheight-tplines[curTarget][R][0][1]);var O=targets[curTarget].imgheight}else{var F=Math.sqrt((0-tplines[curTarget][R][0][1])/G)+tplines[curTarget][R][0][0];var D=-1*Math.sqrt((0-tplines[curTarget][R][0][1])/G)+tplines[curTarget][R][0][0];var M=2*tplines[curTarget][R][0][1];var O=0}var w=F+2/3*(tplines[curTarget][R][0][0]-F);var v=O+2/3*(M-O);var k=w+(D-F)/3;var f=v;z.moveTo(F,O);z.bezierCurveTo(w,v,k,f,D,O)}}}else{if(tptypes[curTarget][R]==6.5){var X=null;var s=null;if(tplines[curTarget][R].length==2){s=tplines[curTarget][R][1][0];X=tplines[curTarget][R][1][1]}else{if(curTPcurve==R&&K!=null&&tplines[curTarget][R].length==1){s=K;X=J}}if(s!=null&&s!=tplines[curTarget][R][0][0]){if(X==tplines[curTarget][R][0][1]){z.moveTo(tplines[curTarget][R][0][0],X);if(s>tplines[curTarget][R][0][0]){z.lineTo(targets[curTarget].imgwidth,X)}else{z.lineTo(0,X)}}else{var T=(s<tplines[curTarget][R][0][0])?-1:1;var G=(X-tplines[curTarget][R][0][1])/Math.sqrt(T*(s-tplines[curTarget][R][0][0]));z.moveTo(tplines[curTarget][R][0][0],tplines[curTarget][R][0][1]);I=tplines[curTarget][R][0][0];H=tplines[curTarget][R][0][1];do{I+=T*3;z.lineTo(I,G*Math.sqrt(T*(I-tplines[curTarget][R][0][0]))+tplines[curTarget][R][0][1])}while(I>0&&I<targets[curTarget].imgwidth&&H>0&&H<targets[curTarget].imgheight)}}}else{if(tptypes[curTarget][R]==7){if(tplines[curTarget][R].length==2){s=tplines[curTarget][R][1][0];X=tplines[curTarget][R][1][1]}else{if(curTPcurve==R&&K!=null&&tplines[curTarget][R].length==1){s=K;X=J}}if(s!=null&&(s!=tplines[curTarget][R][0][0]||X!=tplines[curTarget][R][0][1])){var g=Math.sqrt((s-tplines[curTarget][R][0][0])*(s-tplines[curTarget][R][0][0])+(X-tplines[curTarget][R][0][1])*(X-tplines[curTarget][R][0][1]));z.arc(tplines[curTarget][R][0][0],tplines[curTarget][R][0][1],g,0,2*Math.PI,true)}}else{if(tptypes[curTarget][R]==8){var t=null;var s=null;var X=null;if(tplines[curTarget][R].length==2){s=tplines[curTarget][R][1][0];X=tplines[curTarget][R][1][1]}else{if(curTPcurve==R&&K!=null&&tplines[curTarget][R].length==1){s=K;X=J}}if(s!=null){if(s!=tplines[curTarget][R][0][0]){var t=(X-tplines[curTarget][R][0][1])/(s-tplines[curTarget][R][0][0]);if(s<tplines[curTarget][R][0][0]){t*=-1}}if(Math.abs(s-tplines[curTarget][R][0][0])<1||Math.abs(t)>100){z.moveTo(tplines[curTarget][R][0][0],tplines[curTarget][R][0][1]);if(X>tplines[curTarget][R][0][1]){z.lineTo(tplines[curTarget][R][0][0],targets[curTarget].imgheight)}else{z.lineTo(tplines[curTarget][R][0][0],0)}}else{var a=tplines[curTarget][R][0][1]+t*tplines[curTarget][R][0][0];var o=tplines[curTarget][R][0][1]+t*(targets[curTarget].imgwidth-tplines[curTarget][R][0][0]);z.moveTo(0,a);z.lineTo(tplines[curTarget][R][0][0],tplines[curTarget][R][0][1]);z.lineTo(targets[curTarget].imgwidth,o)}}}else{if(tptypes[curTarget][R]==9||tptypes[curTarget][R]==9.1){var X=null;var s=null;if(tplines[curTarget][R].length==2){s=tplines[curTarget][R][1][0];X=tplines[curTarget][R][1][1]}else{if(curTPcurve==R&&K!=null&&tplines[curTarget][R].length==1){s=K;X=J}}if(s!=null&&s!=tplines[curTarget][R][0][0]){if(X==tplines[curTarget][R][0][1]){z.moveTo(0,X);z.lineTo(targets[curTarget].imgwidth,X)}else{if(tptypes[curTarget][R]==9){var b=-1*Math.abs(X-tplines[curTarget][R][0][1])/2;var c=(X+tplines[curTarget][R][0][1])/2;var G=Math.PI/Math.abs(s-tplines[curTarget][R][0][0]);var S=(X<tplines[curTarget][R][0][1])?s:tplines[curTarget][R][0][0]}else{if(tptypes[curTarget][R]==9.1){var b=-1*Math.abs(X-tplines[curTarget][R][0][1]);var c=tplines[curTarget][R][0][1];var G=0.5*Math.PI/Math.abs(s-tplines[curTarget][R][0][0]);var S=(X<tplines[curTarget][R][0][1])?s:(s+2*Math.abs(s-tplines[curTarget][R][0][0]))}}var H=0;for(var I=0;I<targets[curTarget].imgwidth+4;I+=3){H=b*Math.cos(G*(I-S))+c;if(I==0){z.moveTo(I,H)}else{z.lineTo(I,H)}}}}}}}}}}z.stroke();for(var P=0;P<tplines[curTarget][R].length;P++){z.fillRect(tplines[curTarget][R][P][0]-3,tplines[curTarget][R][P][1]-3,6,6)}z.beginPath()}var q,p,C,B;for(var R=0;R<lines[curTarget].length;R++){for(var P=0;P<lines[curTarget][R].length;P++){if(P==0){z.moveTo(lines[curTarget][R][P][0],lines[curTarget][R][P][1]);q=lines[curTarget][R][P][0];p=lines[curTarget][R][P][1]}else{z.lineTo(lines[curTarget][R][P][0],lines[curTarget][R][P][1]);C=lines[curTarget][R][P][0];B=lines[curTarget][R][P][1]}}if(R==curLine&&K!=null){z.lineTo(K,J);C=K;B=J}var A=targets[curTarget].imgwidth*0.02;if(drawlocky[curTarget]==1&&C>targets[curTarget].imgwidth*0.98){z.moveTo(C,B);z.lineTo(C-A,B+A);z.moveTo(C,B);z.lineTo(C-A,B-A)}else{if(drawlocky[curTarget]==1&&q>targets[curTarget].imgwidth*0.98){z.moveTo(q,p);z.lineTo(q-A,p+A);z.moveTo(q,p);z.lineTo(q-A,p-A)}}if(drawlocky[curTarget]==1&&C<targets[curTarget].imgwidth*0.02){z.moveTo(C,B);z.lineTo(C+A,B+A);z.moveTo(C,B);z.lineTo(C+A,B-A)}else{if(drawlocky[curTarget]==1&&q<targets[curTarget].imgwidth*0.02){z.moveTo(q,p);z.lineTo(q+A,p+A);z.moveTo(q,p);z.lineTo(q+A,p-A)}}}z.stroke();z.beginPath();for(var R=0;R<dots[curTarget].length;R++){z.moveTo(dots[curTarget][R][0]+5,dots[curTarget][R][1]);z.arc(dots[curTarget][R][0],dots[curTarget][R][1],5,0,Math.PI*2,true)}z.fill();if(targets[curTarget].dotline==true){z.beginPath();for(var R=0;R<lines[curTarget].length;R++){for(var P=0;P<lines[curTarget][R].length;P++){if((P==0)||Math.pow((lines[curTarget][R][P][0]-lines[curTarget][R][0][0]),2)+Math.pow((lines[curTarget][R][P][1]-lines[curTarget][R][0][1]),2)>25){z.moveTo(lines[curTarget][R][P][0]+5,lines[curTarget][R][P][1]);z.arc(lines[curTarget][R][P][0],lines[curTarget][R][P][1],5,0,Math.PI*2,true)}}}z.fill()}z.fillStyle="rgb(255,255,255)";z.beginPath();for(var R=0;R<odots[curTarget].length;R++){z.moveTo(odots[curTarget][R][0]+5,odots[curTarget][R][1]);z.arc(odots[curTarget][R][0],odots[curTarget][R][1],4,0,Math.PI*2,true)}z.fill();z.lineWidth=2;z.beginPath();for(var R=0;R<odots[curTarget].length;R++){z.moveTo(odots[curTarget][R][0]+5,odots[curTarget][R][1]);z.arc(odots[curTarget][R][0],odots[curTarget][R][1],4,0,Math.PI*2,true)}z.stroke();encodeDraw()}function encodeDraw(){var b="";for(var c=0;c<lines[curTarget].length;c++){if(c!=0){b+=";"}for(var a=0;a<lines[curTarget][c].length;a++){if(a!=0){b+=","}b+="("+lines[curTarget][c][a][0]+","+lines[curTarget][c][a][1]+")"}}b+=";;";for(var c=0;c<dots[curTarget].length;c++){if(c!=0){b+=","}b+="("+dots[curTarget][c][0]+","+dots[curTarget][c][1]+")"}b+=";;";for(var c=0;c<odots[curTarget].length;c++){if(c!=0){b+=","}b+="("+odots[curTarget][c][0]+","+odots[curTarget][c][1]+")"}b+=";;";for(var c=0;c<tplines[curTarget].length;c++){if(c!=0){b+=","}if(tplines[curTarget][c].length>1){b+="("+tptypes[curTarget][c]+","+tplines[curTarget][c][0][0]+","+tplines[curTarget][c][0][1]+","+tplines[curTarget][c][1][0]+","+tplines[curTarget][c][1][1]+")"}}b+=";;";for(var c=0;c<ineqlines[curTarget].length;c++){if(c!=0){b+=","}if(ineqlines[curTarget][c].length>2){b+="("+ineqtypes[curTarget][c]+","+ineqlines[curTarget][c][0][0]+","+ineqlines[curTarget][c][0][1]+","+ineqlines[curTarget][c][1][0]+","+ineqlines[curTarget][c][1][1]+","+ineqlines[curTarget][c][2][0]+","+ineqlines[curTarget][c][2][1]+")"}}targetOuts[curTarget].value=b}function drawMouseDown(d){var a=mouseCoords(d);if(curTarget==null){for(i in targets){var b=getPosition(targets[i].el);if(b.x<a.x&&(b.x+targets[i].width>a.x)&&b.y<a.y&&(b.y+targets[i].height>a.y)){curTarget=i;break}}}if(curTarget!=null){mouseisdown=true;var b=getPosition(targets[curTarget].el);var e={x:(a.x-b.x),y:(a.y-b.y)};if(e.x>-1&&e.x<targets[curTarget].width&&e.y>-1&&e.y<targets[curTarget].height){if(drawlocky[curTarget]==1){e.y=targets[curTarget].imgheight/2}var c=findnearpoint(curTarget,e);if(c==null){targets[curTarget].el.style.cursor="url("+imasroot+"/img/pendown.cur), default";if(targets[curTarget].mode==1){dots[curTarget].push([e.x,e.y]);dragObj={mode:1,num:dots[curTarget].length-1}}else{if(targets[curTarget].mode==2){odots[curTarget].push([e.x,e.y]);dragObj={mode:2,num:odots[curTarget].length-1}}else{if(targets[curTarget].mode==0){if(curLine==null){lines[curTarget].push([[e.x,e.y]]);curLine=lines[curTarget].length-1}else{lines[curTarget][curLine].push([e.x,e.y])}}else{if(targets[curTarget].mode==0.5){if(curLine==null){lines[curTarget].push([[e.x,e.y]]);curLine=lines[curTarget].length-1}else{lines[curTarget][curLine].push([e.x,e.y]);curLine=null;dragObj=null}}else{if(targets[curTarget].mode>=5&&targets[curTarget].mode<10){if(curTPcurve==null){tplines[curTarget].push([[e.x,e.y]]);curTPcurve=tplines[curTarget].length-1;tptypes[curTarget][curTPcurve]=targets[curTarget].mode;mouseisdown=false}else{tplines[curTarget][curTPcurve].push([e.x,e.y]);if(tplines[curTarget][curTPcurve].length==2){dragObj={mode:targets[curTarget].mode,num:curTPcurve,subnum:1};curTPcurve=null}}}else{if(targets[curTarget].mode>=10&&targets[curTarget].mode<11){if(curIneqcurve==null){ineqlines[curTarget].push([[e.x,e.y]]);curIneqcurve=ineqlines[curTarget].length-1;ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode;mouseisdown=false}else{ineqlines[curTarget][curIneqcurve].push([e.x,e.y]);if(ineqlines[curTarget][curIneqcurve].length==3){dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:1};curIneqcurve=null}}}}}}}}}else{if(c[0]==0||c[0]==0.5){if(curLine==null){targets[curTarget].el.style.cursor="move";dragObj={mode:targets[curTarget].mode,num:c[1],subnum:c[2]};oldpointpos=lines[curTarget][c[1]][c[2]];if(c[2]==lines[curTarget][c[1]].length-1&&targets[curTarget].mode==0){curLine=c[1]}else{if(c[2]==0&&targets[curTarget].mode==0){curLine=c[1];lines[curTarget][curLine].reverse();dragObj.subnum=lines[curTarget][curLine].length-1}}}else{if(c[1]==curLine&&c[2]==lines[curTarget][c[1]].length-1){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}curLine=null}else{targets[curTarget].el.style.cursor="url("+imasroot+"/img/pendown.cur), default";lines[curTarget][curLine].push([e.x,e.y])}}}else{if(c[0]==1){targets[curTarget].el.style.cursor="move";dragObj={mode:1,num:c[1]}}else{if(c[0]==2){targets[curTarget].el.style.cursor="move";dragObj={mode:2,num:c[1]}}else{if(c[0]>=5&&c[0]<10){targets[curTarget].el.style.cursor="move";dragObj={mode:c[0],num:c[1],subnum:c[2]};oldpointpos=tplines[curTarget][c[1]][c[2]]}else{if(c[0]>=10&&c[0]<11){targets[curTarget].el.style.cursor="move";dragObj={mode:c[0],num:c[1],subnum:c[2]};oldpointpos=ineqlines[curTarget][c[1]][c[2]]}}}}}}drawTarget()}else{if(curLine!=null){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}if(curTPcurve!=null){if(tplines[curTarget][curTPcurve].length<2){tplines[curTarget].splice(curTPcurve,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}if(curIneqcurve!=null){if(ineqlines[curTarget][curIneqcurve].length<3){ineqlines[curTarget].splice(curIneqcurve,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}curLine=null;curTPcurve=null;curIneqcurve=null;dragObj=null;drawTarget();curTarget=null}}}function findnearpoint(a,e){if(drawstyle[a]==0){if(targets[a].mode==0||targets[a].mode==0.5){for(var c=0;c<lines[a].length;c++){for(var b=lines[a][c].length-1;b>=0;b--){var d=Math.pow(lines[a][c][b][0]-e.x,2)+Math.pow(lines[a][c][b][1]-e.y,2);if(d<25){return[targets[a].mode,c,b]}}}}else{if(targets[a].mode==1){for(var c=0;c<dots[a].length;c++){if(Math.pow(dots[a][c][0]-e.x,2)+Math.pow(dots[a][c][1]-e.y,2)<25){return[1,c]}}}else{if(targets[a].mode==2){for(var c=0;c<odots[a].length;c++){if(Math.pow(odots[a][c][0]-e.x,2)+Math.pow(odots[a][c][1]-e.y,2)<25){return[2,c]}}}else{if(targets[a].mode>=5&&targets[a].mode<10){for(var c=0;c<tplines[a].length;c++){if(tptypes[a][c]!=targets[a].mode){continue}for(var b=tplines[a][c].length-1;b>=0;b--){var d=Math.pow(tplines[a][c][b][0]-e.x,2)+Math.pow(tplines[a][c][b][1]-e.y,2);if(d<25){return[tptypes[a][c],c,b]}}}}else{if(targets[a].mode>=10&&targets[a].mode<11){for(var c=0;c<ineqlines[a].length;c++){for(var b=ineqlines[a][c].length-1;b>=0;b--){var d=Math.pow(ineqlines[a][c][b][0]-e.x,2)+Math.pow(ineqlines[a][c][b][1]-e.y,2);if(d<25){return[ineqtypes[a][c],c,b]}}}}}}}}}else{if(targets[a].mode==1){for(var c=0;c<dots[a].length;c++){if(Math.pow(dots[a][c][0]-e.x,2)+Math.pow(dots[a][c][1]-e.y,2)<25){return[1,c]}}}else{if(targets[a].mode==2){for(var c=0;c<odots[a].length;c++){if(Math.pow(odots[a][c][0]-e.x,2)+Math.pow(odots[a][c][1]-e.y,2)<25){return[2,c]}}}else{if(targets[a].mode>=5&&targets[a].mode<10){for(var c=0;c<tplines[a].length;c++){for(var b=tplines[a][c].length-1;b>=0;b--){if(tptypes[a][c]!=targets[a].mode){continue}var d=Math.pow(tplines[a][c][b][0]-e.x,2)+Math.pow(tplines[a][c][b][1]-e.y,2);if(d<25){return[tptypes[a][c],c,b]}}}}else{if(targets[a].mode>=10&&targets[a].mode<11){for(var c=0;c<ineqlines[a].length;c++){for(var b=ineqlines[a][c].length-1;b>=0;b--){var d=Math.pow(ineqlines[a][c][b][0]-e.x,2)+Math.pow(ineqlines[a][c][b][1]-e.y,2);if(d<25){return[ineqtypes[a][c],c,b]}}}}}}}}return null}var lastdrawmouseup=null;function drawMouseUp(c){var a=mouseCoords(c);mouseisdown=false;if(curTarget!=null){if(lastdrawmouseup!=null&&a.x==lastdrawmouseup.x&&a.y==lastdrawmouseup.y){if(curLine!=null&&dragObj==null){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}curLine=null;dragObj=null;drawTarget()}}if(curLine!=null&&dragObj==null){if(targets[curTarget].mode==0.5&&lines[curTarget][curLine].length>1){curLine=null;dragobj=null;drawTarget()}}if(curLine==null&&curTPcurve==null){targets[curTarget].el.style.cursor="move"}else{targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}}lastdrawmouseup=a;if(curTarget!=null&&dragObj!=null){var b=getPosition(targets[curTarget].el);var d={x:(a.x-b.x),y:(a.y-b.y)};if(d.x>-1&&d.x<targets[curTarget].width&&d.y>-1&&d.y<targets[curTarget].height){dragObj=null}else{if(drawlocky[curTarget]==1){d.y=targets[curTarget].imgheight/2}if(dragObj.mode==1){dots[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==2){odots[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==0.5){lines[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==0){lines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos}else{if(dragObj.mode>=5&&dragObj.mode<10){tplines[curTarget].splice(dragObj.num,1);curTPcurve=null}else{if(dragObj.mode>=10&&dragObj.mode<11){ineqlines[curTarget].splice(dragObj.num,1);curIneqcurve=null}}}}}}dragObj=null;drawTarget()}}}function drawMouseMove(f){var b=null;var a=mouseCoords(f);if(curTarget==null){for(i in targets){var c=getPosition(targets[i].el);if(c.x<a.x&&(c.x+targets[i].width>a.x)&&c.y<a.y&&(c.y+targets[i].height>a.y)){b=i;break}}}if(b!=null){var c=getPosition(targets[b].el);var h={x:(a.x-c.x),y:(a.y-c.y)};if(drawlocky[b]==1){h.y=targets[b].imgheight/2}if(h.x>-1&&h.x<targets[b].width&&h.y>-1&&h.y<targets[b].height){if(dragObj==null){if(curLine==null){var d=findnearpoint(b,h);if(d==null){targets[b].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}else{targets[b].el.style.cursor="move"}}}}}if(curTarget!=null){var c=getPosition(targets[curTarget].el);var h={x:(a.x-c.x),y:(a.y-c.y)};if(drawlocky[curTarget]==1){h.y=targets[curTarget].imgheight/2}if(h.x>-1&&h.x<targets[curTarget].width&&h.y>-1&&h.y<targets[curTarget].height){if(dragObj==null){if(curLine!=null){if(mouseisdown&&targets[curTarget].mode==0){var e=lines[curTarget][curLine].length-1;var g=Math.pow(lines[curTarget][curLine][e][0]-h.x,2)+Math.pow(lines[curTarget][curLine][e][1]-h.y,2);if(g>25){lines[curTarget][curLine].push([h.x,h.y]);drawTarget()}else{drawTarget(h.x,h.y)}}else{if(mouseisdown&&targets[curTarget].mode==0.5){var e=lines[curTarget][curLine].length-1;if(e==0){var g=Math.pow(lines[curTarget][curLine][e][0]-h.x,2)+Math.pow(lines[curTarget][curLine][e][1]-h.y,2);if(g>25){lines[curTarget][curLine].push([h.x,h.y]);drawTarget()}else{drawTarget(h.x,h.y)}}else{lines[curTarget][curLine][e]=[h.x,h.y];drawTarget()}}else{drawTarget(h.x,h.y)}}}else{if(curTPcurve!=null){if(mouseisdown){drawTarget()}else{drawTarget(h.x,h.y)}}else{if(curIneqcurve!=null){if(mouseisdown){drawTarget()}else{drawTarget(h.x,h.y)}}else{var d=findnearpoint(curTarget,h);if(d==null){targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}else{targets[curTarget].el.style.cursor="move"}}}}}else{targets[curTarget].el.style.cursor="move";if(dragObj.mode==0||dragObj.mode==0.5){lines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}else{if(dragObj.mode==1){dots[curTarget][dragObj.num]=[h.x,h.y]}else{if(dragObj.mode==2){odots[curTarget][dragObj.num]=[h.x,h.y]}else{if(dragObj.mode>=5&&dragObj.mode<10){tplines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}else{if(dragObj.mode>=10&&dragObj.mode<11){ineqlines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}}}}}drawTarget()}return false}}}function mouseCoords(e){e=e||window.event;if(e.pageX||e.pageY){return{x:e.pageX,y:e.pageY}}var a=document.documentElement,c=document.body;if(a&&(a.scrollTop||a.scrollLeft)){var b=a.scrollLeft;var d=a.scrollTop}else{if(c){var b=c.scrollLeft;var d=c.scrollTop}else{var b=0;var d=0}}return{x:e.clientX+b,y:e.clientY+d}}function getMouseOffset(d,c){var b=getPosition(d);var a=mouseCoords(c);return{x:a.x-b.x,y:a.y-b.y}}function getPosition(f){var d=0;var c=0;if(f.getBoundingClientRect){var a=f.getBoundingClientRect();var b=Math.max(document.documentElement.scrollTop,document.body.scrollTop);var g=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);return{x:a.left+g,y:a.top+b}}while(f.offsetParent){d+=f.offsetLeft;c+=f.offsetTop;f=f.offsetParent}d+=f.offsetLeft;c+=f.offsetTop;return{x:d,y:c}}function initCanvases(a){for(var c in canvases){if(typeof(a)=="undefined"||a==c){if(drawla[c]!=null&&drawla[c].length>2){lines[canvases[c][0]]=drawla[c][0];dots[canvases[c][0]]=drawla[c][1];odots[canvases[c][0]]=drawla[c][2];if(drawla[c].length>3&&drawla[c][3].length>0){tptypes[canvases[c][0]]=[];tplines[canvases[c][0]]=[];for(var b=0;b<drawla[c][3].length;b++){tptypes[canvases[c][0]][b]=drawla[c][3][b][0];tplines[canvases[c][0]][b]=[drawla[c][3][b].slice(1,3),drawla[c][3][b].slice(3)]}}if(drawla[c].length>4&&drawla[c][4].length>0){ineqtypes[canvases[c][0]]=[];ineqlines[canvases[c][0]]=[];for(var b=0;b<drawla[c][4].length;b++){ineqtypes[canvases[c][0]][b]=drawla[c][4][b][0];ineqlines[canvases[c][0]][b]=[drawla[c][4][b].slice(1,3),drawla[c][4][b].slice(3,5),drawla[c][4][b].slice(5)]}}}addTarget(canvases[c][0],"canvas"+canvases[c][0],imasroot+"/filter/graph/imgs/"+canvases[c][1],"qn"+canvases[c][0],canvases[c][2],canvases[c][3],canvases[c][4],canvases[c][5],canvases[c][6],canvases[c][7],canvases[c][8],canvases[c][9],canvases[c][10],canvases[c][11])}}}document.onmousedown=drawMouseDown;document.onmouseup=drawMouseUp;document.onmousemove=drawMouseMove;if(typeof(initstack)!="undefined"){initstack.push(initCanvases)}else{if(typeof window.addEventListener!="undefined"){window.addEventListener("load",initCanvases,false)}else{if(typeof document.addEventListener!="undefined"){document.addEventListener("load",initCanvases,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onload",initCanvases)}else{if(typeof window.onload=="function"){var existing=onload;window.onload=function(){existing();initCanvases()}}else{window.onload=initCanvases}}}}};