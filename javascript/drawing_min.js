var mouseisdown=false;var targets=new Array();var imgs=new Array();var targetOuts=new Array();var lines=new Array();var dots=new Array();var odots=new Array();var tplines=new Array();var tptypes=new Array();var canvases=new Array();var drawla=new Array();var curLine=null;var drawstyle=[];var curTPcurve={tpline:null,tpparab:null,tpcirc:null,tpellipse:null};var dragObj=null;var oldpointpos=null;var curTarget=null;var nocanvaswarning=false;function clearcanvas(a){lines[a].length=0;dots[a].length=0;odots[a].length=0;tplines[a].length=0;tptypes[a].length=0;curTarget=a;drawTarget();curTarget=null;curLine=null;dragObj=null}function addTarget(o,j,f,l,a,g,n,e,d,p,k,m,c){var h=document.getElementById(j);var b=getPosition(h);targets[o]={el:h,left:b.x,top:b.y,width:h.offsetWidth,height:h.offsetHeight,xmin:a,xmax:g,ymin:n,ymax:e,imgborder:d,imgwidth:p,imgheight:k,mode:m,dotline:c};targetOuts[o]=document.getElementById(l);if(lines[o]==null){lines[o]=new Array()}if(dots[o]==null){dots[o]=new Array()}if(odots[o]==null){odots[o]=new Array()}if(tplines[o]==null){tplines[o]=new Array()}if(tptypes[o]==null){tptypes[o]=new Array()}if(m>=5){drawstyle[o]=1}else{drawstyle[o]=0}imgs[o]=new Image();imgs[o].onload=function(){var q=curTarget;curTarget=o;drawTarget();curTarget=q};imgs[o].src=f}function settool(a,d,e){var c=document.getElementById("drawtools"+d);var f=c.getElementsByTagName("span");for(var b=0;b<f.length;b++){f[b].className=""}f=c.getElementsByTagName("img");for(var b=0;b<f.length;b++){f[b].className=""}a.className="sel";setDrawMode(d,e)}function setDrawMode(a,b){targets[a].mode=b}function setDotLine(b,a){targets[b].dotline=a}function drawTarget(g,d){try{var k=targets[curTarget].el.getContext("2d")}catch(r){if(!nocanvaswarning){nocanvaswarning=true;alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)")}}k.fillStyle="rgb(0,0,255)";k.lineWidth=2;k.strokeStyle="rgb(0,0,255)";k.clearRect(0,0,targets[curTarget].imgwidth,targets[curTarget].imgheight);k.drawImage(imgs[curTarget],0,0);k.beginPath();for(var m=0;m<tplines[curTarget].length;m++){if(tptypes[curTarget][m]>=5&&tptypes[curTarget][m]<6){var f=null;var o=null;var a=null;if(tplines[curTarget][m].length==2){o=tplines[curTarget][m][1][0];a=tplines[curTarget][m][1][1]}else{if(curTPcurve.tpline==m&&g!=null&&tplines[curTarget][m].length==1){o=g;a=d}}if(o!=null){if(tptypes[curTarget][m]==5.3){k.moveTo(tplines[curTarget][m][0][0],tplines[curTarget][m][0][1]);k.lineTo(o,a)}else{if(o!=tplines[curTarget][m][0][0]){var f=(a-tplines[curTarget][m][0][1])/(o-tplines[curTarget][m][0][0])}if(Math.abs(o-tplines[curTarget][m][0][0])<1||Math.abs(f)>100){if(tptypes[curTarget][m]==5.2){k.moveTo(tplines[curTarget][m][0][0],tplines[curTarget][m][0][1]);if(a>tplines[curTarget][m][0][1]){k.lineTo(tplines[curTarget][m][0][0],targets[curTarget].imgheight)}else{k.lineTo(tplines[curTarget][m][0][0],0)}}else{k.moveTo(tplines[curTarget][m][0][0],0);k.lineTo(tplines[curTarget][m][0][0],targets[curTarget].imgheight)}}else{var t=tplines[curTarget][m][0][1]-f*tplines[curTarget][m][0][0];var n=tplines[curTarget][m][0][1]+f*(targets[curTarget].imgwidth-tplines[curTarget][m][0][0]);if(tptypes[curTarget][m]==5.2){k.moveTo(tplines[curTarget][m][0][0],tplines[curTarget][m][0][1]);if(o>tplines[curTarget][m][0][0]){k.lineTo(targets[curTarget].imgwidth,n)}else{k.lineTo(0,t)}}else{k.moveTo(0,t);k.lineTo(targets[curTarget].imgwidth,n)}}}}}else{if(tptypes[curTarget][m]==6){var a=null;var o=null;if(tplines[curTarget][m].length==2){o=tplines[curTarget][m][1][0];a=tplines[curTarget][m][1][1]}else{if(curTPcurve.tpline==m&&g!=null&&tplines[curTarget][m].length==1){o=g;a=d}}if(o!=null&&o!=tplines[curTarget][m][0][0]){if(a==tplines[curTarget][m][0][1]){k.moveTo(0,a);k.lineTo(targets[curTarget].imgwidth,a)}else{var s=(a-tplines[curTarget][m][0][1])/((o-tplines[curTarget][m][0][0])*(o-tplines[curTarget][m][0][0]));if(a>tplines[curTarget][m][0][1]){var w=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][m][0][1])/s)+tplines[curTarget][m][0][0];var u=-1*Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][m][0][1])/s)+tplines[curTarget][m][0][0];var h=tplines[curTarget][m][0][1]-(targets[curTarget].imgheight-tplines[curTarget][m][0][1]);var v=targets[curTarget].imgheight}else{var w=Math.sqrt((0-tplines[curTarget][m][0][1])/s)+tplines[curTarget][m][0][0];var u=-1*Math.sqrt((0-tplines[curTarget][m][0][1])/s)+tplines[curTarget][m][0][0];var h=2*tplines[curTarget][m][0][1];var v=0}var q=w+2/3*(tplines[curTarget][m][0][0]-w);var p=v+2/3*(h-v);var c=q+(u-w)/3;var b=p;k.moveTo(w,v);k.bezierCurveTo(q,p,c,b,u,v)}}}else{if(tptypes[curTarget][m]==7){if(tplines[curTarget][m].length==2){o=tplines[curTarget][m][1][0];a=tplines[curTarget][m][1][1]}else{if(curTPcurve.tpline==m&&g!=null&&tplines[curTarget][m].length==1){o=g;a=d}}if(o!=null&&(o!=tplines[curTarget][m][0][0]||a!=tplines[curTarget][m][0][1])){var z=Math.sqrt((o-tplines[curTarget][m][0][0])*(o-tplines[curTarget][m][0][0])+(a-tplines[curTarget][m][0][1])*(a-tplines[curTarget][m][0][1]));k.arc(tplines[curTarget][m][0][0],tplines[curTarget][m][0][1],z,0,2*Math.PI,true)}}}}k.stroke();for(var l=0;l<tplines[curTarget][m].length;l++){k.fillRect(tplines[curTarget][m][l][0]-3,tplines[curTarget][m][l][1]-3,6,6)}k.beginPath()}for(var m=0;m<lines[curTarget].length;m++){for(var l=0;l<lines[curTarget][m].length;l++){if(l==0){k.moveTo(lines[curTarget][m][l][0],lines[curTarget][m][l][1])}else{k.lineTo(lines[curTarget][m][l][0],lines[curTarget][m][l][1])}}if(m==curLine&&g!=null){k.lineTo(g,d)}}for(var m=0;m<odots[curTarget].length;m++){k.moveTo(odots[curTarget][m][0]+5,odots[curTarget][m][1]);k.arc(odots[curTarget][m][0],odots[curTarget][m][1],4,0,Math.PI*2,true)}k.stroke();k.beginPath();for(var m=0;m<dots[curTarget].length;m++){k.moveTo(dots[curTarget][m][0]+5,dots[curTarget][m][1]);k.arc(dots[curTarget][m][0],dots[curTarget][m][1],5,0,Math.PI*2,true)}k.fill();if(targets[curTarget].dotline==true){k.beginPath();for(var m=0;m<lines[curTarget].length;m++){for(var l=0;l<lines[curTarget][m].length;l++){if((l==0)||Math.pow((lines[curTarget][m][l][0]-lines[curTarget][m][0][0]),2)+Math.pow((lines[curTarget][m][l][1]-lines[curTarget][m][0][1]),2)>25){k.moveTo(lines[curTarget][m][l][0]+5,lines[curTarget][m][l][1]);k.arc(lines[curTarget][m][l][0],lines[curTarget][m][l][1],5,0,Math.PI*2,true)}}}k.fill()}encodeDraw()}function encodeDraw(){var b="";for(var c=0;c<lines[curTarget].length;c++){if(c!=0){b+=";"}for(var a=0;a<lines[curTarget][c].length;a++){if(a!=0){b+=","}b+="("+lines[curTarget][c][a][0]+","+lines[curTarget][c][a][1]+")"}}b+=";;";for(var c=0;c<dots[curTarget].length;c++){if(c!=0){b+=","}b+="("+dots[curTarget][c][0]+","+dots[curTarget][c][1]+")"}b+=";;";for(var c=0;c<odots[curTarget].length;c++){if(c!=0){b+=","}b+="("+odots[curTarget][c][0]+","+odots[curTarget][c][1]+")"}b+=";;";for(var c=0;c<tplines[curTarget].length;c++){if(c!=0){b+=","}if(tplines[curTarget][c].length>1){b+="("+tptypes[curTarget][c]+","+tplines[curTarget][c][0][0]+","+tplines[curTarget][c][0][1]+","+tplines[curTarget][c][1][0]+","+tplines[curTarget][c][1][1]+")"}}targetOuts[curTarget].value=b}function drawMouseDown(d){var a=mouseCoords(d);if(curTarget==null){for(i in targets){var b=getPosition(targets[i].el);if(b.x<a.x&&(b.x+targets[i].width>a.x)&&b.y<a.y&&(b.y+targets[i].height>a.y)){curTarget=i;break}}}if(curTarget!=null){mouseisdown=true;var b=getPosition(targets[curTarget].el);var e={x:(a.x-b.x),y:(a.y-b.y)};if(e.x>-1&&e.x<targets[curTarget].width&&e.y>-1&&e.y<targets[curTarget].height){var c=findnearpoint(curTarget,e);if(c==null){targets[curTarget].el.style.cursor="url("+imasroot+"/img/pendown.cur), default";if(targets[curTarget].mode==1){dots[curTarget].push([e.x,e.y]);dragObj={mode:1,num:dots[curTarget].length-1}}else{if(targets[curTarget].mode==2){odots[curTarget].push([e.x,e.y]);dragObj={mode:2,num:odots[curTarget].length-1}}else{if(targets[curTarget].mode==0){if(curLine==null){lines[curTarget].push([[e.x,e.y]]);curLine=lines[curTarget].length-1}else{lines[curTarget][curLine].push([e.x,e.y])}}else{if(targets[curTarget].mode>=5){if(curTPcurve.tpline==null){tplines[curTarget].push([[e.x,e.y]]);curTPcurve.tpline=tplines[curTarget].length-1;tptypes[curTarget][curTPcurve.tpline]=targets[curTarget].mode;mouseisdown=false}else{tplines[curTarget][curTPcurve.tpline].push([e.x,e.y]);if(tplines[curTarget][curTPcurve.tpline].length==2){dragObj={mode:targets[curTarget].mode,num:curTPcurve.tpline,subnum:1};curTPcurve.tpline=null}}}}}}}else{if(c[0]==0){if(curLine==null){targets[curTarget].el.style.cursor="move";dragObj={mode:0,num:c[1],subnum:c[2]};oldpointpos=lines[curTarget][c[1]][c[2]];if(c[2]==lines[curTarget][c[1]].length-1){curLine=c[1]}else{if(c[2]==0){curLine=c[1];lines[curTarget][curLine].reverse();dragObj.subnum=lines[curTarget][curLine].length-1}}}else{if(c[1]==curLine&&c[2]==lines[curTarget][c[1]].length-1){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}curLine=null}else{targets[curTarget].el.style.cursor="url("+imasroot+"/img/pendown.cur), default";lines[curTarget][curLine].push([e.x,e.y])}}}else{if(c[0]==1){targets[curTarget].el.style.cursor="move";dragObj={mode:1,num:c[1]}}else{if(c[0]==2){targets[curTarget].el.style.cursor="move";dragObj={mode:2,num:c[1]}}else{if(c[0]>=5){targets[curTarget].el.style.cursor="move";dragObj={mode:c[0],num:c[1],subnum:c[2]};oldpointpos=tplines[curTarget][c[1]][c[2]]}}}}}drawTarget()}else{if(curLine!=null){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}if(curTPcurve.tpline!=null){if(tplines[curTarget][curTPcurve.tpline].length<2){tplines[curTarget].splice(curTPcurve.tpline,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}curLine=null;curTPcurve.tpline=null;dragObj=null;drawTarget();curTarget=null}}}function findnearpoint(a,e){if(drawstyle[a]==0){if(targets[a].mode==0){for(var c=0;c<lines[a].length;c++){for(var b=lines[a][c].length-1;b>=0;b--){var d=Math.pow(lines[a][c][b][0]-e.x,2)+Math.pow(lines[a][c][b][1]-e.y,2);if(d<25){return[0,c,b]}}}}else{if(targets[a].mode==1){for(var c=0;c<dots[a].length;c++){if(Math.pow(dots[a][c][0]-e.x,2)+Math.pow(dots[a][c][1]-e.y,2)<25){return[1,c]}}}else{if(targets[a].mode==2){for(var c=0;c<odots[a].length;c++){if(Math.pow(odots[a][c][0]-e.x,2)+Math.pow(odots[a][c][1]-e.y,2)<25){return[2,c]}}}else{if(targets[a].mode>=5){for(var c=0;c<tplines[a].length;c++){for(var b=tplines[a][c].length-1;b>=0;b--){var d=Math.pow(tplines[a][c][b][0]-e.x,2)+Math.pow(tplines[a][c][b][1]-e.y,2);if(d<25){return[tptypes[a][c],c,b]}}}}}}}}else{for(var c=0;c<dots[a].length;c++){if(Math.pow(dots[a][c][0]-e.x,2)+Math.pow(dots[a][c][1]-e.y,2)<25){return[1,c]}}for(var c=0;c<odots[a].length;c++){if(Math.pow(odots[a][c][0]-e.x,2)+Math.pow(odots[a][c][1]-e.y,2)<25){return[2,c]}}for(var c=0;c<tplines[a].length;c++){for(var b=tplines[a][c].length-1;b>=0;b--){var d=Math.pow(tplines[a][c][b][0]-e.x,2)+Math.pow(tplines[a][c][b][1]-e.y,2);if(d<25){return[tptypes[a][c],c,b]}}}}return null}var lastdrawmouseup=null;function drawMouseUp(c){var a=mouseCoords(c);mouseisdown=false;if(curTarget!=null){if(lastdrawmouseup!=null&&a.x==lastdrawmouseup.x&&a.y==lastdrawmouseup.y){if(curLine!=null&&dragObj==null){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}curLine=null;dragObj=null;drawTarget()}}if(curLine==null&&curTPcurve.tpline==null){targets[curTarget].el.style.cursor="move"}else{targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}}lastdrawmouseup=a;if(curTarget!=null&&dragObj!=null){var b=getPosition(targets[curTarget].el);var d={x:(a.x-b.x),y:(a.y-b.y)};if(d.x>-1&&d.x<targets[curTarget].width&&d.y>-1&&d.y<targets[curTarget].height){dragObj=null}else{if(dragObj.mode==1){dots[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==2){odots[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==0){lines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos}else{if(dragObj.mode>=5){tplines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos;curTPcurve.tpline=null}}}}dragObj=null;drawTarget()}}}function drawMouseMove(f){var b=null;var a=mouseCoords(f);if(curTarget==null){for(i in targets){var c=getPosition(targets[i].el);if(c.x<a.x&&(c.x+targets[i].width>a.x)&&c.y<a.y&&(c.y+targets[i].height>a.y)){b=i;break}}}if(b!=null){var c=getPosition(targets[b].el);var h={x:(a.x-c.x),y:(a.y-c.y)};if(h.x>-1&&h.x<targets[b].width&&h.y>-1&&h.y<targets[b].height){if(dragObj==null){if(curLine==null){var d=findnearpoint(b,h);if(d==null){targets[b].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}else{targets[b].el.style.cursor="move"}}}}}if(curTarget!=null){var c=getPosition(targets[curTarget].el);var h={x:(a.x-c.x),y:(a.y-c.y)};if(h.x>-1&&h.x<targets[curTarget].width&&h.y>-1&&h.y<targets[curTarget].height){if(dragObj==null){if(curLine!=null){if(mouseisdown){var e=lines[curTarget][curLine].length-1;var g=Math.pow(lines[curTarget][curLine][e][0]-h.x,2)+Math.pow(lines[curTarget][curLine][e][1]-h.y,2);if(g>25){lines[curTarget][curLine].push([h.x,h.y]);drawTarget()}else{drawTarget(h.x,h.y)}}else{drawTarget(h.x,h.y)}}else{if(curTPcurve.tpline!=null){if(mouseisdown){drawTarget()}else{drawTarget(h.x,h.y)}}else{var d=findnearpoint(curTarget,h);if(d==null){targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}else{targets[curTarget].el.style.cursor="move"}}}}else{targets[curTarget].el.style.cursor="move";if(dragObj.mode==0){lines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}else{if(dragObj.mode==1){dots[curTarget][dragObj.num]=[h.x,h.y]}else{if(dragObj.mode==2){odots[curTarget][dragObj.num]=[h.x,h.y]}else{if(dragObj.mode>=5){tplines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}}}}drawTarget()}return false}}}function mouseCoords(e){e=e||window.event;if(e.pageX||e.pageY){return{x:e.pageX,y:e.pageY}}var a=document.documentElement,c=document.body;if(a&&(a.scrollTop||a.scrollLeft)){var b=a.scrollLeft;var d=a.scrollTop}else{if(c){var b=c.scrollLeft;var d=c.scrollTop}else{var b=0;var d=0}}return{x:e.clientX+b,y:e.clientY+d}}function getMouseOffset(d,c){var b=getPosition(d);var a=mouseCoords(c);return{x:a.x-b.x,y:a.y-b.y}}function getPosition(f){var d=0;var c=0;if(f.getBoundingClientRect){var a=f.getBoundingClientRect();var b=Math.max(document.documentElement.scrollTop,document.body.scrollTop);var g=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);return{x:a.left+g,y:a.top+b}}while(f.offsetParent){d+=f.offsetLeft;c+=f.offsetTop;f=f.offsetParent}d+=f.offsetLeft;c+=f.offsetTop;return{x:d,y:c}}function initCanvases(){for(var b=0;b<canvases.length;b++){if(drawla[b]!=null&&drawla[b].length>2){lines[canvases[b][0]]=drawla[b][0];dots[canvases[b][0]]=drawla[b][1];odots[canvases[b][0]]=drawla[b][2];if(drawla[b].length>3&&drawla[b][3].length>0){tptypes[canvases[b][0]]=[];tplines[canvases[b][0]]=[];for(var a=0;a<drawla[b][3].length;a++){tptypes[canvases[b][0]][a]=drawla[b][3][a][0];tplines[canvases[b][0]][a]=[drawla[b][3][a].slice(1,3),drawla[b][3][a].slice(3)]}}}addTarget(canvases[b][0],"canvas"+canvases[b][0],imasroot+"/filter/graph/imgs/"+canvases[b][1],"qn"+canvases[b][0],canvases[b][2],canvases[b][3],canvases[b][4],canvases[b][5],canvases[b][6],canvases[b][7],canvases[b][8],canvases[b][9],canvases[b][10])}}document.onmousedown=drawMouseDown;document.onmouseup=drawMouseUp;document.onmousemove=drawMouseMove;if(typeof(initstack)!="undefined"){initstack.push(initCanvases)}else{if(typeof window.addEventListener!="undefined"){window.addEventListener("load",initCanvases,false)}else{if(typeof document.addEventListener!="undefined"){document.addEventListener("load",initCanvases,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onload",initCanvases)}else{if(typeof window.onload=="function"){var existing=onload;window.onload=function(){existing();initCanvases()}}else{window.onload=initCanvases}}}}};